<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Planet Python - Page 10</title>
    <link href="styles.css" rel="stylesheet" />
  </head>
  <body class="h-full">
    <div class="drawer lg:drawer-open h-full">
      <input id="my-drawer-2" type="checkbox" class="drawer-toggle" />
      <div class="drawer-content flex flex-col h-full">
        <div class="navbar bg-base-100 lg:hidden">
          <div class="flex-none">
            <label
              for="my-drawer-2"
              class="btn btn-square btn-ghost drawer-button"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                class="inline-block w-5 h-5 stroke-current"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"
                ></path>
              </svg>
            </label>
          </div>
          <div class="flex-1">
            <a class="btn btn-ghost normal-case text-xl">Planet Python</a>
          </div>
        </div>
        
<div
  class="h-full overflow-y-auto p-4 bg-gradient-to-br from-base-200 to-base-300"
>
  <h1 class="text-4xl font-bold mb-6 text-center text-primary">
    Planet Python - Page 10
  </h1>
  <div class="mt-8"><div class="btn-group my-4"><a href="index9.html" class="btn">Â«</a><a href="index8.html" class="btn hover:bg-primary hover:shadow-lg hover:shadow-primary/50">8</a><a href="index9.html" class="btn hover:bg-primary hover:shadow-lg hover:shadow-primary/50">9</a><button class="btn btn-active hover:bg-primary hover:shadow-lg hover:shadow-primary/50">10</button></div></div>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html" class="hover:underline"
              >A Knownbits Abstract Domain for the Toy Optimizer, Correctly</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p>After <a href="https://bernsteinbear.com/blog/toy-abstract-interpretation/">Max' introduction to abstract interpretation for the toy optimizer</a> in the
last post, I want to present a more complicated abstract domain in this post.
This abstract domain reasons about the individual bits of a variable in a trace.
Every bit can be either "known zero", "known one" or "unknown". The abstract
domain is useful for optimizing integer operations, particularly the bitwise operations.
The abstract domain follows quite closely the <a href="https://github.com/torvalds/linux/blob/master/kernel/bpf/tnum.c">tristate abstract domain of the
eBPF verifier in the Linux
Kernel</a>, as
described by the paper
<a href="https://arxiv.org/abs/2105.05398">Sound, Precise, and Fast Abstract Interpretation with Tristate
Numbers</a> by Harishankar Vishwanathan, Matan
Shachnai, Srinivas Narayana, and Santosh Nagarakatte.</p>
<p>The presentation in this post will still be in the context of the
<a href="https://www.pypy.org/categories/toy-optimizer">toy optimizer</a>. We'll spend a significant part of
the post convincing ourselves that the abstract domain transfer functions that
we're writing are really correct, using both property-based testing and
automated proofs (again using Z3).</p>
<p>PyPy has implemented and merged a more complicated version of the same abstract
domain for the "real" PyPy JIT. A more thorough explanation of that real world
implementation will follow.</p>
<p>I'd like to thank Max Bernstein and Armin Rigo for lots of great feedback on
drafts of this post. The PyPy implementation was mainly done by Nico
Rittinghaus and me.</p>
<p><strong>Contents:</strong></p>
<div class="toc">
<ul>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#motivation">Motivation</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#the-knownbits-abstract-domain">The Knownbits Abstract Domain</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#transfer-functions">Transfer Functions</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#property-based-tests-with-hypothesis">Property-based Tests with Hypothesis</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#when-are-transfer-functions-correct-how-do-we-test-them">When are Transfer Functions Correct? How do we test them?</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#implementing-binary-transfer-functions">Implementing Binary Transfer Functions</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#addition-and-subtraction">Addition and Subtraction</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#proving-correctness-of-the-transfer-functions-with-z3">Proving correctness of the transfer functions with Z3</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#cases-where-this-style-of-z3-proof-doesnt-work">Cases where this style of Z3 proof doesn't work</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#making-statements-about-precision">Making Statements about Precision</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#using-the-abstract-domain-in-the-toy-optimizer-for-generalized-constant-folding">Using the Abstract Domain in the Toy Optimizer for Generalized Constant Folding</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#using-the-knownbits-domain-for-conditional-peephole-rewrites">Using the KnownBits Domain for Conditional Peephole Rewrites</a></li>
<li><a href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#conclusion">Conclusion</a></li>
</ul>
</div>
<h3 id="motivation">Motivation</h3>
<p>In many programs that do bit-manipulation of integers, some of the bits of the
integer variables of the program can be statically known. Here's a simple
example:</p>
<div class="code"><pre class="code literal-block"><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span>
...
<span class="k">if</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">1</span>:
<span class="w">    </span>...
<span class="k">else</span>:
<span class="w">    </span>...
</pre></div>

<p>After the assignment <code>x = a | 1</code>, we know that the lowest bit of <code>x</code> must be <code>1</code>
(the other bits are unknown) and an optimizer could remove the condition <code>x &amp; 1</code> by
constant-folding it to <code>1</code>.</p>
<p>Another (more complicated) example is:</p>
<div class="code"><pre class="code literal-block">assert i &amp; 0b111 == 0 # check that i is a multiple of 8
j = i + 16
assert j &amp; 0b111 == 0
</pre></div>

<p>This kind of code could e.g. happen in a <a href="https://docs.pydrofoil.org/en/latest/">CPU
emulator</a>, where <code>i</code> and <code>j</code> are
integers that represent emulated pointers, and the <code>assert</code>s are alignment
checks. The first assert implies that the lowest three bits of i must be <code>0</code>.
Adding 16 to such a number produces a result where the lowest three bits are
again all <code>0</code>, therefore the second assert is always true. So we would like a
compiler to remove the second assert.</p>
<p>Both of these will optimizations are doable with the help of the knownbits
abstract domain that we'll discuss in the rest of the post.</p>
<h3 id="the-knownbits-abstract-domain">The Knownbits Abstract Domain</h3>
<p>An abstract value of the knownbits domain needs to be able to store, for every
bit of an integer variable in a program, whether it is known 0, known 1, or
unknown. To represent
three different states, we need 2 bits, which we will call <code>one</code> and <code>unknown</code>.
Here's the encoding:</p>
<table>
<thead>
<tr>
<th>one</th>
<th>unknown</th>
<th align="right">knownbit</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td align="right">0</td>
</tr>
<tr>
<td>1</td>
<td>0</td>
<td align="right">1</td>
</tr>
<tr>
<td>0</td>
<td>1</td>
<td align="right">?</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td align="right">illegal</td>
</tr>
</tbody>
</table>
<p>The <code>unknown</code> bit is set if we don't know the value of the bit ("?"), the <code>one</code>
bit is set if the bit is known to be a <code>1</code>. Since two bits are enough to encode
four different states, but we only need three, the combination of a set <code>one</code>
bit and a set <code>unknown</code> is not allowed.</p>
<p>We don't just want to encode a single bit, however. Instead, we want to do this
for all the bits of an integer variable. Therefore the instances of the abstract
domain get two integer fields <code>ones</code> and <code>unknowns</code>, where each pair of
corresponding bits encodes the knowledge about the corresponding bit of the
integer variable in the program.</p>
<p>We can start implementing a Python class that works like this:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">eq</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">KnownBits</span><span class="p">:</span>
    <span class="n">ones</span> <span class="p">:</span> <span class="nb">int</span>
    <span class="n">unknowns</span> <span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ones</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_well_formed</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">is_well_formed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># a bit cannot be both 1 and unknown</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ones</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_constant</span><span class="p">(</span><span class="n">const</span> <span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">""" Construct a KnownBits corresponding to a constant, where all bits</span>
<span class="sd">        are known."""</span>
        <span class="k">return</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">const</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">""" Check if the KnownBits instance represents a constant. """</span>
        <span class="c1"># it's a constant if there are no unknowns</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>

<p>We can also add some convenience properties. Sometimes it is easier to work
with an integer where all the <em>known</em> bits are set, or one where the positions
of all the known zeros have a set bit:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">KnownBits</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">knowns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">""" return an integer where the known bits are set. """</span>
        <span class="c1"># the knowns are just the unknowns, inverted</span>
        <span class="k">return</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">zeros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">""" return an integer where the places that are known zeros have a bit</span>
<span class="sd">        set. """</span>
        <span class="c1"># it's a 0 if it is known, but not 1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowns</span> <span class="o">&amp;</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">ones</span>
</pre></div>

<p>Also, for debugging and for writing tests we want a way to print the known bits
in a human-readable form, and also to have a way to construct a <code>KnownBits</code>
instance from a string. It's not important to understand the details of
<code>__str__</code> or <code>from_str</code> for the rest of the post, so I'm putting them into a fold:</p>
<details>
<code>KnownBits</code> from and to string conversions


<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">KnownBits</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">"KnownBits.from_constant(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ones</span><span class="si">}</span><span class="s2">)"</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"KnownBits(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ones</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="si">}</span><span class="s2">)"</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ones</span><span class="p">,</span> <span class="n">unknowns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ones</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span>
        <span class="c1"># construct the string representation right to left</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ones</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unknowns</span><span class="p">:</span>
                <span class="k">break</span> <span class="c1"># we leave off the leading known 0s</span>
            <span class="k">if</span> <span class="n">ones</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unknowns</span><span class="p">:</span>
                <span class="c1"># -1 has all bits set in two's complement, so the leading</span>
                <span class="c1"># bits are all 1</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'1'</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"..."</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">unknowns</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># -1 has all bits set in two's complement, so the leading bits</span>
                <span class="c1"># are all ?</span>
                <span class="k">assert</span> <span class="ow">not</span> <span class="n">ones</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"?"</span><span class="p">)</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"..."</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">unknowns</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'?'</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ones</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'1'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'0'</span><span class="p">)</span>
            <span class="n">ones</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
            <span class="n">unknowns</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'0'</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">""" Construct a KnownBits instance that from a string. String can start</span>
<span class="sd">        with ...1 to mean that all higher bits are 1, or ...? to mean that all</span>
<span class="sd">        higher bits are unknown. Otherwise it is assumed that the higher bits</span>
<span class="sd">        are all 0. """</span>
        <span class="n">ones</span><span class="p">,</span> <span class="n">unknowns</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">startindex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"...?"</span><span class="p">):</span>
            <span class="n">unknowns</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">startindex</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"...1"</span><span class="p">):</span>
            <span class="n">ones</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">startindex</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">startindex</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
            <span class="n">ones</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
            <span class="n">unknowns</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">'1'</span><span class="p">:</span>
                <span class="n">ones</span> <span class="o">|=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">'?'</span><span class="p">:</span>
                <span class="n">unknowns</span> <span class="o">|=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">all_unknown</span><span class="p">():</span>
<span class="w">        </span><span class="sd">""" convenience constructor for the "all bits unknown" abstract value</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s2">"...?"</span><span class="p">)</span>
</pre></div>



</details>

<p>And here's a <a href="https://pytest.org">pytest</a>-style unit test for <code>str</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_str</span><span class="p">():</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'0'</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'101'</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">KnownBits</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mb">0b10</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'1?1'</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">KnownBits</span><span class="p">(</span><span class="o">~</span><span class="mb">0b1111</span><span class="p">,</span> <span class="mb">0b10</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'...100?0'</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">KnownBits</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">~</span><span class="mb">0b1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'...?1'</span>
</pre></div>

<p>An instance of <code>KnownBits</code> represents a set of integers, namely those that match
the known bits stored in the instance. We can write a method <code>contains</code> that
takes a concrete <code>int</code> value and returns <code>True</code> if the value matches the
pattern of the known bits:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">KnownBits</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">""" Check whether the KnownBits instance contains the concrete integer</span>
<span class="sd">        `value`. """</span>
        <span class="c1"># check whether value matches the bit pattern. in the places where we</span>
        <span class="c1"># know the bits, the value must agree with ones.</span>
        <span class="k">return</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowns</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ones</span>
</pre></div>

<p>and a test:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_contains</span><span class="p">():</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'1?1'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">k1</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="mb">0b111</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">k1</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="mb">0b101</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">k1</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="mb">0b110</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">k1</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="mb">0b011</span><span class="p">)</span>

    <span class="n">k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'...?1'</span><span class="p">)</span> <span class="c1"># all odd numbers</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">101</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">k2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

<h3 id="transfer-functions">Transfer Functions</h3>
<p>Now that we have implemented the basics of the <code>KnownBits</code> class, we need to
start implementing the transfer functions. They are for computing what we know
about the <em>results</em> of an operation, given the knowledge we have about the bits
of the arguments.</p>
<p>We'll start with a simple unary operation, <code>invert(x)</code> (which is <code>~x</code> in Python
and C syntax), which flips all the bits of at integer. If we know some bits of
the arguments, we can compute the corresponding bits of the result. The unknown
bits remain unknown.</p>
<p>Here's the code:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">KnownBits</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">abstract_invert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.zeros has bits set where the known 0s are in self</span>
        <span class="k">return</span> <span class="n">KnownBits</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zeros</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">)</span>
</pre></div>

<p>And a unit-test:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_invert</span><span class="p">():</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'01?01?01?'</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_invert</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'...10?10?10?'</span>

    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'...?'</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_invert</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'...?'</span>
</pre></div>

<p>Before we continue with further transfer functions, we'll think about
correctness of the transfer functions and build up some test infrastructure. To
test transfer functions, it's quite important to move being simple example-style
unit tests. The state-space for more complicated binary transfer functions is
extremely large and it's too easy to do something wrong in a corner case.
Therefore we'll look at property-based-test for <code>KnownBits</code> next.</p>
<h3 id="property-based-tests-with-hypothesis">Property-based Tests with Hypothesis</h3>
<p>We want to do property-based tests of <code>KnownBits</code>, to try
make it less likely that we'll get a corner-case in the implementation wrong.
We'll use <a href="https://hypothesis.readthedocs.io/en/latest/">Hypothesis</a> for that.</p>
<p>I can't give a decent introduction to Hypothesis here, but want to give a few
hints about the API. Hypothesis is a way to run unit tests with randomly
generated input. It provides <em>strategies</em> to describe the data that the test
functions expects. Hypothesis provides primitive strategies (for things like
integers, strings, floats, etc) and ways to build composite strategies out of
the primitive ones.</p>
<p>To be able to write the tests, we need to generate random <code>KnownBits</code> instances,
and we also want an <code>int</code> instance that is a member of the <code>KnownBits</code> instance.
We generate tuples of <code>(KnownBits, int)</code> together, to ensure this property.
We'll ask Hypothesis to generate us a random concrete <code>int</code> as the concrete
value, and then we'll also generate a second random <code>int</code> to use as the
<code>unknown</code> masks (i.e. which bits of the concrete int we don't know in the
<code>KnownBits</code> instance). Here's a function that takes two such ints and builds the
tuple:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">build_knownbits_and_contained_number</span><span class="p">(</span><span class="n">concrete_value</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">unknowns</span> <span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="c1"># to construct a valid KnownBits instance, we need to mask off the unknown</span>
    <span class="c1"># bits</span>
    <span class="n">ones</span> <span class="o">=</span> <span class="n">concrete_value</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">unknowns</span>
    <span class="k">return</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">),</span> <span class="n">concrete_value</span>
</pre></div>

<p>We can turn this function into a hypothesis strategy to generate input data
using the <code>strategies.builds</code> function:</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span> <span class="nn">hypothesis</span> <span class="kn">import</span> <span class="n">strategies</span><span class="p">,</span> <span class="n">given</span><span class="p">,</span> <span class="n">settings</span>

<span class="n">ints</span> <span class="o">=</span> <span class="n">strategies</span><span class="o">.</span><span class="n">integers</span><span class="p">()</span>

<span class="n">random_knownbits_and_contained_number</span> <span class="o">=</span> <span class="n">strategies</span><span class="o">.</span><span class="n">builds</span><span class="p">(</span>
    <span class="n">build_knownbits_and_contained_number</span><span class="p">,</span>
    <span class="n">ints</span><span class="p">,</span> <span class="n">ints</span>
<span class="p">)</span>
</pre></div>

<p>One important special case of <code>KnownBits</code> are the constants, which contain only
a single concrete value. We'll also generate some of those specifically, and
then combine the <code>random_knownbits_and_contained_number</code> strategy with it:</p>
<div class="code"><pre class="code literal-block"><span class="n">constant_knownbits</span> <span class="o">=</span> <span class="n">strategies</span><span class="o">.</span><span class="n">builds</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="p">(</span><span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">value</span><span class="p">),</span>
    <span class="n">ints</span>
<span class="p">)</span>

<span class="n">knownbits_and_contained_number</span> <span class="o">=</span> <span class="n">constant_knownbits</span> <span class="o">|</span> <span class="n">random_knownbits_and_contained_number</span>
</pre></div>

<p>Now we can write the first property-based tests, for the <code>KnownBits.contains</code>
method:</p>
<div class="code"><pre class="code literal-block"><span class="nd">@given</span><span class="p">(</span><span class="n">knownbits_and_contained_number</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_contains</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">t</span>
    <span class="k">assert</span> <span class="n">k</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>

<p>The <code>@given</code> decorator is used to tell Hypothesis which strategy to use to
generate random data for the test function. Hypothesis will run the test with a
number of random examples (100 by default). If it finds an error, it will try to
minimize the example needed that demonstrates the problem, to try to make it
easier to understand what is going wrong. It also saves all failing cases into
an example database and tries them again on subsequent runs.</p>
<p>This test is as much a check for whether we got the strategies right as it is
for the logic in <code>KnownBits.contains</code>. Here's an example output of random
concrete and abstract values that we are getting here:</p>
<div class="code"><pre class="code literal-block"><span class="mf">110000011001101</span><span class="w"> </span><span class="mf">...</span><span class="err">?</span><span class="mf">0</span><span class="err">???</span><span class="mf">1</span>
<span class="mf">...1011011</span><span class="w"> </span><span class="mf">...1011011</span>
<span class="mf">...1001101110101000010010011111011</span><span class="w"> </span><span class="mf">...1001101110101000010010011111011</span>
<span class="mf">...1001101110101000010010011111011</span><span class="w"> </span><span class="mf">...100110111010100001</span><span class="err">?</span><span class="mf">010</span><span class="err">?</span><span class="mf">1</span><span class="err">??</span><span class="mf">1</span><span class="err">??</span><span class="mf">11</span>
<span class="mf">1000001101111101001011010011111101000011000111011001011111101</span><span class="w"> </span><span class="mf">1000001101111101001011010011111101000011000111011001011111101</span>
<span class="mf">1000001101111101001011010011111101000011000111011001011111101</span><span class="w"> </span><span class="mf">1000001101111101001011010011111101000011000111</span><span class="err">????</span><span class="mf">01</span><span class="err">?</span><span class="mf">11</span><span class="err">?????</span><span class="mf">1</span>
<span class="mf">1111100000010</span><span class="w"> </span><span class="mf">1111100000010</span>
<span class="mf">1111100000010</span><span class="w"> </span><span class="mf">...</span><span class="err">?</span><span class="mf">11111</span><span class="err">?</span><span class="mf">00000</span><span class="err">??</span>
<span class="mf">110110</span><span class="w"> </span><span class="mf">110110</span>
<span class="mf">110110</span><span class="w"> </span><span class="mf">...</span><span class="err">?</span><span class="mf">00</span><span class="err">?</span><span class="mf">00</span><span class="err">????</span><span class="mf">11</span><span class="err">??</span><span class="mf">10</span>
<span class="mf">110110</span><span class="w"> </span><span class="err">??</span><span class="mf">0</span><span class="err">??</span><span class="mf">0</span>
<span class="mf">...100010111011111</span><span class="w"> </span><span class="mf">...</span><span class="err">?</span><span class="mf">100</span><span class="err">?</span><span class="mf">10111</span><span class="err">??</span><span class="mf">111</span><span class="err">?</span>
<span class="mf">...1000100000110001</span><span class="w"> </span><span class="mf">...</span><span class="err">?</span><span class="mf">000</span><span class="err">?</span><span class="mf">00000</span><span class="err">??</span><span class="mf">000</span><span class="err">?</span>
<span class="mf">110000001110</span><span class="w"> </span><span class="mf">...</span><span class="err">?</span><span class="mf">0</span><span class="err">?</span><span class="mf">0</span><span class="err">??</span><span class="mf">000</span><span class="err">?</span><span class="mf">00</span><span class="err">?</span><span class="mf">0</span><span class="err">?</span><span class="mf">0000000</span><span class="err">?</span><span class="mf">00</span><span class="err">???</span><span class="mf">0000</span><span class="err">?????</span><span class="mf">00</span><span class="err">???</span><span class="mf">000</span><span class="err">?</span><span class="mf">0</span><span class="err">?</span><span class="mf">00</span><span class="err">?</span><span class="mf">01</span><span class="err">?</span><span class="mf">000</span><span class="err">?</span><span class="mf">0</span><span class="err">??</span><span class="mf">1</span><span class="err">??</span>
<span class="mf">110000001110</span><span class="w"> </span><span class="err">??</span><span class="mf">000000</span><span class="err">???</span><span class="mf">0</span>
<span class="mf">1011011010000001110101001111000010001001011101010010010001000000010101010010001101110101111111010101010010101100110000011110000</span><span class="w"> </span><span class="mf">1011011010000001110101001111000010001001011101010010010001000000010101010010001101110101111111010101010010101100110000011110000</span>
<span class="mf">...1011010010010100</span><span class="w"> </span><span class="mf">...1011010010010100</span>
<span class="mf">...1011111110110011</span><span class="w"> </span><span class="mf">...1011111110110011</span>
<span class="mf">101000011110110</span><span class="w"> </span><span class="mf">101000011</span><span class="err">?</span><span class="mf">10</span><span class="err">?</span><span class="mf">1</span><span class="err">?</span>
<span class="mf">100101</span><span class="w"> </span><span class="err">?</span><span class="mf">00</span><span class="err">?</span><span class="mf">0</span><span class="err">?</span>
</pre></div>

<p>That looks suitably random, but we might want to bias our random numbers a
little bit towards common error values like small constants, powers of two, etc.
Like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">INTEGER_WIDTH</span> <span class="o">=</span> <span class="mi">64</span>
<span class="c1"># some small integers</span>
<span class="n">ints_special</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="c1"># powers of two</span>
<span class="n">ints_special</span> <span class="o">=</span> <span class="n">ints_special</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">INTEGER_WIDTH</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># powers of two - 1</span>
<span class="n">ints_special</span> <span class="o">=</span> <span class="n">ints_special</span><span class="o">.</span><span class="n">union</span><span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">INTEGER_WIDTH</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># negative versions of what we have so far</span>
<span class="n">ints_special</span> <span class="o">=</span> <span class="n">ints_special</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ints_special</span><span class="p">)</span>
<span class="c1"># bit-flipped versions of what we have so far</span>
<span class="n">ints_special</span> <span class="o">=</span> <span class="n">ints_special</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">~</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ints_special</span><span class="p">)</span>
<span class="n">ints_special</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ints_special</span><span class="p">)</span>
<span class="c1"># sort them (because hypothesis simplifies towards earlier elements in the list)</span>
<span class="n">ints_special</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">element</span><span class="p">:</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">element</span><span class="p">),</span> <span class="n">element</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>

<span class="n">ints</span> <span class="o">=</span> <span class="n">strategies</span><span class="o">.</span><span class="n">sampled_from</span><span class="p">(</span><span class="n">ints_special</span><span class="p">)</span> <span class="o">|</span> <span class="n">strategies</span><span class="o">.</span><span class="n">integers</span><span class="p">()</span>
</pre></div>

<p>Now we get data like this:</p>
<div class="code"><pre class="code literal-block"><span class="mf">1110</span><span class="w"> </span><span class="mf">1110</span>
<span class="mf">...10000000000000000001</span><span class="w"> </span><span class="mf">...10000</span><span class="err">??</span><span class="mf">0</span><span class="err">??</span><span class="mf">0000</span><span class="err">??</span><span class="mf">00</span><span class="err">?</span><span class="mf">1</span>
<span class="mf">1</span><span class="w"> </span><span class="err">??</span><span class="mf">0</span><span class="err">??</span><span class="mf">0000</span><span class="err">??</span><span class="mf">00</span><span class="err">?</span><span class="mf">1</span>
<span class="mf">1</span><span class="w"> </span><span class="err">?</span>
<span class="mf">...10101100</span><span class="w"> </span><span class="mf">...10101100</span>
<span class="mf">110000000011001010111011111111111111011110010001001100110001011</span><span class="w"> </span><span class="mf">...</span><span class="err">?</span><span class="mf">0</span><span class="err">?</span><span class="mf">101</span><span class="err">?</span>
<span class="mf">110000000011001010111011111111111111011110010001001100110001011</span><span class="w"> </span><span class="err">??</span><span class="mf">00000000</span><span class="err">??</span><span class="mf">00</span><span class="err">?</span><span class="mf">0</span><span class="err">?</span><span class="mf">0</span><span class="err">???</span><span class="mf">0</span><span class="err">??????????????</span><span class="mf">0</span><span class="err">????</span><span class="mf">00</span><span class="err">?</span><span class="mf">000</span><span class="err">?</span><span class="mf">00</span><span class="err">??</span><span class="mf">00</span><span class="err">??</span><span class="mf">000</span><span class="err">?</span><span class="mf">0</span><span class="err">??</span>
<span class="mf">...1011111111111111111111111111</span><span class="w"> </span><span class="mf">...</span><span class="err">?</span><span class="mf">11</span><span class="err">?</span><span class="mf">11</span><span class="err">??</span>
<span class="mf">...1011111111111111111111111111</span><span class="w"> </span><span class="mf">...</span><span class="err">?</span><span class="mf">0</span><span class="err">??????????????????????????</span>
<span class="mf">0</span><span class="w"> </span><span class="mf">...</span><span class="err">?</span><span class="mf">0</span><span class="err">??????????????????????????</span>
<span class="mf">101101</span><span class="w"> </span><span class="mf">101101</span>
<span class="mf">111111111111111111111111111111111111111111111</span><span class="w"> </span><span class="mf">111111111111111111111111111111111111111111111</span>
<span class="mf">10111</span><span class="w"> </span><span class="mf">10111</span>
<span class="mf">...101100</span><span class="w"> </span><span class="mf">...1</span><span class="err">?</span><span class="mf">111011</span><span class="err">?</span><span class="mf">0</span>
<span class="mf">101000</span><span class="w"> </span><span class="err">?</span><span class="mf">001010</span><span class="err">?</span><span class="mf">0</span>
<span class="mf">101000</span><span class="w"> </span><span class="err">?</span><span class="mf">0</span><span class="err">?</span><span class="mf">000</span>
<span class="mf">110010</span><span class="w"> </span><span class="mf">110010</span>
<span class="mf">...100111</span><span class="w"> </span><span class="mf">...100111</span>
<span class="mf">1111011010010</span><span class="w"> </span><span class="mf">1111011010010</span>
<span class="mf">...1000000000000000000000000000000000000</span><span class="w"> </span><span class="mf">...1000000000000000000000000000000000000</span>
</pre></div>

<p>We can also write a test that checks that the somewhat tricky logic in
<code>__str__</code> and <code>from_str</code> is correct, by making sure that the two functions
round-trip (ie converting a <code>KnownBits</code> to a string and then back to a
<code>KnownBits</code> instance produces the same abstract value).</p>
<div class="code"><pre class="code literal-block"><span class="nd">@given</span><span class="p">(</span><span class="n">knownbits_and_contained_number</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_hypothesis_str_roundtrips</span><span class="p">(</span><span class="n">t1</span><span class="p">):</span>
    <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">t1</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">k1</span><span class="o">.</span><span class="n">ones</span> <span class="o">==</span> <span class="n">k2</span><span class="o">.</span><span class="n">ones</span>
    <span class="k">assert</span> <span class="n">k1</span><span class="o">.</span><span class="n">unknowns</span> <span class="o">==</span> <span class="n">k2</span><span class="o">.</span><span class="n">unknowns</span>
</pre></div>

<p>Now let's actually apply this infrastructure to test <code>abstract_invert</code>.</p>
<h3 id="when-are-transfer-functions-correct-how-do-we-test-them">When are Transfer Functions Correct? How do we test them?</h3>
<p>Abstract values, i.e. instances of <code>KnownBits</code> represent <em>sets</em> of concrete
values. We want the transfer functions to compute <em>overapproximations</em> of the
concrete values. So if we have an arbitrary abstract value <code>k</code>, with a concrete
number <code>n</code> that is a member of the abstract values (i.e.
<code>k.contains(n) == True</code>) then the result of the concrete operation <code>op(n)</code>
<strong>must</strong> be a member of the result of the abstract operation <code>k.abstract_op()</code>
(i.e. <code>k.abstract_op().contains(op(n)) == True</code>).</p>
<p>Checking the correctness/overapproximation property is a good match for
hypothesis. Here's what the test for <code>abstract_invert</code> looks like:</p>
<div class="code"><pre class="code literal-block"><span class="nd">@given</span><span class="p">(</span><span class="n">knownbits_and_contained_number</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_hypothesis_invert</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">t1</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="o">~</span><span class="n">n1</span> <span class="c1"># compute the real result</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_invert</span><span class="p">()</span> <span class="c1"># compute the abstract result</span>
    <span class="k">assert</span> <span class="n">k2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span> <span class="c1"># the abstract result must contain the real result</span>
</pre></div>

<p>This is the <em>only</em> condition needed for <code>abstract_invert</code> to be correct. If
<code>abstract_invert</code> fulfils this property for every combination of abstract and
concrete value then <code>abstract_invert</code> is correct. Note however, that this test
does not actually check whether <code>abstract_invert</code> gives us precise results. A
correct (but imprecise) implementation of <code>abstract_invert</code> would simply return
a completely unknown result, regardless of what is known about the input
<code>KnownBits</code>.</p>
<p>The "proper" CS term for this notion of correctness is called <em>soundness</em>. The
correctness condition on the transfer functions is called a <em>Galois
connection</em>. I won't go into any mathematical/technical details here, but
wanted to at least mention the terms. I found <a href="https://web.njit.edu/~mjk76/">Martin
Kellogg</a>'s
<a href="https://web.njit.edu/~mjk76/teaching/cs684-sp24/assets/lecture-12.pdf#34">slides</a>
to be quite an approachable introduction to the Galois connection and how to
show soundness.</p>
<h3 id="implementing-binary-transfer-functions">Implementing Binary Transfer Functions</h3>
<p>Now we have infrastructure in place for testing transfer functions with random
inputs. With that we can start thinking about the more complicated case, that of
binary operations. Let's start with the simpler ones, <code>and</code> and <code>or</code>. For <code>and</code>,
we can know a <code>0</code> bit in the result if either of the input bits are known <code>0</code>;
or we can know a <code>1</code> bit in the result if both input bits are known <code>1</code>.
Otherwise the resulting bit is unknown. Let's look at all the combinations:</p>
<div class="code"><pre class="code literal-block">and
input1: 000111???
input2: 01?01?01? 
result: 00001?0??
</pre></div>

<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">KnownBits</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">abstract_and</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ones</span> <span class="o">&amp;</span> <span class="n">other</span><span class="o">.</span><span class="n">ones</span> <span class="c1"># known ones</span>
        <span class="n">knowns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeros</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">zeros</span> <span class="o">|</span> <span class="n">ones</span>
        <span class="k">return</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="o">~</span><span class="n">knowns</span><span class="p">)</span>
</pre></div>

<p>Here's an example unit-test and a property-based test for <code>and</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_and</span><span class="p">():</span>
    <span class="c1"># test all combinations of 0, 1, ? in one example</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'01?01?01?'</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'000111???'</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_and</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>     <span class="c1"># should be: 0...00001?0??</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span>   <span class="s2">"1?0??"</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">knownbits_and_contained_number</span><span class="p">,</span> <span class="n">knownbits_and_contained_number</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_hypothesis_and</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">t1</span>
    <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">t2</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_and</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">&amp;</span> <span class="n">n2</span>
    <span class="k">assert</span> <span class="n">k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n3</span><span class="p">)</span>
</pre></div>

<p>To implement <code>or</code> is pretty similar. The result is known <code>1</code> where either of the
inputs is <code>1</code>. The result is known <code>0</code> where both inputs are known <code>0</code>, and <code>?</code>
otherwise.</p>
<div class="code"><pre class="code literal-block">or
input1: 000111???
input2: 01?01?01? 
result: 01?111?1?
</pre></div>

<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">KnownBits</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">abstract_or</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ones</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">ones</span>
        <span class="n">zeros</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeros</span> <span class="o">&amp;</span> <span class="n">other</span><span class="o">.</span><span class="n">zeros</span>
        <span class="n">knowns</span> <span class="o">=</span> <span class="n">ones</span> <span class="o">|</span> <span class="n">zeros</span>
        <span class="k">return</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="o">~</span><span class="n">knowns</span><span class="p">)</span>
</pre></div>

<p>Here's an example unit-test and a property-based test for <code>or</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_or</span><span class="p">():</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'01?01?01?'</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'000111???'</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_or</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>     <span class="c1"># should be:  0...01?111?1?</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span>   <span class="s2">"1?111?1?"</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">knownbits_and_contained_number</span><span class="p">,</span> <span class="n">knownbits_and_contained_number</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_hypothesis_or</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">t1</span>
    <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">t2</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_or</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">|</span> <span class="n">n2</span>
    <span class="k">assert</span> <span class="n">k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n3</span><span class="p">)</span>
</pre></div>

<p>Implementing support for <code>abstract_xor</code> is relatively simple, and left as an
exercise :-).</p>
<h3 id="addition-and-subtraction">Addition and Subtraction</h3>
<p><code>invert</code>, <code>and</code>, and <code>or</code> are relatively simple transfer functions to write,
because they compose over the individual bits of the integers. The arithmetic
functions <code>add</code> and <code>sub</code> are significantly harder, because of carries and
borrows. Coming up with the formulas for them and gaining an intuitive
understanding is quite tricky and involves carefully going through a few
examples with pen and paper. When implementing this in PyPy, Nico and I didn't
come up with the implementation ourselves, but instead took them from the
<a href="https://arxiv.org/abs/2105.05398">Tristate Numbers</a> paper. Here's the code,
with example tests and hypothesis tests:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">KnownBits</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">abstract_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">sum_ones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ones</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">ones</span>
        <span class="n">sum_unknowns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">unknowns</span>
        <span class="n">all_carries</span> <span class="o">=</span> <span class="n">sum_ones</span> <span class="o">+</span> <span class="n">sum_unknowns</span>
        <span class="n">ones_carries</span> <span class="o">=</span> <span class="n">all_carries</span> <span class="o">^</span> <span class="n">sum_ones</span>
        <span class="n">unknowns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">unknowns</span> <span class="o">|</span> <span class="n">ones_carries</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="n">sum_ones</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">unknowns</span>
        <span class="k">return</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">abstract_sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">diff_ones</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ones</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">ones</span>
        <span class="n">val_borrows</span> <span class="o">=</span> <span class="p">(</span><span class="n">diff_ones</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">diff_ones</span> <span class="o">-</span> <span class="n">other</span><span class="o">.</span><span class="n">unknowns</span><span class="p">)</span>
        <span class="n">unknowns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unknowns</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">unknowns</span> <span class="o">|</span> <span class="n">val_borrows</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="n">diff_ones</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">unknowns</span>
        <span class="k">return</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_add</span><span class="p">():</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'0?10?10?10'</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'0???111000'</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_add</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span>   <span class="s2">"?????01?10"</span>

<span class="k">def</span> <span class="nf">test_sub</span><span class="p">():</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'0?10?10?10'</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'0???111000'</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_sub</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span>   <span class="s2">"...?11?10"</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span>    <span class="s1">'...1?10?10?10'</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'...10000???111000'</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_sub</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">==</span>   <span class="s2">"111?????11?10"</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">knownbits_and_contained_number</span><span class="p">,</span> <span class="n">knownbits_and_contained_number</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_hypothesis_add</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">t1</span>
    <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">t2</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_add</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span>
    <span class="k">assert</span> <span class="n">k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n3</span><span class="p">)</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">knownbits_and_contained_number</span><span class="p">,</span> <span class="n">knownbits_and_contained_number</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_hypothesis_sub</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">t1</span>
    <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">t2</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_sub</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">-</span> <span class="n">n2</span>
    <span class="k">assert</span> <span class="n">k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n3</span><span class="p">)</span>
</pre></div>

<p>Now we are in a pretty good situation, and have implemented abstract versions
for a bunch of important arithmetic and binary functions. What's also surprising
is that the implementation of all of the transfer functions is quite efficient.
We didn't have to write loops over the individual bits at all, instead we found
closed form expressions using primitive operations on the underlying integers
<code>ones</code> and <code>unknowns</code>. This means that computing the results of abstract
operations is quite efficient, which is important when using the abstract domain
in the context of a JIT compiler.</p>
<h3 id="proving-correctness-of-the-transfer-functions-with-z3">Proving correctness of the transfer functions with Z3</h3>
<p>As one can probably tell from my recent posts, I've been thinking about
compiler correctness a lot. Getting the transfer functions absolutely
correct is really crucial, because a bug in them would lead to miscompilation of
Python code when the abstract domain is added to the JIT. While the randomized
tests are great, it's still entirely possible for them to miss bugs. The state
space for the arguments of a binary transfer function is <code>3**64 * 3**64</code>, and if
only a small part of that contains wrong behaviour it would be really unlikely
for us to find it with random tests by chance. Therefore I was reluctant to
merge the PyPy branch that contained the new abstract domain for a long time.</p>
<p>To increase our confidence in the correctness of the transfer functions further,
we can use Z3 to <em>prove</em> their correctness, which gives us much stronger
guarantees (not 100%, obviously). In this subsection I will show how to do that.</p>
<p>Here's an attempt to do this manually in the Python repl:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="nn">z3</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z3</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># like last blog post, proof by failing to find counterexamples</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="k">def</span><span class="w"> </span><span class="nf">prove</span><span class="p">(</span><span class="n">cond</span><span class="p">):</span><span class="w"> </span><span class="k">assert</span><span class="w"> </span><span class="n">solver</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">cond</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">z3</span><span class="o">.</span><span class="n">unsat</span>
<span class="o">&gt;&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># let's set up a z3 bitvector variable for an arbitrary concrete value</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">'concrete_value'</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">n1</span>
<span class="n">concrete_value</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># due to operator overloading we can manipulate z3 formulas</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">n1</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">n2</span>
<span class="o">~</span><span class="n">concrete_value</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># now z3 bitvector variables for the ones and zeros fields</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">ones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">'abstract_ones'</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">unknowns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="s1">'abstract_unknowns'</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># we construct a KnownBits instance with the z3 variables</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">k1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KnownBits</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span><span class="w"> </span><span class="n">unknowns</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># due to operator overloading we can call the methods on k1:</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k1</span><span class="o">.</span><span class="n">abstract_invert</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">k2</span><span class="o">.</span><span class="n">ones</span>
<span class="o">~</span><span class="n">abstract_unknowns</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">abstract_ones</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">k2</span><span class="o">.</span><span class="n">unknowns</span>
<span class="n">abstract_unknowns</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># here's the correctness condition that we want to prove:</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">k2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
<span class="o">~</span><span class="n">concrete_value</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">abstract_unknowns</span><span class="w"> </span><span class="o">==</span>
<span class="o">~</span><span class="n">abstract_unknowns</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">abstract_ones</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># let's try</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">prove</span><span class="p">(</span><span class="n">k2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n2</span><span class="p">))</span>
<span class="n">Traceback</span><span class="w"> </span><span class="p">(</span><span class="n">most</span><span class="w"> </span><span class="n">recent</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">last</span><span class="p">):</span>
<span class="w">  </span><span class="n">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="w">  </span><span class="n">File</span><span class="w"> </span><span class="s2">"&lt;stdin&gt;"</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">prove</span>
<span class="n">AssertionError</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># it doesn't work! let's look at the counterexample to see why:</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">solver</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
<span class="p">[</span><span class="n">abstract_unknowns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w"> </span><span class="n">abstract_ones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w"> </span><span class="n">concrete_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># we can build a KnownBits instance with the values in the</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># counterexample:</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="o">~</span><span class="mi">1</span><span class="w"> </span><span class="c1"># concrete result</span>
<span class="o">-</span><span class="mi">2</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">counter_example_k1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KnownBits</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">counter_example_k1</span>
<span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">counter_example_k2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter_example_k1</span><span class="o">.</span><span class="n">abstract_invert</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">counter_example_k2</span>
<span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="c1"># let's check the failing condition</span>
<span class="o">&gt;&gt;&gt;&gt;</span><span class="w"> </span><span class="n">counter_example_k2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="o">~</span><span class="mi">1</span><span class="p">)</span>
<span class="kc">False</span>
</pre></div>

<p>What is the problem here? We didn't tell Z3 that <code>n1</code> was supposed to be a
member of <code>k1</code>. We can add this as a precondition to the solver, and then the
prove works:</p>
<div class="code"><pre class="code literal-block">&gt;&gt;&gt;&gt; solver.add(k1.contains(n1))
&gt;&gt;&gt;&gt; prove(k2.contains(n2)) # works!
</pre></div>

<p>This is super cool! It's really a proof about the actual implementation, because
we call the implementation methods directly, and due to the operator overloading
that Z3 does we can be sure that we are actually checking a formula that
corresponds to the Python code. This eliminates one source of errors in formal
methods.</p>
<p>Doing the proof manually on the Python REPL is kind of annoying though, and we
also would like to make sure that the proofs are re-done when we change the
code. What we would really like to do is writing the proofs as a unit-test that
we can run while developing and in CI. Doing this is possible, and the unit
tests that really perform proofs look pleasingly similar to the
Hypothesis-based ones.</p>
<p>First we need to set up a bit of infrastructure:</p>
<div class="code"><pre class="code literal-block"><span class="n">INTEGER_WIDTH</span> <span class="o">=</span> <span class="mi">64</span>

<span class="k">def</span> <span class="nf">BitVec</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVec</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">INTEGER_WIDTH</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">BitVecVal</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">z3</span><span class="o">.</span><span class="n">BitVecVal</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">INTEGER_WIDTH</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">z3_setup_variables</span><span class="p">():</span>
    <span class="c1"># instantiate a solver</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>

    <span class="c1"># a Z3 variable for the first concrete value</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">BitVec</span><span class="p">(</span><span class="s2">"n1"</span><span class="p">)</span>
    <span class="c1"># a KnownBits instances that uses Z3 variables as its ones and unknowns,</span>
    <span class="c1"># representing the first abstract value</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">BitVec</span><span class="p">(</span><span class="s2">"n1_ones"</span><span class="p">),</span> <span class="n">BitVec</span><span class="p">(</span><span class="s2">"n1_unkowns"</span><span class="p">))</span>
    <span class="c1"># add the precondition to the solver that the concrete value n1 must be a</span>
    <span class="c1"># member of the abstract value k1</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n1</span><span class="p">))</span>

    <span class="c1"># a Z3 variable for the second concrete value</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="n">BitVec</span><span class="p">(</span><span class="s2">"n2"</span><span class="p">)</span>
    <span class="c1"># a KnownBits instances for the second abstract value</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">BitVec</span><span class="p">(</span><span class="s2">"n2_ones"</span><span class="p">),</span> <span class="n">BitVec</span><span class="p">(</span><span class="s2">"n2_unkowns"</span><span class="p">))</span>
    <span class="c1"># add the precondition linking n2 and k2 to the solver</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">solver</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span>

<span class="k">def</span> <span class="nf">prove</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>
    <span class="n">z3res</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Not</span><span class="p">(</span><span class="n">cond</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">z3res</span> <span class="o">!=</span> <span class="n">z3</span><span class="o">.</span><span class="n">unsat</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">z3res</span> <span class="o">==</span> <span class="n">z3</span><span class="o">.</span><span class="n">sat</span> <span class="c1"># can't be timeout, we set no timeout</span>
        <span class="c1"># make the model with the counterexample global, to make inspecting the</span>
        <span class="c1"># bug easier when running pytest --pdb</span>
        <span class="k">global</span> <span class="n">model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"n1=</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span><span class="si">}</span><span class="s2">, n2=</span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">counter_example_k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">ones</span><span class="p">)</span><span class="o">.</span><span class="n">as_signed_long</span><span class="p">(),</span>
                                       <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">unknowns</span><span class="p">)</span><span class="o">.</span><span class="n">as_signed_long</span><span class="p">())</span>
        <span class="n">counter_example_k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">k2</span><span class="o">.</span><span class="n">ones</span><span class="p">)</span><span class="o">.</span><span class="n">as_signed_long</span><span class="p">(),</span>
                                       <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">k2</span><span class="o">.</span><span class="n">unknowns</span><span class="p">)</span><span class="o">.</span><span class="n">as_signed_long</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"k1=</span><span class="si">{</span><span class="n">counter_example_k1</span><span class="si">}</span><span class="s2">, k2=</span><span class="si">{</span><span class="n">counter_example_k2</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"but </span><span class="si">{</span><span class="n">cond</span><span class="si">=}</span><span class="s2"> evaluates to </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">model</span><span class="p">())</span>
</pre></div>

<p>And then we can write proof-unit-tests like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_z3_abstract_invert</span><span class="p">():</span>
    <span class="n">solver</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">z3_setup_variables</span><span class="p">()</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_invert</span><span class="p">()</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="o">~</span><span class="n">n1</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">k2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n2</span><span class="p">),</span> <span class="n">solver</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_z3_abstract_and</span><span class="p">():</span>
    <span class="n">solver</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">z3_setup_variables</span><span class="p">()</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_and</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">&amp;</span> <span class="n">n2</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n3</span><span class="p">),</span> <span class="n">solver</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_z3_abstract_or</span><span class="p">():</span>
    <span class="n">solver</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">z3_setup_variables</span><span class="p">()</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_or</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">|</span> <span class="n">n2</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n3</span><span class="p">),</span> <span class="n">solver</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_z3_abstract_add</span><span class="p">():</span>
    <span class="n">solver</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">z3_setup_variables</span><span class="p">()</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_add</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n3</span><span class="p">),</span> <span class="n">solver</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_z3_abstract_sub</span><span class="p">():</span>
    <span class="n">solver</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">z3_setup_variables</span><span class="p">()</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_sub</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">-</span> <span class="n">n2</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n3</span><span class="p">),</span> <span class="n">solver</span><span class="p">)</span>
</pre></div>

<p>It's possible to write a bit more Python-metaprogramming-magic and unify the
Hypothesis and Z3 tests into the same test definition.<sup id="fnref:proof_bitwidths"><a class="footnote-ref" href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#fn:proof_bitwidths">1</a></sup></p>
<h3 id="cases-where-this-style-of-z3-proof-doesnt-work">Cases where this style of Z3 proof doesn't work</h3>
<p>Unfortunately the approach described in the previous section only works for a
very small number of cases. It breaks down as soon as the <code>KnownBits</code> methods
that we're calling contain any <code>if</code> conditions (including hidden ones like
the short-circuiting <code>and</code> and <code>or</code> in Python). Let's look at an example and
implement <code>abstract_eq</code>. <code>eq</code> is supposed to be an operation that compares two
integers and returns <code>0</code> or <code>1</code> if they are different or equal, respectively.
Implementing this in knownbits looks like this (with example and hypothesis
tests):</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">KnownBits</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">abstract_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># the result is a 0, 1, or ?</span>

        <span class="c1"># if they are both the same constant, they must be equal</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ones</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">ones</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># check whether we have known disagreeing bits, then we know the result</span>
        <span class="c1"># is 0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disagrees</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">KnownBits</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># an unknown boolean</span>

    <span class="k">def</span> <span class="nf">_disagrees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># check whether the bits disagree in any place where both are known</span>
        <span class="n">both_known</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">knowns</span> <span class="o">&amp;</span> <span class="n">other</span><span class="o">.</span><span class="n">knowns</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ones</span> <span class="o">&amp;</span> <span class="n">both_known</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">ones</span> <span class="o">&amp;</span> <span class="n">both_known</span>

<span class="k">def</span> <span class="nf">test_eq</span><span class="p">():</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'...?'</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="s1">'...?'</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">abstract_eq</span><span class="p">(</span><span class="n">k2</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'?'</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">abstract_eq</span><span class="p">(</span><span class="n">k1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'1'</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">abstract_eq</span><span class="p">(</span><span class="n">k2</span><span class="p">))</span> <span class="o">==</span> <span class="s1">'0'</span>

<span class="nd">@given</span><span class="p">(</span><span class="n">knownbits_and_contained_number</span><span class="p">,</span> <span class="n">knownbits_and_contained_number</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_hypothesis_eq</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">t1</span>
    <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">t2</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_eq</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n1</span> <span class="o">==</span> <span class="n">n2</span><span class="p">))</span>
</pre></div>

<p>Trying to do the proof in the same style as before breaks:</p>
<div class="code"><pre class="code literal-block"><span class="o">&gt;&gt;&gt;&gt;</span> <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_eq</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s2">"knownbits.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">246</span><span class="p">,</span> <span class="ow">in</span> <span class="n">abstract_eq</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disagrees</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">"venv/site-packages/z3/z3.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">381</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__bool__</span>
    <span class="k">raise</span> <span class="n">Z3Exception</span><span class="p">(</span><span class="s2">"Symbolic expressions cannot be cast to concrete Boolean values."</span><span class="p">)</span>
<span class="n">z3</span><span class="o">.</span><span class="n">z3types</span><span class="o">.</span><span class="n">Z3Exception</span><span class="p">:</span> <span class="n">Symbolic</span> <span class="n">expressions</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">cast</span> <span class="n">to</span> <span class="n">concrete</span> <span class="n">Boolean</span> <span class="n">values</span><span class="o">.</span>
</pre></div>

<p>We cannot call <code>abstract_eq</code> on a <code>KnownBits</code> with Z3 variables as fields,
because once we hit an <code>if</code> statement, the whole approach of relying on the
operator overloading breaks down. Z3 doesn't actually parse the Python code or
anything advanced like that, we rather build an expression only by running the
code and letting the Z3 formulas build up.</p>
<p>To still prove the correctness of <code>abstract_eq</code> we need to manually transform
the control flow logic of the function into a Z3 formula that uses the <code>z3.If</code>
expression, using a small helper function:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">z3_cond</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">trueval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">falseval</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">z3</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">BitVecVal</span><span class="p">(</span><span class="n">trueval</span><span class="p">),</span> <span class="n">BitVecVal</span><span class="p">(</span><span class="n">falseval</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">z3_abstract_eq</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">):</span>
    <span class="c1"># follow the *logic* of abstract_eq, we can't call it due to the ifs in it</span>
    <span class="n">case1cond</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">is_constant</span><span class="p">(),</span> <span class="n">k2</span><span class="o">.</span><span class="n">is_constant</span><span class="p">(),</span> <span class="n">k1</span><span class="o">.</span><span class="n">ones</span> <span class="o">==</span> <span class="n">k2</span><span class="o">.</span><span class="n">ones</span><span class="p">)</span>
    <span class="n">case2cond</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">_disagrees</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>

    <span class="c1"># ones is 1 in the first case, 0 otherwise</span>
    <span class="n">ones</span> <span class="o">=</span> <span class="n">z3_cond</span><span class="p">(</span><span class="n">case1cond</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># in the first two cases, unknowns is 0, 1 otherwise</span>
    <span class="n">unknowns</span> <span class="o">=</span> <span class="n">z3_cond</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span><span class="n">case1cond</span><span class="p">,</span> <span class="n">case2cond</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_z3_abstract_eq_logic</span><span class="p">():</span>
    <span class="n">solver</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">z3_setup_variables</span><span class="p">()</span>
    <span class="n">n3</span> <span class="o">=</span> <span class="n">z3_cond</span><span class="p">(</span><span class="n">n1</span> <span class="o">==</span> <span class="n">n2</span><span class="p">)</span> <span class="c1"># concrete result</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">z3_abstract_eq</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">n3</span><span class="p">),</span> <span class="n">solver</span><span class="p">)</span>
</pre></div>

<p>This proof works. It is a lot less satisfying than the previous ones though,
because we could have done an error in the manual transcription from Python code
to Z3 formulas (there are possibly more heavy-handed approaches where we do
this transformation more automatically using e.g. the <code>ast</code> module to analyze
the source code, but that's a much more complicated researchy project). To
lessen this problem somewhat we can factor out the parts of the logic that don't
have any conditions into small helper methods (like <code>_disagrees</code> in this
example) and use them in the manual conversion of the code to Z3 formulas.<sup id="fnref:tests_vs_proofs"><a class="footnote-ref" href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#fn:tests_vs_proofs">2</a></sup></p>
<p>The final condition that Z3 checks, btw, is this one:</p>
<div class="code"><pre class="code literal-block">If(n1 == n2, 1, 0) &amp;
~If(Or(And(n1_unkowns == 0,
           n2_unkowns == 0,
           n1_ones == n2_ones),
       n1_ones &amp; ~n1_unkowns &amp; ~n2_unkowns !=
       n2_ones &amp; ~n1_unkowns &amp; ~n2_unkowns),
    0, 1) ==
If(And(n1_unkowns == 0, n2_unkowns == 0, n1_ones == n2_ones),
   1, 0)
</pre></div>

<h3 id="making-statements-about-precision">Making Statements about Precision</h3>
<p>So far we have only used Z3 to prove statements about correctness, i.e. that
our abstract operations overapproximate what can happen with concrete values.
While proving this property is essential if we want to avoid miscompilation,
correctness alone is not a very strong constraint on the implementation of our
abstract transfer functions. We could simply return <code>Knownbits.unknowns()</code> for
every <code>abstract_*</code> method and the resulting overapproximation would be correct,
but useless in practice.</p>
<p>It's much harder to make statements about whether the transfer functions are
maximally precise. There are two aspects of precision I want to discuss in this
section, however.</p>
<p>The first aspect is that we would really like it if the transfer functions
compute the maximally precise results for singleton sets. If all abstract
arguments of an operations are constants, i.e. contain only a single concrete
element, then we know that the resulting set also has only a single element. We
can prove that all our transfer functions have this property:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_z3_prove_constant_folding</span><span class="p">():</span>
    <span class="n">solver</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">z3_setup_variables</span><span class="p">()</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_invert</span><span class="p">()</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Implies</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">is_constant</span><span class="p">(),</span>
                     <span class="n">k3</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()),</span> <span class="n">solver</span><span class="p">)</span>

    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_and</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Implies</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">is_constant</span><span class="p">(),</span> <span class="n">k2</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()),</span>
                     <span class="n">k3</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()),</span> <span class="n">solver</span><span class="p">)</span>

    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_or</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Implies</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">is_constant</span><span class="p">(),</span> <span class="n">k2</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()),</span>
                     <span class="n">k3</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()),</span> <span class="n">solver</span><span class="p">)</span>

    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_sub</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Implies</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">is_constant</span><span class="p">(),</span> <span class="n">k2</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()),</span>
                     <span class="n">k3</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()),</span> <span class="n">solver</span><span class="p">)</span>

    <span class="n">k3</span> <span class="o">=</span> <span class="n">z3_abstract_eq</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Implies</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">is_constant</span><span class="p">(),</span> <span class="n">k2</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()),</span>
                     <span class="n">k3</span><span class="o">.</span><span class="n">is_constant</span><span class="p">()),</span> <span class="n">solver</span><span class="p">)</span>
</pre></div>

<p>Proving with Z3 that the transfer functions are maximally precise for
non-constant arguments seems to be relatively hard. I tried a few completely
rigorous approaches and failed. The paper <a href="https://arxiv.org/pdf/2105.05398">Sound, Precise, and Fast Abstract
Interpretation with Tristate Numbers</a>
contains an optimality proof for the transfer functions of addition and
subtraction, so we can be certain that they are as precise as is
possible.</p>
<p>I still want to show an approach for trying to find concrete examples of
abstract values that are less precise than they could be, using a combination
of Hypothesis and Z3. The idea is to use hypothesis to pick random abstract
values. Then we compute the abstract result using our transfer function.
Afterwards we can ask Z3 to find us an abstract result that is better than the
one our transfer function produced. If Z3 finds a better abstract result, we
have a concrete example of imprecision for our transfer function. Those tests
aren't strict proofs, because they rely on generating random abstract values,
but they can still be valuable (not for the transfer functions in this blog
post, which are all optimal).</p>
<p>Here is what the code looks like (this is a little bit bonus content, I'll not
explain the details and can only hope that the comments are somewhat helpful):</p>
<div class="code"><pre class="code literal-block"><span class="nd">@given</span><span class="p">(</span><span class="n">random_knownbits_and_contained_number</span><span class="p">,</span> <span class="n">random_knownbits_and_contained_number</span><span class="p">)</span>
<span class="nd">@settings</span><span class="p">(</span><span class="n">deadline</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_check_precision</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">):</span>
    <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">t1</span>
    <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">t2</span>
    <span class="c1"># apply transfer function</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">k1</span><span class="o">.</span><span class="n">abstract_add</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
    <span class="n">example_res</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span>

    <span class="c1"># try to find a better version of k3 with Z3</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">z3</span><span class="o">.</span><span class="n">Solver</span><span class="p">()</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">"timeout"</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>

    <span class="n">var1</span> <span class="o">=</span> <span class="n">BitVec</span><span class="p">(</span><span class="s1">'v1'</span><span class="p">)</span>
    <span class="n">var2</span> <span class="o">=</span> <span class="n">BitVec</span><span class="p">(</span><span class="s1">'v2'</span><span class="p">)</span>

    <span class="n">ones</span> <span class="o">=</span> <span class="n">BitVec</span><span class="p">(</span><span class="s1">'ones'</span><span class="p">)</span>
    <span class="n">unknowns</span> <span class="o">=</span> <span class="n">BitVec</span><span class="p">(</span><span class="s1">'unknowns'</span><span class="p">)</span>
    <span class="n">better_k3</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">ones</span><span class="p">,</span> <span class="n">unknowns</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">)</span>

    <span class="c1"># we're trying to find an example for a better k3, so we use check, without</span>
    <span class="c1"># negation:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span>
        <span class="c1"># better_k3 should be a valid knownbits instance</span>
        <span class="n">better_k3</span><span class="o">.</span><span class="n">is_well_formed</span><span class="p">(),</span>
        <span class="c1"># it should be better than k3, ie there are known bits in better_k3</span>
        <span class="c1"># that we don't have in k3</span>
        <span class="n">better_k3</span><span class="o">.</span><span class="n">knowns</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">k3</span><span class="o">.</span><span class="n">knowns</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="c1"># now encode the correctness condition for better_k3 with a ForAll:</span>
        <span class="c1"># for all concrete values var1 and var2, it must hold that if</span>
        <span class="c1"># var1 is in k1 and var2 is in k2 it follows that var1 + var2 is in</span>
        <span class="c1"># better_k3</span>
        <span class="n">z3</span><span class="o">.</span><span class="n">ForAll</span><span class="p">(</span>
        <span class="p">[</span><span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">],</span>
        <span class="n">z3</span><span class="o">.</span><span class="n">Implies</span><span class="p">(</span>
            <span class="n">z3</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">var1</span><span class="p">),</span> <span class="n">k2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">var2</span><span class="p">)),</span>
            <span class="n">better_k3</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">var1</span> <span class="o">+</span> <span class="n">var2</span><span class="p">)))))</span>
    <span class="c1"># if this query is satisfiable, we have found a better result for the</span>
    <span class="c1"># abstract_add</span>
    <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">z3</span><span class="o">.</span><span class="n">sat</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
        <span class="n">rk3</span> <span class="o">=</span> <span class="n">KnownBits</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">ones</span><span class="p">)</span><span class="o">.</span><span class="n">as_signed_long</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">unknowns</span><span class="p">)</span><span class="o">.</span><span class="n">as_signed_long</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"better"</span><span class="p">,</span> <span class="n">rk3</span><span class="p">)</span>
        <span class="k">assert</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">z3</span><span class="o">.</span><span class="n">unknown</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"timeout"</span><span class="p">)</span>
</pre></div>

<p>It does not actually fail for <code>abstract_add</code> (nor the other abstract
functions). To see the test failing we can add some imprecision to the
implementation of <code>abstract_add</code> to see Hypothesis and Z3 find examples of
values that are not optimally precise (for example by setting some bits
of <code>unknowns</code> in the implementation of <code>abstract_add</code> unconditionally).</p>
<h3 id="using-the-abstract-domain-in-the-toy-optimizer-for-generalized-constant-folding">Using the Abstract Domain in the Toy Optimizer for Generalized Constant Folding</h3>
<p>Now after all this work we can finally actually use the knownbits abstract
domain in the toy optimizer. The code for this follows <a href="https://bernsteinbear.com/blog/toy-abstract-interpretation/">Max' intro post about
abstract interpretation</a>
quite closely.</p>
<p>For completeness sake, in the fold there's the basic infrastructure classes
that make up the IR again (they are identical or at least extremely close to
the previous toy posts).</p>
<details>
toy infrastructure

<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">Value</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"abstract"</span><span class="p">)</span>


<span class="nd">@dataclass</span><span class="p">(</span><span class="n">eq</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Operation</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
    <span class="n">name</span> <span class="p">:</span> <span class="nb">str</span>
    <span class="n">args</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Value</span><span class="p">]</span>

    <span class="n">forwarded</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Value</span><span class="p">:</span>
        <span class="n">op</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">Operation</span><span class="p">):</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">forwarded</span>
            <span class="k">if</span> <span class="nb">next</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">op</span>
            <span class="n">op</span> <span class="o">=</span> <span class="nb">next</span>
        <span class="k">return</span> <span class="n">op</span>

    <span class="k">def</span> <span class="nf">arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">make_equal_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="n">Value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">()</span><span class="o">.</span><span class="n">forwarded</span> <span class="o">=</span> <span class="n">value</span>


<span class="nd">@dataclass</span><span class="p">(</span><span class="n">eq</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Constant</span><span class="p">(</span><span class="n">Value</span><span class="p">):</span>
    <span class="n">value</span> <span class="p">:</span> <span class="nb">object</span>

    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="k">class</span> <span class="nc">Block</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opname</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wraparg</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Value</span><span class="p">):</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">arg</span>
        <span class="k">def</span> <span class="nf">make_op</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">op</span> <span class="o">=</span> <span class="n">Operation</span><span class="p">(</span><span class="n">opname</span><span class="p">,</span>
                <span class="p">[</span><span class="n">wraparg</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">op</span>
        <span class="k">return</span> <span class="n">make_op</span>


<span class="k">def</span> <span class="nf">bb_to_str</span><span class="p">(</span><span class="n">l</span> <span class="p">:</span> <span class="n">Block</span><span class="p">,</span> <span class="n">varprefix</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"var"</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">arg_to_str</span><span class="p">(</span><span class="n">arg</span> <span class="p">:</span> <span class="n">Value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Constant</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">varnames</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span>

    <span class="n">varnames</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="c1"># give the operation a name used while</span>
        <span class="c1"># printing:</span>
        <span class="n">var</span> <span class="o">=</span>  <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">varprefix</span><span class="si">}{</span><span class="n">index</span><span class="si">}</span><span class="s2">"</span>
        <span class="n">varnames</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">=</span> <span class="n">var</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">arg_to_str</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">args</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">strop</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">arguments</span><span class="si">}</span><span class="s2">)"</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strop</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>



</details>

<p>Now we can write some first tests, the first one simply checking constant
folding:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_constfold_two_ops</span><span class="p">():</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">Block</span><span class="p">()</span>
    <span class="n">var0</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">getarg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">var1</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">var2</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_add</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">var3</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_add</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span> <span class="n">var0</span><span class="p">)</span>

    <span class="n">opt_bb</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">bb_to_str</span><span class="p">(</span><span class="n">opt_bb</span><span class="p">,</span> <span class="s2">"optvar"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"""</span><span class="se">\</span>
<span class="s2">optvar0 = getarg(0)</span>
<span class="s2">optvar1 = int_add(19, optvar0)"""</span>
</pre></div>

<p>Calling the transfer functions on constant <code>KnownBits</code> produces a constant
results, as we have seen. Therefore "regular" constant folding should hopefully
be achieved by optimizing with the <code>KnownBits</code> abstract domain too.</p>
<p>The next two tests are slightly more complicated and can't be optimized by
regular constant-folding. They follow the motivating examples from the start of
this blog post, a hundred years ago:</p>
<div class="code"><pre class="code literal-block"><span class="n">def</span><span class="w"> </span><span class="n">test_constfold_via_knownbits</span><span class="p">():</span>
<span class="w">    </span><span class="n">bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Block</span><span class="p">()</span>
<span class="w">    </span><span class="n">var0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">getarg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">int_or</span><span class="p">(</span><span class="n">var0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">var2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">int_and</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="n">var3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">dummy</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span>

<span class="w">    </span><span class="n">opt_bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">simplify</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
<span class="w">    </span><span class="nb">assert</span><span class="w"> </span><span class="n">bb_to_str</span><span class="p">(</span><span class="n">opt_bb</span><span class="p">,</span><span class="w"> </span><span class="s2">"optvar"</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"""</span><span class="se">\</span>
<span class="s2">optvar0 = getarg(0)</span>
<span class="s2">optvar1 = int_or(optvar0, 1)</span>
<span class="s2">optvar2 = dummy(1)"""</span>

<span class="n">def</span><span class="w"> </span><span class="n">test_constfold_alignment_check</span><span class="p">():</span>
<span class="w">    </span><span class="n">bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Block</span><span class="p">()</span>
<span class="w">    </span><span class="n">var0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">getarg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">var1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">int_invert</span><span class="p">(</span><span class="mi">0</span><span class="n">b111</span><span class="p">)</span>
<span class="w">    </span><span class="c1"># mask off the lowest three bits, thus var2 is aligned</span>
<span class="w">    </span><span class="n">var2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">int_and</span><span class="p">(</span><span class="n">var0</span><span class="p">,</span><span class="w"> </span><span class="n">var1</span><span class="p">)</span>
<span class="w">    </span><span class="c1"># add 16 to aligned quantity</span>
<span class="w">    </span><span class="n">var3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">int_add</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span>
<span class="w">    </span><span class="c1"># check alignment of result</span>
<span class="w">    </span><span class="n">var4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">int_and</span><span class="p">(</span><span class="n">var3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">b111</span><span class="p">)</span>
<span class="w">    </span><span class="n">var5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">int_eq</span><span class="p">(</span><span class="n">var4</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="c1"># var5 should be const-folded to 1</span>
<span class="w">    </span><span class="n">var6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bb</span><span class="o">.</span><span class="n">dummy</span><span class="p">(</span><span class="n">var5</span><span class="p">)</span>

<span class="w">    </span><span class="n">opt_bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">simplify</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
<span class="w">    </span><span class="nb">assert</span><span class="w"> </span><span class="n">bb_to_str</span><span class="p">(</span><span class="n">opt_bb</span><span class="p">,</span><span class="w"> </span><span class="s2">"optvar"</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"""</span><span class="se">\</span>
<span class="s2">optvar0 = getarg(0)</span>
<span class="s2">optvar1 = int_and(optvar0, -8)</span>
<span class="s2">optvar2 = int_add(optvar1, 16)</span>
<span class="s2">optvar3 = dummy(1)"""</span>
</pre></div>

<p>Here is <code>simplify</code> to make these tests pass:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">unknown_transfer_functions</span><span class="p">(</span><span class="o">*</span><span class="n">abstract_args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">all_unknown</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="n">bb</span><span class="p">:</span> <span class="n">Block</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Block</span><span class="p">:</span>
    <span class="n">abstract_values</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># dict mapping Operation to KnownBits</span>

    <span class="k">def</span> <span class="nf">knownbits_of</span><span class="p">(</span><span class="n">val</span> <span class="p">:</span> <span class="n">Value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Constant</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">KnownBits</span><span class="o">.</span><span class="n">from_constant</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">abstract_values</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>

    <span class="n">opt_bb</span> <span class="o">=</span> <span class="n">Block</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">bb</span><span class="p">:</span>
        <span class="c1"># apply the transfer function on the abstract arguments</span>
        <span class="n">name_without_prefix</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s2">"int_"</span><span class="p">)</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"abstract_</span><span class="si">{</span><span class="n">name_without_prefix</span><span class="si">}</span><span class="s2">"</span>
        <span class="n">transfer_function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">KnownBits</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">unknown_transfer_functions</span><span class="p">)</span>
        <span class="n">abstract_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">knownbits_of</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">find</span><span class="p">())</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="n">abstract_res</span> <span class="o">=</span> <span class="n">abstract_values</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">=</span> <span class="n">transfer_function</span><span class="p">(</span><span class="o">*</span><span class="n">abstract_args</span><span class="p">)</span>
        <span class="c1"># if the result is a constant, we optimize the operation away and make</span>
        <span class="c1"># it equal to the constant result</span>
        <span class="k">if</span> <span class="n">abstract_res</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
            <span class="n">op</span><span class="o">.</span><span class="n">make_equal_to</span><span class="p">(</span><span class="n">Constant</span><span class="p">(</span><span class="n">abstract_res</span><span class="o">.</span><span class="n">ones</span><span class="p">))</span>
            <span class="k">continue</span>
        <span class="c1"># otherwise emit the op</span>
        <span class="n">opt_bb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">opt_bb</span>
</pre></div>

<p>The code follows the approach from the previous blog post very closely. The
only difference is that we apply the transfer function <em>first</em>, to be able to
detect whether the abstract domain can tell us that the result has to always be
a constant. This code makes all three tests pass.</p>
<h3 id="using-the-knownbits-domain-for-conditional-peephole-rewrites">Using the <code>KnownBits</code> Domain for Conditional Peephole Rewrites</h3>
<p>So far we are only using the <code>KnownBits</code> domain to find out that certain
operations have to produce a constant. We can also use the <code>KnownBits</code> domain
to check whether certain operation rewrites are correct. Let's use one of the
examples from the <a href="https://www.pypy.org/posts/2024/07/mining-jit-traces-missing-optimizations-z3.html">Mining JIT traces for missing optimizations with
Z3</a>
post, where Z3 found the inefficiency <code>(x &lt;&lt; 4) &amp; -0xf == x &lt;&lt; 4</code> in PyPy JIT
traces. We don't have shift operations, but we want to generalize this optimization
anyway. The general form of this rewrite is that under some circumstances <code>x &amp;
y == x</code>, and we can use the <code>KnownBits</code> domain to detect situations where this
must be true.</p>
<p>To understand <em>when</em> <code>x &amp; y == x</code> is true, we can think about individual pairs of
bits <code>a</code> and <code>b</code>. If <code>a == 0</code>, then <code>a &amp; b == 0 &amp; b == 0 == a</code>. If <code>b == 1</code>
then <code>a &amp; b == a &amp; 1 == a</code>. So if either <code>a == 0</code> or <code>b == 1</code> is true,
<code>a &amp; b == a</code> follows. And if either of these conditions is true for <em>all</em> the
bits of <code>x</code> and <code>y</code>, we can know that <code>x &amp; y == x</code>.</p>
<p>We can write a method on <code>KnownBits</code> to check for this condition:</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span> <span class="nc">KnownBits</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">is_and_identity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">""" Return True if n1 &amp; n2 == n1 for any n1 in self and n2 in other.</span>
<span class="sd">        (or, equivalently, return True if n1 | n2 == n2)"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeros</span> <span class="o">|</span> <span class="n">other</span><span class="o">.</span><span class="n">ones</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>

<p>Since my reasoning about this feels ripe for errors, let's check that our
understanding is correct with Z3:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_prove_is_and_identity</span><span class="p">():</span>
    <span class="n">solver</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">z3_setup_variables</span><span class="p">()</span>
    <span class="n">prove</span><span class="p">(</span><span class="n">z3</span><span class="o">.</span><span class="n">Implies</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">is_and_identity</span><span class="p">(</span><span class="n">k2</span><span class="p">),</span> <span class="n">n1</span> <span class="o">&amp;</span> <span class="n">n2</span> <span class="o">==</span> <span class="n">n1</span><span class="p">),</span> <span class="n">solver</span><span class="p">)</span>
</pre></div>

<p>Now let's use this in the toy optimizer. Here are two tests for this rewrite:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_remove_redundant_and</span><span class="p">():</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">Block</span><span class="p">()</span>
    <span class="n">var0</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">getarg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">var1</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_invert</span><span class="p">(</span><span class="mb">0b1111</span><span class="p">)</span>
    <span class="c1"># mask off the lowest four bits</span>
    <span class="n">var2</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_and</span><span class="p">(</span><span class="n">var0</span><span class="p">,</span> <span class="n">var1</span><span class="p">)</span>
    <span class="c1"># applying the same mask is not redundant</span>
    <span class="n">var3</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_and</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span> <span class="n">var1</span><span class="p">)</span>
    <span class="n">var4</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">dummy</span><span class="p">(</span><span class="n">var3</span><span class="p">)</span>

    <span class="n">opt_bb</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">bb_to_str</span><span class="p">(</span><span class="n">opt_bb</span><span class="p">,</span> <span class="s2">"optvar"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"""</span><span class="se">\</span>
<span class="s2">optvar0 = getarg(0)</span>
<span class="s2">optvar1 = int_and(optvar0, -16)</span>
<span class="s2">optvar2 = dummy(optvar1)"""</span>

<span class="k">def</span> <span class="nf">test_remove_redundant_and_more_complex</span><span class="p">():</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">Block</span><span class="p">()</span>
    <span class="n">var0</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">getarg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">var1</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">getarg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># var2 has bit pattern ????</span>
    <span class="n">var2</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_and</span><span class="p">(</span><span class="n">var0</span><span class="p">,</span> <span class="mb">0b1111</span><span class="p">)</span>
    <span class="c1"># var3 has bit pattern ...?1111</span>
    <span class="n">var3</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_or</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="mb">0b1111</span><span class="p">)</span>
    <span class="c1"># var4 is just var2</span>
    <span class="n">var4</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_and</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span> <span class="n">var3</span><span class="p">)</span>
    <span class="n">var5</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">dummy</span><span class="p">(</span><span class="n">var4</span><span class="p">)</span>

    <span class="n">opt_bb</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">bb_to_str</span><span class="p">(</span><span class="n">opt_bb</span><span class="p">,</span> <span class="s2">"optvar"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"""</span><span class="se">\</span>
<span class="s2">optvar0 = getarg(0)</span>
<span class="s2">optvar1 = getarg(1)</span>
<span class="s2">optvar2 = int_and(optvar0, 15)</span>
<span class="s2">optvar3 = int_or(optvar1, 15)</span>
<span class="s2">optvar4 = dummy(optvar2)"""</span>
</pre></div>

<p>The first test could also be made to pass by implementing a reassociation
optimization that turns <code>(x &amp; c1) &amp; c2</code> into <code>x &amp; (c1 &amp; c2)</code> and then constant-folds the second <code>and</code>. But here we want to
use <code>KnownBits</code> and conditionally rewrite <code>int_and</code> to its first argument. So to make the tests pass,
we can change <code>simplify</code> like this:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="n">bb</span><span class="p">:</span> <span class="n">Block</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Block</span><span class="p">:</span>
    <span class="n">abstract_values</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># dict mapping Operation to KnownBits</span>

    <span class="k">def</span> <span class="nf">knownbits_of</span><span class="p">(</span><span class="n">val</span> <span class="p">:</span> <span class="n">Value</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="n">opt_bb</span> <span class="o">=</span> <span class="n">Block</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">bb</span><span class="p">:</span>
        <span class="c1"># apply the transfer function on the abstract arguments</span>
        <span class="n">name_without_prefix</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s2">"int_"</span><span class="p">)</span>
        <span class="n">method_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"abstract_</span><span class="si">{</span><span class="n">name_without_prefix</span><span class="si">}</span><span class="s2">"</span>
        <span class="n">transfer_function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">KnownBits</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">unknown_transfer_functions</span><span class="p">)</span>
        <span class="n">abstract_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">knownbits_of</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">find</span><span class="p">())</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">op</span><span class="o">.</span><span class="n">args</span><span class="p">]</span>
        <span class="n">abstract_res</span> <span class="o">=</span> <span class="n">abstract_values</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">=</span> <span class="n">transfer_function</span><span class="p">(</span><span class="o">*</span><span class="n">abstract_args</span><span class="p">)</span>
        <span class="c1"># if the result is a constant, we optimize the operation away and make</span>
        <span class="c1"># it equal to the constant result</span>
        <span class="k">if</span> <span class="n">abstract_res</span><span class="o">.</span><span class="n">is_constant</span><span class="p">():</span>
            <span class="n">op</span><span class="o">.</span><span class="n">make_equal_to</span><span class="p">(</span><span class="n">Constant</span><span class="p">(</span><span class="n">abstract_res</span><span class="o">.</span><span class="n">ones</span><span class="p">))</span>
            <span class="k">continue</span>
        <span class="c1"># &lt;&lt;&lt;&lt; new code</span>
        <span class="c1"># conditionally rewrite int_and(x, y) to x</span>
        <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"int_and"</span><span class="p">:</span>
            <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span> <span class="o">=</span> <span class="n">abstract_args</span>
            <span class="k">if</span> <span class="n">k1</span><span class="o">.</span><span class="n">is_and_identity</span><span class="p">(</span><span class="n">k2</span><span class="p">):</span>
                <span class="n">op</span><span class="o">.</span><span class="n">make_equal_to</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">continue</span>
        <span class="c1"># &gt;&gt;&gt;&gt; end changes</span>
        <span class="n">opt_bb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">opt_bb</span>
</pre></div>

<p>And with that, the new tests pass as well. A real implementation would also
check the other argument order, but we leave that out for the sake of brevity.</p>
<p>This rewrite also generalizes the <a href="https://pypy.org/posts/2024/07/finding-simple-rewrite-rules-jit-z3.html">rewrites</a> <code>int_and(0, x) -&gt; 0</code> and
<code>int_and(-1, x) -&gt; x</code>, let's add a test for those:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span> <span class="nf">test_remove_and_simple</span><span class="p">():</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">Block</span><span class="p">()</span>
    <span class="n">var0</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">getarg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">var1</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">getarg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">var2</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_and</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">var0</span><span class="p">)</span> <span class="c1"># == 0</span>
    <span class="n">var3</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_invert</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span> <span class="c1"># == -1</span>
    <span class="n">var4</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">int_and</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span> <span class="n">var3</span><span class="p">)</span> <span class="c1"># == var1</span>
    <span class="n">var5</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="n">dummy</span><span class="p">(</span><span class="n">var4</span><span class="p">)</span>

    <span class="n">opt_bb</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">bb_to_str</span><span class="p">(</span><span class="n">opt_bb</span><span class="p">,</span> <span class="s2">"optvar"</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"""</span><span class="se">\</span>
<span class="s2">optvar0 = getarg(0)</span>
<span class="s2">optvar1 = getarg(1)</span>
<span class="s2">optvar2 = dummy(optvar1)"""</span>
</pre></div>

<p>This test just passes. And that's it for this post!</p>
<h3 id="conclusion">Conclusion</h3>
<p>In this post we've seen the implementation, testing and proofs about a 'known
bits' abstract domain, as well as its use in the toy optimizer to generalize
constant folding, and to implement conditional peephole rewrites.</p>
<p>In the next posts I'll write about the real implementation of a knownbits
domain in PyPy's JIT, its combination with the existing interval abstract
domain, how to deal with gaining information from conditions in the program,
and some lose ends.</p>
<p>Sources:</p>
<ul>
<li><a href="https://github.com/llvm/llvm-project/blob/main/llvm/lib/Support/KnownBits.cpp">Known bits in LLVM</a></li>
<li><a href="https://github.com/torvalds/linux/blob/master/kernel/bpf/tnum.c">Tristate numbers for known bits in Linux eBPF</a></li>
<li><a href="https://arxiv.org/abs/2105.05398">Sound, Precise, and Fast Abstract Interpretation with Tristate Numbers</a></li>
<li><a href="https://people.cs.rutgers.edu/~sn349/papers/agni-cav2023.pdf">Verifying the Veriï¬er: eBPF Range Analysis Veriï¬cation</a></li>
<li><a href="https://dougallj.wordpress.com/2020/01/13/bit-twiddling-addition-with-unknown-bits/">Bit-Twiddling: Addition with Unknown
  Bits</a>
  is a super readable blog post by Dougall J. I've taken the <code>ones</code> and
  <code>unknowns</code> naming from this post, which I find significantly clearer than
  <code>value</code> and <code>mask</code>, which the Linux kernel uses.</li>
<li><a href="https://bitmath.blogspot.com/">Bits, Math and Performance(?)</a>, a fantastic
  blog by <a href="https://mastodon.gamedev.place/@harold">Harold Aptroot</a>. There are a
  lot of relevant posts about known bits, range analysis etc. Harold is also
  the author of <a href="http://haroldbot.nl/">Haroldbot</a>, a website that can be used
  for bitvector calculations, and also checks bitvector identities.</li>
<li><a href="https://cea.hal.science/cea-01795779/document">Sharpening Constraint Programming approaches for Bit-Vector Theory</a></li>
<li><a href="https://users.cs.utah.edu/~regehr/papers/lctes06_2/fp019-regehr.pdf">Deriving Abstract Transfer Functions for Analyzing Embedded Software</a></li>
<li><a href="https://arxiv.org/abs/2105.00493">Synthesizing Abstract Transformers</a></li>
</ul>
<div class="footnote">
<hr />
<ol>
<li id="fn:proof_bitwidths">
<p>There's a subtletly about the Z3 proofs that I'm sort of
glossing over here. Python integers are of arbitrary width, and the
<code>KnownBits</code> code is actually carefully written to work for integers of any
size. This property is tested by the Hypothesis tests, which don't limit
the sizes of the generated random integers. However, the Z3 proofs only
check bitvectors of a fixed bitwidth of 64. There are various ways to deal
with this situation. For most "real" compilers, the bitwidth of integers
would be fixed anyway. Then the components <code>ones</code> and <code>unknowns</code> of the
<code>KnownBits</code> class would use the number of bits the corresponding integer
variable has, and the Z3 proofs would use the same width. This is what we
do in the PyPy JIT.Â <a class="footnote-backref" href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#fnref:proof_bitwidths" title="Jump back to footnote 1 in the text">â©</a></p>
</li>
<li id="fn:tests_vs_proofs">
<p>The less close connection between implementation and proof
for <code>abstract_eq</code> is one of the reasons why it makes sense to do
unit-testing <em>in addition</em> to proofs. For a more detailed explanation of
why both tests and proofs are good to
have, see <a href="https://siek.blogspot.com/2024/06/data-structures-and-algorithms-correctly.html#correct-software-via-write-test-and-prove:~:text=We%20recognize%20that%20once%20step,detect%20most%20of%20the%20bugs">Jeremy Siek's blog
post</a>,
as well as the <a href="https://www-cs-faculty.stanford.edu/~knuth/faq.html#:~:text=What's%20the%20exact%20citation%20of%20your%20oft%2Dcited%20comment%20about%20bugs?">Knuth
quote</a>.Â <a class="footnote-backref" href="https://www.pypy.org/posts/2024/08/toy-knownbits.html#fnref:tests_vs_proofs" title="Jump back to footnote 2 in the text">â©</a></p>
</li>
</ol>
</div>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on August 03, 2024 02:00 PM UTC by
            <a href="https://www.pypy.org/rss.xml" class="link link-hover text-primary"
              >PyPy</a
            >
          </div>
          <a
            href="https://www.pypy.org/posts/2024/08/toy-knownbits.html"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://realpython.com/podcasts/rpp/215/" class="hover:underline"
              >The Real Python Podcast â Episode #215: Using GraphQL in Django With Strawberry & Prototype Purgatory</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            How do you integrate GraphQL into your Python web development? How about quickly building graph-based APIs inside Django's battery-included framework? Christopher Trudeau is back on the show this week, bringing another batch of PyCoder's Weekly articles and projects.
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on August 02, 2024 12:00 PM UTC by
            <a href="https://realpython.com/atom.xml" class="link link-hover text-primary"
              >Real Python</a
            >
          </div>
          <a
            href="https://realpython.com/podcasts/rpp/215/"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://talkpython.fm/episodes/show/473/being-a-developer-with-adhd" class="hover:underline"
              >#473: Being a developer with ADHD</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            Do you feel like ADHD is holding you back? Maybe you don't personally have ADHD but you work with folks who do and you'd like to support them better. Either way, how ADHD interplays with programming and programmers is pretty fascinating. On this episode we have Chris Ferdinandi who himself has ADHD and has written a lot about it to share his journey and his advice for thriving with ADHD as a programmer or data scientist.
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on August 02, 2024 08:00 AM UTC by
            <a href="http://www.talkpythontome.com/episodes/rss" class="link link-hover text-primary"
              >Talk Python to Me</a
            >
          </div>
          <a
            href="https://talkpython.fm/episodes/show/473/being-a-developer-with-adhd"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://treyhunner.com/2024/08/why-does-python-m-json-not-work/" class="hover:underline"
              >Why does "python -m json" not work? Why is it "json.tool"?</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p><strong>Update</strong>: upon the encouragement of a few CPython core team members, I <a href="https://github.com/python/cpython/pull/122884">opened a pull request</a> to add this to Python 3.14.</p>

<p>Have you ever used Python&rsquo;s <code>json.tool</code> command-line interface?</p>

<p>You can run <code>python -m json.tool</code> against a JSON file and Python will print a nicely formatted version of the file.</p>

<figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">python -m json.tool example.json
</span><span class="line"><span class="o">[</span>
</span><span class="line">    1,
</span><span class="line">    2,
</span><span class="line">    3,
</span><span class="line">    4
</span><span class="line"><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Why do we need to run <code>json.tool</code> instead of <code>json</code>?</p>

<h2>The history of <code>python -m</code></h2>

<p>Python 3.5 added the ability to run a module as a command-line script using the <code>-m</code> argument (see <a href="https://peps.python.org/pep-0338/">PEP 338</a>) which was implemented in Python 2.5.
While that feature was being an additional feature/bug was accidentally added, alowing packages to be run with the <code>-m</code> flag as well.
When a package was run with the <code>-m</code> flag, the package&rsquo;s <code>__init__.py</code> file would be run, with the <code>__name__</code> variable set to <code>__main__</code>.</p>

<p>This accidental feature/bug was <a href="https://github.com/python/cpython/issues/47000">removed in Python 2.6</a>.</p>

<p>It wasn&rsquo;t until Python 2.7 that the ability to run <code>python -m package</code> was re-added (see below).</p>

<h2>The history of the <code>json</code> module</h2>

<p>The <code>json</code> module was <a href="https://docs.python.org/3/whatsnew/2.6.html#the-json-module-javascript-object-notation">added in Python 2.6</a>.
It was based on the third-party <code>simplejson</code> library.</p>

<p>That library originally relied on the fact that Python packages could be run with the <code>-m</code> flag to run the package&rsquo;s <code>__init__.py</code> file with <code>__name__</code> set to <code>__main__</code> (see <a href="https://github.com/simplejson/simplejson/blob/v1.8.1/simplejson/__init__.py#L368">this code from version 1.8.1</a>).</p>

<p>When <code>simplejson</code> was added to Python as the <code>json</code> module in Python 2.6, this bug/feature could no longer be relied upon as it was fixed in Python 2.6.
To continue allowing for a nice command-line interface, it was decided that running a <code>tool</code> submodule would be the way to add a command-line interface to the <code>json</code> package (<a href="https://github.com/simplejson/simplejson/commit/74d9c5c4c4339db47dfa86bf37858cae80ed3776">discussion here</a>).</p>

<p>Python 2.7 <a href="https://docs.python.org/2.7/using/cmdline.html?highlight=__main__#cmdoption-m">added the ability to run any package as a command-line tool</a>.
The package would simply need a <code>__main__.py</code> file within it, which Python would run as the entry point to the package.</p>

<p>At this point, <code>json.tool</code> had already been added in Python 2.6 and no attempt was made (as far as I can tell) to allow <code>python -m json</code> to work instead.
Once you&rsquo;ve added a feature, removing or changing it can be painful.</p>

<h2>Could we make <code>python -m json</code> work today?</h2>

<p>We could.
We would just need to <a href="https://github.com/treyhunner/cpython/commit/1226315e2df0d4229558734d5f0d50f1386a025e">rename <code>tool.py</code> to <code>__main__.py</code></a>.
To allow <code>json.tool</code> to still work <em>also</em>, would could <a href="https://github.com/python/cpython/commit/7ce95d21886c7ad5278c07c1a20cda5bebab4731">make a new <code>tool.py</code> module</a> that simply imports <code>json.__main__</code>.</p>

<p>We could even go so far as to <a href="https://github.com/treyhunner/cpython/commit/ae4ca62346c690e1c6aaf1ccfed37069984b5d67">deprecate <code>json.tool</code></a> if we wanted to.</p>

<p>Should we do this though? ð¤</p>

<h2>Should we make <code>python -m json</code> work?</h2>

<p>I don&rsquo;t know about you, but I would rather type <code>python -m json</code> than <code>python -m json.tool</code>.
It&rsquo;s more memorable <em>and</em> easier to guess, if you&rsquo;re not someone who has memorized <a href="https://www.pythonmorsels.com/cli-tools/">all the command-line tools hiding in Python</a>.</p>

<p>But would this actually be used?
I mean, don&rsquo;t people just use the <a href="https://jqlang.github.io/jq/">jq</a> tool instead?</p>

<p>Well, a <code>sqlite3</code> shell was <a href="https://docs.python.org/3/library/sqlite3.html#command-line-interface">added to Python 3.12</a> despite the fact that third-party interactive sqlite prompts are fairly common.</p>

<p>It is pretty handy to have a access to a tool within an unfamiliar environment where installing yet-another-tool might pose a problem.
Think Docker, a locked-down Windows machine, or any computer without network or with network restrictions.</p>

<p>Personally, I&rsquo;d like to see <code>python3 -m json</code> work.
I can&rsquo;t think of any big downsides.
Can you?</p>

<p><strong>Update</strong>: <a href="https://github.com/python/cpython/pull/122884">pull request opened</a>.</p>

<h2>Too long; didn&rsquo;t read</h2>

<p>The &ldquo;too long didn&rsquo;t read version&rdquo;:</p>

<ul>
<li>Python 2.5 added support for the <code>-m</code> argument for <em>modules</em>, but not <em>packages</em></li>
<li>A third-party <code>simplejson</code> app existed with a nice CLI that relied on a <code>-m</code> implementation bug allowing packages to be run using <code>-m</code></li>
<li>Python 2.6 fixed that implementation quirk and broke the previous ability to run <code>python -m simplejson</code></li>
<li>Python 2.6 also added the <code>json</code> module, which was based on this third-party <code>simplejson</code> package</li>
<li>Since <code>python -m json</code> couldn&rsquo;t work anymore, the ability to run <code>python -m json.tool</code> was added</li>
<li>Python 2.7 added official support for <code>python -m some_package</code> by running a <code>__main__</code> submodule</li>
<li>The <code>json.tool</code> module already existed in Python 2.6 and the ability to run <code>python -m json</code> was (as far as I can tell) never seriously considered</li>
</ul>


<h2>All thanks to git history and issue trackers</h2>

<p>I discovered this by noting <a href="https://github.com/simplejson/simplejson/commit/74d9c5c4c4339db47dfa86bf37858cae80ed3776">the first commit</a> that added the <code>tool</code> submodule to <code>simplejson</code>, which notes the fact that this was for consistency with the new <code>json</code> standard library module.</p>

<p>Thank you git history.
And thank you to the folks who brought us the <code>simplejson</code> library, the <code>json</code> module, and the ability to use <code>-m</code> on both a module and a package!</p>

<p>Also, thank you to Alyssa Coghlan, Hugo van Kemenade, and Adam Turner for reviewing my pull request to add this feature to Python 3.14. ð</p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on August 01, 2024 09:00 PM UTC by
            <a href="https://treyhunner.com/python.xml" class="link link-hover text-primary"
              >Trey Hunner</a
            >
          </div>
          <a
            href="https://treyhunner.com/2024/08/why-does-python-m-json-not-work/"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://www.blog.pythonlibrary.org/2024/08/01/displaying-pandas-dataframes-in-the-terminal/" class="hover:underline"
              >Displaying Pandas DataFrames in the Terminal</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p>Have you ever wanted to show a pandas DataFrame in your terminal? Of course, you have! All you need is the textual-pandas package! Yes, you can also view a pandas DataFrame in a REPL, such as IPython or Jupyter Notebook, but you can write a TUI application with textual-pandas and use that to display pandas [&#8230;]</p>
<p>The post <a href="https://www.blog.pythonlibrary.org/2024/08/01/displaying-pandas-dataframes-in-the-terminal/">Displaying Pandas DataFrames in the Terminal</a> appeared first on <a href="https://www.blog.pythonlibrary.org">Mouse Vs Python</a>.</p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on August 01, 2024 03:40 PM UTC by
            <a href="http://www.blog.pythonlibrary.org/feed/" class="link link-hover text-primary"
              >Mike Driscoll</a
            >
          </div>
          <a
            href="https://www.blog.pythonlibrary.org/2024/08/01/displaying-pandas-dataframes-in-the-terminal/"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://zerotomastery.io/blog/python-monthly-newsletter-july-2024/?utm_source=python-rss-feed" class="hover:underline"
              >Python Monthly Newsletter ð»ð</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            56th issue of Andrei Neagoie's must-read monthly Python Newsletter: Python Web Apps, Python Oopsie with Apple, Some Advice From a 15+ Vet, and much more. Read the full newsletter to get up-to-date with everything you need to know from last month.
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on August 01, 2024 10:00 AM UTC by
            <a href="https://zerotomastery.io/rss/python-rss.xml" class="link link-hover text-primary"
              >Zero to Mastery</a
            >
          </div>
          <a
            href="https://zerotomastery.io/blog/python-monthly-newsletter-july-2024/?utm_source=python-rss-feed"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://pythoninsider.blogspot.com/2024/08/python-3130-release-candidate-1-released.html" class="hover:underline"
              >Python 3.13.0 release candidate 1 released</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p>&nbsp;I'm pleased to announce the release of Python 3.13 <b>release candidate 1</b>.<br /><br /><a href="https://www.python.org/downloads/release/python-3130rc1/">https://www.python.org/downloads/release/python-3130rc1/</a></p><p>&nbsp;</p><h1>This is the first release candidate of Python 3.13.0</h1>
<p>This release, <strong>3.13.0rc1</strong>, is the penultimate release 
preview. Entering the release candidate phase, only reviewed code 
changes which are clear bug fixes are allowed between this release 
candidate and the final release. The second candidate (and the last 
planned release preview) is scheduled for Tuesday, 2024-09-03, while the
 official release of 3.13.0 is scheduled for Tuesday, 2024-10-01.</p>
<p>There will be <strong>no ABI changes</strong> from this point forward in the 3.13 series, and the goal is that there will be as few code changes as possible.</p>
<h3 style="text-align: left;"><a class="anchor" href="https://discuss.python.org/t/python-3-13-0-release-candidate-1-released/59703#p-181511-call-to-action-2" name="p-181511-call-to-action-2"></a>Call to action</h3>
<p>We strongly encourage maintainers of third-party Python projects to 
prepare their projects for 3.13 compatibilities during this phase, and 
where necessary publish Python 3.13 wheels on PyPI to be ready for the 
final release of 3.13.0. Any binary wheels built against Python 
3.13.0rc1 <strong>will work</strong> with future versions of Python 3.13. As always, report any issues to <a href="https://github.com/python/cpython/issues">the Python bug tracker</a>.</p>
<p>Please keep in mind that this is a preview release and while itâs as close to the final release as we can get it, its use is <strong>not</strong> recommended for production environments.</p>
<h3><a class="anchor" href="https://discuss.python.org/t/python-3-13-0-release-candidate-1-released/59703#p-181511-core-developers-time-to-work-on-documentation-now-3" name="p-181511-core-developers-time-to-work-on-documentation-now-3"></a>Core developers: time to work on documentation now</h3>
<ul><li>Are all your changes properly documented?</li><li>Are they mentioned in <a href="https://docs.python.org/3.13/whatsnew/3.13.html">Whatâs New</a>?</li><li>Did you notice other changes you know of to have insufficient documentation?</li></ul>
<h1><a class="anchor" href="https://discuss.python.org/t/python-3-13-0-release-candidate-1-released/59703#p-181511-major-new-features-of-the-313-series-compared-to-312-4" name="p-181511-major-new-features-of-the-313-series-compared-to-312-4"></a>&nbsp;</h1><h1>Major new features of the 3.13 series, compared to 3.12</h1>
<p>Some of the new major new features and changes in Python 3.13 are:</p>
<h2><a class="anchor" href="https://discuss.python.org/t/python-3-13-0-release-candidate-1-released/59703#p-181511-new-features-5" name="p-181511-new-features-5"></a>New features</h2>
<ul><li>A <a href="https://docs.python.org/3.13/whatsnew/3.13.html#a-better-interactive-interpreter">new and improved interactive interpreter</a>, based on <a href="https://pypy.org">PyPy</a>âs, featuring multi-line editing and color support, as well as colorized <a href="https://docs.python.org/3.13/whatsnew/3.13.html#improved-error-messages">exception tracebacks</a>.</li><li>An <a href="https://docs.python.org/3.13/whatsnew/3.13.html#free-threaded-cpython"><em>experimental</em> free-threaded build mode</a>,
 which disables the Global Interpreter Lock, allowing threads to run 
more concurrently. The build mode is available as an experimental 
feature in the Windows and macOS installers as well.</li><li>A <a href="https://docs.python.org/3.13/whatsnew/3.13.html#experimental-jit-compiler">preliminary, <em>experimental</em> JIT</a>, providing the ground work for significant performance improvements.</li><li>The <code>locals()</code> builtin function (and its C equivalent) now has <a href="https://docs.python.org/3.13/whatsnew/3.13.html#defined-mutation-semantics-for-locals">well-defined semantics when mutating the returned mapping</a>, which allows debuggers to operate more consistently.</li><li>The (cyclic) garbage collector is now <a href="https://docs.python.org/3.13/whatsnew/3.13.html#incremental-garbage-collection">incremental</a>, which should mean shorter pauses for collection in programs with a lot of objects.</li><li>A modified version of <a href="https://github.com/microsoft/mimalloc">mimalloc</a> is now included, optional but enabled by default if supported by the platform, and required for the free-threaded build mode.</li><li>Docstrings now have <a href="https://docs.python.org/3.13/whatsnew/3.13.html#other-language-changes">their leading indentation stripped</a>, reducing memory use and the size of .pyc files. (Most tools handling docstrings already strip leading indentation.)</li><li>The <a href="https://docs.python.org/3.13/library/dbm.html">dbm module</a> has a new <a href="https://docs.python.org/3.13/whatsnew/3.13.html#dbm">dbm.sqlite3 backend</a> that is used by default when creating new files.</li><li>The minimum supported macOS version was changed from 10.9 to <strong>10.13 (High Sierra)</strong>. Older macOS versions will not be supported going forward.</li><li>WASI is now a <a href="https://peps.python.org/pep-0011/#tier-2">Tier 2 supported platform</a>. Emscripten is no longer an <a href="https://peps.python.org/pep-0011/#no-longer-supported-platforms">officially supported platform</a> (but <a href="https://pyodide.org">Pyodide</a> continues to support Emscripten).</li><li>iOS is now a <a href="https://peps.python.org/pep-0730/">Tier 3 supported platform</a>, with <a href="https://peps.python.org/pep-0738/">Android on the way as well</a>.</li></ul>
<h2><a class="anchor" href="https://discuss.python.org/t/python-3-13-0-release-candidate-1-released/59703#p-181511-typing-6" name="p-181511-typing-6"></a>Typing</h2>
<ul><li>Support for <a href="https://peps.python.org/pep-0696/">type defaults in type parameters</a>.</li><li>A <a href="https://peps.python.org/pep-0742/">new type narrowing annotation</a>, <code>typing.TypeIs</code>.</li><li>A new annotation for <a href="https://peps.python.org/pep-0705/">read-only items in TypeDicts</a>.</li><li>A new annotation for <a href="https://peps.python.org/pep-0702">marking deprecations in the type system</a>.</li></ul>
<h2><a class="anchor" href="https://discuss.python.org/t/python-3-13-0-release-candidate-1-released/59703#p-181511-removals-and-new-deprecations-7" name="p-181511-removals-and-new-deprecations-7"></a>Removals and new deprecations</h2>
<ul><li><a href="https://peps.python.org/pep-0594/">PEP 594 (Removing dead batteries from the standard library)</a> scheduled removals of many deprecated modules: <code>aifc</code>, <code>audioop</code>, <code>chunk</code>, <code>cgi</code>, <code>cgitb</code>, <code>crypt</code>, <code>imghdr</code>, <code>mailcap</code>, <code>msilib</code>, <code>nis</code>, <code>nntplib</code>, <code>ossaudiodev</code>, <code>pipes</code>, <code>sndhdr</code>, <code>spwd</code>, <code>sunau</code>, <code>telnetlib</code>, <code>uu</code>, <code>xdrlib</code>, <code>lib2to3</code>.</li><li><a href="https://docs.python.org/3.13/whatsnew/3.13.html#removed">Many other removals</a> of deprecated classes, functions and methods in various standard library modules.</li><li>C API <a href="https://docs.python.org/3.13/whatsnew/3.13.html#id10">removals</a> and <a href="https://docs.python.org/3.13/whatsnew/3.13.html#id9">deprecations</a>. (Some removals present in alpha 1 were reverted in alpha 2, as the removals were deemed too disruptive at this time.)</li><li><a href="https://docs.python.org/3.13/whatsnew/3.13.html#deprecated">New deprecations</a>, most of which are scheduled for removal from Python 3.15 or 3.16.</li></ul>
<p><small>(Hey, <strong>fellow core developer,</strong> if a feature you find important is missing from this list, <a href="mailto:thomas@python.org">let Thomas know</a>.)</small></p>
<p>For more details on the changes to Python 3.13, see <a href="https://docs.python.org/3.13/whatsnew/3.13.html">Whatâs new in Python 3.13</a>. The next pre-release of Python 3.13 will be 3.13.0rc2, <strong>the final release candidate</strong>, currently scheduled for 2024-09-03.</p>
<h1><a class="anchor" href="https://discuss.python.org/t/python-3-13-0-release-candidate-1-released/59703#p-181511-more-resources-8" name="p-181511-more-resources-8"></a>&nbsp;</h1><h1>More resources</h1>
<ul><li><a href="https://docs.python.org/3.13/">Online Documentation</a></li><li><a href="https://peps.python.org/pep-0719/">PEP 719</a>, 3.13 Release Schedule</li><li>Report bugs at <a class="inline-onebox" href="https://github.com/python/cpython/issues">Issues Â· python/cpython Â· GitHub</a>.</li><li><a href="https://www.python.org/psf/donations/python-dev/">Help fund Python directly</a> (or <a href="https://github.com/sponsors/python">via GitHub Sponsors</a>), and support <a href="https://www.python.org/psf/donations/">the Python community</a>.</li></ul>
<h1><a class="anchor" href="https://discuss.python.org/t/python-3-13-0-release-candidate-1-released/59703#p-181511-enjoy-the-new-releases-9" name="p-181511-enjoy-the-new-releases-9"></a>&nbsp;</h1><h1>Enjoy the new releases</h1>
<p>Thanks to all of the many volunteers who help make Python Development
 and these releases possible! Please consider supporting our efforts by 
volunteering yourself or through organization contributions to the 
Python Software Foundation.</p>
<p>Whatevs,</p>
<p>Your release team,<br />
Thomas Wouters <br />
Åukasz Langa <br />
Ned Deily <br />
Steve Dower <br /></p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on August 01, 2024 09:30 AM UTC by
            <a href="http://feeds.feedburner.com/PythonInsider" class="link link-hover text-primary"
              >Python Insider</a
            >
          </div>
          <a
            href="https://pythoninsider.blogspot.com/2024/08/python-3130-release-candidate-1-released.html"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://discuss.tryton.org/t/newsletter-july-2024/7503" class="hover:underline"
              >Newsletter July 2024</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <div>  </div>

<p></p><div class="lightbox-wrapper"><a class="lightbox" href="https://discuss-cdn.tryton.org/uploads/default/original/2X/d/db7c8c2e3089397b120e1f219a108ad26ff59f4a.jpeg" title="Photo: Pexels, Fresh Tr"><img alt="Portrait of Brunette Woman in Sunlight" height="500" src="https://discuss-cdn.tryton.org/uploads/default/optimized/2X/d/db7c8c2e3089397b120e1f219a108ad26ff59f4a_2_333x500.jpeg" title="Photo: Pexels, Fresh Tr" width="333" /></a></div><p></p>
<p>During the last month we focused on fixing bugs, improving the behaviour of things, speeding-up performance issues - building on the changes from <a href="https://discuss.tryton.org/t/tryton-release-7-2/">our last release</a>. We also added some new features which we would like to introduce to you in this newsletter.</p>
<p>For an in depth overview of the <a href="https://bugs.tryton.org/">Tryton issues please take a look at our issue tracker </a> or see the issues and merge requests <a href="https://code.tryton.org/tryton/-/labels">filtered by label</a>.</p>
<h2 id="heading--user">Changes for the User</h2>
<h3 id="heading--sales-purchase">Sales, Purchases and Projects</h3>
<p>Weâve now <a href="https://bugs.tryton.org/13021">added optional <em>reference</em> and <em>warehouse</em> fields</a> to the purchase_request_quotation list view.</p>
<h3 id="heading--accounting">Accounting, Invoicing and Payments</h3>
<p>We now allow users in the <em>account admin</em> group to <a href="https://bugs.tryton.org/13277">update the invoice line descriptions in a revised invoice</a>.</p>
<p>Until now a direct debit was created for each unpaid line. <a href="https://bugs.tryton.org/13086">However, this may not be wanted when there are many payable lines</a>. In these cases the company may want to have a single direct debit for the total amount of the payable lines. So, weâve now introduced an <a href="https://bugs.tryton.org/13084">option to define if a recept of a direct debit should be based on the <em>lines</em> or the <em>balance</em></a>.</p>
<h3 id="heading--stock">Stock, Production and Shipments</h3>
<p>Now weâve <a href="https://bugs.tryton.org/12929">extend the lot trace information by moves generated from an inventory</a>. This way we are able to show the origin of a lot.</p>
<p>We <a href="https://bugs.tryton.org/12966">removed the default planned date</a> on supplier shipments.</p>
<h3 id="heading--ui">User Interface</h3>
<p>It is now possible for the users to <a href="https://bugs.tryton.org/13234">resize the preview panel of attachments</a>.</p>
<p>Now <a href="https://bugs.tryton.org/13328">users are able to type search filters immediately</a> after opening a screen with a search entry.</p>
<h3 id="heading--system-data-config">System Data and Configuration</h3>
<p>Weâve added the following <a href="https://bugs.tryton.org/12940">party identifiers</a>:</p>
<ul>
<li>Taiwanese Tax Number</li>
<li>Turkish tax identification number</li>
<li>El Salvador Tax Number</li>
<li>Singaporeâs Unique Entity Number</li>
<li>Montenegro Tax Number</li>
<li>Kenya Tax Number</li>
</ul>
<h2 id="heading--new-documentation">New Documentation</h2>
<p>The documentations for the following modules has been improved:</p>
<ul>
<li><a href="https://docs.tryton.org/latest/modules-account-be/index.html">account_be</a></li>
<li><a href="https://docs.tryton.org/latest/modules-account-asset/index.html">account_asset</a></li>
<li><a href="https://docs.tryton.org/latest/modules-account-eu/index.html">account_eu</a></li>
<li><a href="https://docs.tryton.org/latest/modules-account-deposit/index.html">account_deposit</a></li>
<li><a href="https://docs.tryton.org/latest/modules-account-de-skr03/index.html">account_de_skr03</a></li>
<li><a href="https://docs.tryton.org/latest/modules-account-fr/index.html">account_fr</a></li>
<li><a href="https://docs.tryton.org/latest/modules-notification-email/index.html">notification_email module</a></li>
<li><a href="https://docs.tryton.org/latest/modules-stock-lot/index.html">stock_lot</a></li>
</ul>
<p>Weâve added a warning that because the database is modified in place <a href="https://docs.tryton.org/latest/server/topics/setup_database.html#topics-setup-database">it is important to make a backup before running an update</a>.</p>
<p>Weâve <a href="https://code.tryton.org/tryton/-/commit/d2385fac5613a13fce9dcd1d9899d7836677665d">migrated what were previously links to the configuration section</a>  to config-anchors like this <code>:ref:trytond:topics-configuration</code>.</p>
<h2 id="heading--new-releases">New Releases</h2>
<p>We released bug fixes for the currently maintained <a href="https://discuss.tryton.org/t/release-process/395">long term support series</a><br />
<a href="https://code.tryton.org/tryton/-/commits/branch/7.0">7.0</a> and <a href="https://code.tryton.org/tryton/-/commits/branch/6.0">6.0</a>, and for the current series <a href="https://code.tryton.org/tryton/-/commits/branch/7.2">7.2</a>.</p>
<h2 id="heading--sysadmin">Changes for the System Administrator</h2>
<p>Now when <a href="https://bugs.tryton.org/13347">running <code>trytond-admin</code> with the <code>--indexes</code> argument</a> but without any modules to update, the indexes of all models are updated.</p>
<h2 id="heading--developer">Changes for Implementers and Developers</h2>
<p>We are now able to <a href="https://bugs.tryton.org/13312">run tests with <code>PYTHONWARNINGS="error"</code></a> to catch future issues earlier. Warnings from third-party-libraries can be ignored by the filters defined in the <code>TEST_PYTHONWARNINGS</code> environment variable.</p>
<p>Authors: <a class="mention" href="https://discuss.tryton.org/u/dave">@dave</a> <a class="mention" href="https://discuss.tryton.org/u/pokoli">@pokoli</a> <a class="mention" href="https://discuss.tryton.org/u/udono">@udono</a></p>
            <p><small>2 posts - 2 participants</small></p>
            <p><a href="https://discuss.tryton.org/t/newsletter-july-2024/7503">Read full topic</a></p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on August 01, 2024 06:00 AM UTC by
            <a href="http://www.tryton.org/rss.xml" class="link link-hover text-primary"
              >Tryton News</a
            >
          </div>
          <a
            href="https://discuss.tryton.org/t/newsletter-july-2024/7503"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://rickardlindberg.me/2024/08/01/newsletter-july-note.html" class="hover:underline"
              >Newsletter July 2024: Note Making Re-Visited</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p>This post has not yet been imported to my new blog.</p>
<p>In the meantime, you can read it here: <a href="http://archive.rickardlindberg.me/writing/newsletter/july-2024/">http://archive.rickardlindberg.me/writing/newsletter/july-2024/</a>.</p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on August 01, 2024 12:00 AM UTC by
            <a href="http://rickardlindberg.me/tags/python/rss.xml" class="link link-hover text-primary"
              >Rickard Lindberg</a
            >
          </div>
          <a
            href="https://rickardlindberg.me/2024/08/01/newsletter-july-note.html"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://nedbatchelder.com/blog/202407/pushing_back_on_sysmonitoring.html" class="hover:underline"
              >Pushing back on sys.monitoring</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p>I&#8217;ve been continuing to work on <a href="/blog/202406/coverage_at_a_crossroads.html" rel="external noopener">adapting
coverage.py</a> to the new <a href="https://docs.python.org/3/library/sys.monitoring.html" rel="external noopener">sys.monitoring</a> facility.
Getting efficient branch coverage has been difficult even with the new API.  The
latest idea was to compile the code under measurement to insert phantom lines
that could trigger line monitoring events that would track branch execution.
But I&#8217;ve come to the opinion that this is not the right approach.  It&#8217;s a
complex work-around for a gap in the sys.monitoring API.</p><p><b>Update:</b> Mark Shannon is working on new events:
<a href="https://github.com/python/cpython/issues/122548" rel="external noopener">Add BRANCH_TAKEN and
BRANCH_NOT_TAKEN events to sys.monitoring</a>.</p><p>To re-cap: sys.monitoring let you subscribe to events for code execution.  A
line event lets you know when lines are executed.  You can disable a line event,
and you will never again be notified about that particular line being
executed.</p><p>The gap is in the branch events: when one is fired, it tells you the
bytecode offset of the source and destination. The problem is that disabling a
branch event disables the source offset.  You never hear about that source
offset again, even when the destination offset is different.  The central idea
of a branch is that one source has two different destinations, so this disabling
behavior is awkward.</p><p>If we leave the branch event enabled, then we might be repeatedly told about
the same source/destination pair, slowing down execution.  We could disable the
event once we saw both possible destinations, but that means implementing our
own bookkeeping, and we still have the overhead of repeated first-destination
events.  If we disable the branch event immediately, we&#8217;ll never hear about the
other possible destination and the coverage data will be incomplete.</p><p>The clever idea from <a href="https://github.com/plasma-umass/slipcover" rel="external noopener">SlipCover</a> is to insert
do-nothing lines at each branch destination, then only subscribe to line events.
This works in theory, but adds complexity to coverage.py.  It also limits how it
can be used: you can&#8217;t start coverage measurement in a process after code has
already been imported because the line insertion happens during compilation via
an import hook. To make matters worse, there&#8217;s a tricky interaction between the
coverage.py import hook and the pytest import hook that rewrites assertions.</p><p>Over the years I&#8217;ve done plenty of clever work-arounds for limitations in
systems I build on top of.  They can be interesting puzzles and proud
achievements.  They can also be maintenance headaches and fragile sources of
bugs.</p><p>My progress on adapting coverage.py to sys.monitoring has be slow, even
glacial.  I think it will be faster overall to work on improving sys.monitoring
instead, even though it means the improvements wouldn&#8217;t be available until 3.14.
It will keep coverage.py simpler and more flexible, and will make the improved
branch events available to everyone.  I can&#8217;t see how the current behavior is
useful, so let&#8217;s change it.</p><p>I&#8217;ve <a href="https://discuss.python.org/t/updating-sys-monitoring-how-branch-events-are-disabled/59527" rel="external noopener">proposed that we fix the sys.monitoring API</a>. Of
course other participation is welcome in that discussion.</p><p>I remember years ago working at Lotus, using the Lotus Notes API.  I accepted
it as a finished thing.  Later I joined the organization that built Lotus Notes.
We had a discussion about something we were building and a difficulty we were
encountering. One of the longer-tenured engineers said, &#8220;Let&#8217;s extend the API.&#8221;
It was a revelation that we didn&#8217;t have to limit ourselves to the current
capabilities of our foundation, we could change the foundation.</p><p>The same is true of Python, especially because it is open source.  But it can
be hard to remember that and to advocate for it where necessary.</p><p>BTW, I still believe that coverage.py&#8217;s internal focus on &#8220;arcs&#8221; is
misguided, and will be working to remove that idea in favor of true
branches.</p><p>As I mentioned last time, there&#8217;s now a dedicated
<a href="https://discord.gg/RBw567RyWc" rel="external noopener">#coverage-py channel</a> in the Python Discord if you are
interested in discussing any of this.</p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 31, 2024 09:32 PM UTC by
            <a href="http://nedbatchelder.com/blog/planetpython.xml" class="link link-hover text-primary"
              >Ned Batchelder</a
            >
          </div>
          <a
            href="https://nedbatchelder.com/blog/202407/pushing_back_on_sysmonitoring.html"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://devblogs.microsoft.com/python/python-in-visual-studio-code-august-2024-release/" class="hover:underline"
              >Python in Visual Studio Code â August 2024 Release</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p>The August 2024 release of the Python and Jupyter extensions for Visual Studio Code are now available. This month's updates include improved Python discovery using python environment tools, inline variable values with the python debugger, and improvements to the VS Code native REPL. Keep reading to learn more!</p>
<p>The post <a href="https://devblogs.microsoft.com/python/python-in-visual-studio-code-august-2024-release/">Python in Visual Studio Code &#8211; August 2024 Release</a> appeared first on <a href="https://devblogs.microsoft.com/python">Python</a>.</p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 31, 2024 08:44 PM UTC by
            <a href="https://blogs.msdn.microsoft.com/pythonengineering/feed/" class="link link-hover text-primary"
              >Python Engineering at Microsoft</a
            >
          </div>
          <a
            href="https://devblogs.microsoft.com/python/python-in-visual-studio-code-august-2024-release/"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://ruslanspivak.com/bb02/" class="hover:underline"
              >Up Your Game: Fundamental Skills for SoftwareÂ Engineers</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p><em>âFundamentals are the foundation of excellence. Without a strong base, you cannot reach your full potential.â â John&nbsp;Wooden</em></p>

<p>
<p>Hey&nbsp;there!</p><p>Letâs talk fundamentals today. Why are they important? John Woodenâs quote sums it up nicely, but letâs unpack it a bit&nbsp;more:</p><ol><li><p><strong>Strong foundation</strong>:</p><ul><li><p>A solid grasp â¦</p></li></ul></li></ol></p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 31, 2024 05:04 PM UTC by
            <a href="http://ruslanspivak.com/category/python/feed/atom/" class="link link-hover text-primary"
              >Ruslan Spivak</a
            >
          </div>
          <a
            href="https://ruslanspivak.com/bb02/"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://realpython.com/courses/simulate-text-file/" class="hover:underline"
              >Simulate a Text File in Python</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            Testing an application that reads files from a disk can be complicated. It may depend on the machine, require special access, or be frustratingly slow. This course shows you how to simulate a text file using Python to simplify testing.
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 30, 2024 02:00 PM UTC by
            <a href="https://realpython.com/atom.xml" class="link link-hover text-primary"
              >Real Python</a
            >
          </div>
          <a
            href="https://realpython.com/courses/simulate-text-file/"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/" class="hover:underline"
              >Writing a tile server in python</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p>Another dictated post<sup id="fnref:0"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:0">1</a></sup><sup id="fnref:13"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:13">11</a></sup>, but heavily edited. Buyer beware.</p>
<p>I developed a tileset based on OpenStreetMap data and style and elevation information, but I don't have a render server.
What I have been doing is using <a href="https://github.com/StyXman/osm-tile-tools">my own version</a> of an old script from the
<code>mapnik</code> version of the OSM style. This
script is called <code>generate_tiles</code>, and I made big modifications to it and now it's capable of doing many things,
including spawning several processes for handling the rendering. You can define regions that you want to render, or you
can just provide a bbox or a set of tiles or just coordinates. You can change the size of the meta tile, and it handles
empty tiles. If you find a sea tile, most probably you will not need to render its children<sup id="fnref:10"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:10">9</a></sup>, where children are the
four tiles that are just under it in the next zoom level. For instance, in zoom level zero we have only one tile (0,0,0),
and it's children are (1,0,0), (1,0,1), (1,1,0) and (1,1,1). 75% of the planet's surface is water, and with Mercator
projection and the <a href="https://en.wikipedia.org/w/index.php?title=Southern_Ocean">Antartic Ocean</a>, the percent of tiles
could be bigger, so this optimization cuts a lot of useless rendering time.</p>
<p>Another optimization is that it assumes that when you render zoom level N, you will be using
at least the same data for zoom level N+1. Of course, I am
not catching that data because <code>mapnik</code> does not allow this, but the operating system does the catching. So if
you have enough RAM, then you should be able to reuse all the data that's already in buffers and cache, instead of
having to fetch them again from disk. This in theory should accelerate rendering and probably it is<sup id="fnref:11"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:11">10</a></sup>.</p>
<p>The script works very well, and I've been using it for years already for rendering tiles in batches for several zoom
levels. Because my personal computer is way more powerful than
my server (and younger; 2018 vs 2011), I render in my computer and <code>rsync</code> to my server.</p>
<p>So now I wanted to make a tile server based on
this. Why do I want to make my own and not use <code>renderd</code>? I think my main issue with <code>renderd</code> is that it does not store
the individual tiles, but keeps metatiles of 8x8 tiles and serve the individual tiles from there. This saves inode usage
and internal fragmentation. Since my main usage so far has been (and probably will continue to be) rendering regions by
hand, and since my current (static) tile server stores all the latest versions of the tiles I have rendered since I
started doing this some 15 years ago, I want updating the server in a fast way. Most tile storage methods I know
fail terribly at update time (<a href="https://en.osm.town/@mdione/111069567039016636">see here</a>); most of the time it means
sending the whole file over the wire. Also, individual
tiles are easier to convert to anything else, like creating a MBTiles file, push it to my phone, and have a offline
tile service I can carry with me on treks where there is no signal. Also, serving the tiles can be as easy as
<code>python -m http.server</code> from the tileset root directory. So <code>renderd</code> is not useful for me. Another reason is, well, I
already have the rendering engine working. So how does it work?</p>
<p>The rendering engine consists
of one main thread, which I call Master, and rendering threads<sup id="fnref:2"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:2">3</a></sup>. These rendering threads load the style and wait for
work to do. The current style file is 6MiB+ and takes <code>mapnik</code> 4s+ to load it and generate all its structures, which
means these threads have to be created once per service lifetime. I have one queue that can send commands from the
Master to the renderer pool asking for rendering a metatile, which is faster than rendering the individual tiles. Then
one of the rendering threads picks the request from this queue, calls <code>mapnik</code>, generates the metatile, cuts it into
the subtiles and saves them to disk. The rendering thread posts in another queue, telling the Master about the children
metatiles that must be rendered, which due to emptiness can be between 0 and 4.</p>
<p>To implement the caching optimization I mentioned before, I use a third structure to maintain a stack. At the beginning
I push into it the initial work; later I pop one element from it, and when a rendered returns the list of children to be
rendered, I push them on top of the rest. This is what tries to guarantee that a metatile's children will be rendered
before moving to another region that would trash the cache. And because the children can inspect the tiles being written,
they can figure out when a child is all sea tiles and not returning it for rendering.</p>
<p>At the beginning I thought that, because the multiprocessing queues are implemented with pipes, I could use <code>select()</code><sup id="fnref:3"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:3">4</a></sup> to
see whether the queue was ready for writing or reading and use a typical non-blocking loop. When you're trying
to write, these queues will block when the queue is full, and when you're trying to read, they will block when the queue
is empty. But these two conditions, full and empty, are actually handled by semaphores, not by the size of the pipe.
That means that selecting on those pipes, even if I could reach all the way down into the structures of the
<code>multiprocessing.Queue</code> all the way down. and add them to a selector, yes, the read queue will not be selected if it's
empty (nothing to read), but the write queue will not, since availability of space in the pipe does not mean the queue
is not full.</p>
<p>So instead I'm peeking into these queues. For the work queue, I know that the Master thread<sup id="fnref:9"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:9">8</a></sup> is the only writer, so I can peek to
see if it is full. If it is, I am not going to send any new work to be done, because it means that all the renders are
busy, and the only work queued to be done has not been picked up yet. For the reading side it's the same, Master is the
only reader. so, I can peek if it's empty, and if it is, I am not going to try to read any information from it. So, I
have a loop, peeking first into the work queue and then into the info queue. If nothing has been done, I sleep a
fraction of a second.</p>
<p>Now let's try to think about how to replace this main loop with a web frontend. What is the web frontend going to do?
It's going to be getting queries by different clients. It could be just a slippy map in a web page, so we have a browser
as a client, or it could be any of the applications that can also render slippy maps. For instance, on Linux, we have
<code>marble</code>; on Android, I use MyTrails, and OsmAnd.</p>
<p>One of the things about these clients is that they have timeouts. Why
am I mentioning this? Because rendering a metatile for me can take between 3 to 120 seconds, depending on the zoom level.
There are zoom levels that are really, really expensive, like between 7 and 10. If a client is going to be asking
directly a rendering service for a tile, and the tile takes too long to render, the
client will timeout and close the connection. How do we handle this on the server side? Well, instead of the work stack,
the server will have request queue, which will be collecting the requests from the clients, and the Master will be
sending these  requests to the render pool.</p>
<p>So if the client closes the connection, I want to be able to react to that, removing any lingering requests made by that
client from the request queue. If I don't do that, the request queue will start piling up more and more requests,
creating a denial of service. This is not possible in multiprocessing queues, you cannot remove an element. The only
container that can do that is a dequeue<sup id="fnref:5"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:5">5</a></sup>, which also is optimized for putting and popping things from both ends (it's
probably implemented using a circular buffer), which is perfect for a queue. As for the info queue, I will not be caring
anymore about children metatiles, because I will not be doing any work that the clients are not requesting.</p>
<p>What framework that would allow me to do this? Let's recap the requirements:</p>
<ul>
<li>Results are computed, and take several seconds.</li>
<li>The library that generates the results is not async, nor thread safe, so I need to use subprocesses to achieve
  parallelization.</li>
<li>A current batch implementation uses 2 queues to send and retrieve computations to a pool of subprocesses; my idea is
  to "just" add a web frontend to this.</li>
<li>Each subprocess spends some seconds warming up, son I can't spawn a new process for each request.</li>
<li>Since I will have a queue of requested computations, if a client dies, if its query is being processed, then I let
  it finish; if not, I should remove it from the waiting queue.</li>
</ul>
<p>I started with FastAPI, but it doesn't have the support that I need. At first I just implemented a tile server; the idea
was to grow from there<sup id="fnref:6"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:6">6</a></sup>, but reading the docs it only allows doing long running async stuff <em>after</em> the response has
been sent.</p>
<p>Next was Flask. Flask is not async unless you want to use <code>sendfile()</code>. <code>sendfile()</code> is a way to make the
kernel read a file and write it directly on a socket without intervention from the process requesting that. The
alternative is to to open the file, read a block, write it on the socket, repeat. This definitely makes your code more
complex, you have to handle lots of cases. So <code>sendfile()</code> is very, very handy, but it's also faster because it's
0-copy. But Flask does not give control of what happens when the client suddenly closes the connection. I can
instruct it to cancel the tasks in flight, but as per all the previous explanation, that's not what I want.</p>
<p>This same problem seems to affect all async frameworks I looked into. <code>asyncio</code>, <code>aiohttp</code>, <code>tornado</code>. Except, of course,
<code>twisted</code>, but its API for that is with callbacks, and TBH, I was starting to get tired of all this, and the prospect
of callback hell, even when all the rest of the system could be developed in a more async way, was too much. And this is
not counting the fact that I need to hook into the main loop to step the Master. This could be implemented with timed
callbacks, such as <code>twisted</code>'s <code>callLater()</code>, but another thought started to form in my head.</p>
<p>Why did I go directly for frameworks? Because they're supposed to make our lives easier, but from the beginning I had
the impression that this would not be a run of the mill service. The main issue came down to beign able to send things
to render, return the rendered data to the right clients, associate several clients to a single job before it finished
(more than one client might request the same tile or several tiles that belong to the same metatile), and handle client
and job cancellation when clients disappear. The more frameworks' documentation I read, the more I started to fear that
the only solution was to implement an non-blocking<sup id="fnref:14"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:14">12</a></sup> loop myself.</p>
<p>I gotta be honest, I dusted
<a href="https://en.wikipedia.org/wiki/UNIX_Network_Programming?useskin=vector">an old Unix Network Programming book</a>, 2nd Ed.,
1998 (!!!), read half a chapter, and I was ready to do it. And thanks to the simple <code>selector</code> API, it's a breeze:</p>
<ol>
<li>Create a listening socket.</li>
<li>Register it for read events (connections).</li>
<li>On connection, accept the client and wait for read events in that one too.</li>
<li>We were not registering for write before because the client is always ready for write before we start sending
     anything, which lead to tight loops.</li>
<li>On client read, read the request and send the job to Master. Unregister for read.</li>
<li>But if there's nothing to read, the client disconnected. Send an empty.response, unregister for read and register
     for write.</li>
<li>Step Master.</li>
<li>If anything came back, generate the responses and queue them for sending. Register the right clients for write.</li>
<li>On client write (almost always), send the response and the file with <code>sendfile()</code> if any.</li>
<li>Then close the connection and unregister.</li>
<li>Loop to #3.</li>
</ol>
<p>Initially all this, including reimplementing fake Master and render threads, took less than 200 lines of code, some 11h
of on-and-off work. Now that I have finished I have a better idea of how to implement this at least with <code>twisted</code>,
which I think I will have to do, since step 4 assumes the whole query can be <code>recv()</code>'ed in one go and step 7 similarly
for <code>send()</code>'ing; luckily I don't need to do any handholding for <code>sendfile()</code>, even when the socket is non blocking.
A more production ready service needs to handle short reads and writes. Also, the HTTP/1.1 protocol all clients are
using allows me to assume that once a query is received, the client will be waiting for an answer before trying anything
else, and that I can close the connection once a response has been send and assume the client will open a new connection
for more tiles. And even then, supporting keep alive should not be that hard (instead of closing the client, unregister
for write, register for read, and only do the close dance when the response is empty). And because I can simply step
Master in the main loop, I don't have to worry about blocking queues.</p>
<p>Of course, now it's more complex, because it's implementing support for multiple clients with different
queries requiring rendering the same metatile. This is due that applications will open several clients for fetching
tiles when showing a region, and unless it's only 4 and they fall in the corner of 4 adjacent metatiles, they will always mean
more than one client per metatile. Also, I could have several clients looking at the same region.
<a href="https://github.com/StyXman/osm-tile-tools/blob/master/rendering_tile_server-sockets.py">The current code</a> is
approaching the 500 lines, but all that should also be present in any other implementation.</p>
<p>I'm pretty happy about how fast I could make it work and how easy it was. Soon I'll be finishing integrating a real
render thread with saving the tiles and implement the fact that if one metatile's tile is not present, we can assume
it's OK, but if all are not present, I have to find out if they were all empty or never rendered. A last step would be
how to make all this testable. And of course, the <code>twisted</code> port.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       </p>
<div class="footnote">
<hr />
<ol>
<li id="fn:0">
<p>This is getting out of hand. The audio was 1h long, not sure how long it took to auto transcribe, and when editing
  and thinking I was getting to the end of it, the preview told me I still had like half the text to go through.Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:0" title="Jump back to footnote 1 in the text">â©</a></p>
</li>
<li id="fn:1">
<p>No idea what I wanted to write here :)Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:1" title="Jump back to footnote 2 in the text">â©</a></p>
</li>
<li id="fn:2">
<p>Because <code>mapnik</code> is not thread safe and because of the GIL, they're actually subprocesses via the
  <code>multioprocessing</code> module, but I'll keep calling them threads to simplify.Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:2" title="Jump back to footnote 3 in the text">â©</a></p>
</li>
<li id="fn:3">
<p>Again, a simplification. Python provides the selector module that allows using abstract implementations that
  spare us from having to select the best implementation for the platform.Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:3" title="Jump back to footnote 4 in the text">â©</a></p>
</li>
<li id="fn:5">
<p>I just found out it's pronounced like 'deck'.Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:5" title="Jump back to footnote 5 in the text">â©</a></p>
</li>
<li id="fn:6">
<p>All the implementations I did followed the same pattern. In fact, right now, I hadn't implementing the rendering
  tile server: it's only blockingly <code>sleep()</code>'ing for some time (up to 75s, to trigger client timeouts), and then
  returning the tiles already present. What's currently missing is figuring out whether I should rerender or use the
  tiles already present<sup id="fnref:7"><a class="footnote-ref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fn:7">7</a></sup>, and actually connecting the rendering part.Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:6" title="Jump back to footnote 6 in the text">â©</a></p>
</li>
<li id="fn:7">
<p>Two reasons to rerender: the data is stale, or the style has changed. The latter requires reloading the styles,
  which will probably mean rebuilding the rendering threads.Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:7" title="Jump back to footnote 7 in the text">â©</a></p>
</li>
<li id="fn:9">
<p>I keep calling this the Master thread, but at this point instead of having its own main loop, I'm just calling a
  function that implements the body of such loop. Following previous usage for such functions, it's called
  <code>single_step()</code>.Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:9" title="Jump back to footnote 8 in the text">â©</a></p>
</li>
<li id="fn:10">
<p>Except when you start rendering ferry routes.Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:10" title="Jump back to footnote 9 in the text">â©</a></p>
</li>
<li id="fn:11">
<p>I never measured it :(Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:11" title="Jump back to footnote 10 in the text">â©</a></p>
</li>
<li id="fn:13">
<p>Seems like <code>nikola</code> renumbers the footnotes based on which order they are here at the bottom of the source. The
   first note was 0, but it renumbered it and all the rest to start counting from 1.Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:13" title="Jump back to footnote 11 in the text">â©</a></p>
</li>
<li id="fn:14">
<p>Have in account that I'm explicitly making a difference between a non-blocking/<code>select()</code> loop from an
   <code>async/await</code> system, but have in account that the latter is actually implemented with the formet.Â <a class="footnote-backref" href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/#fnref:14" title="Jump back to footnote 12 in the text">â©</a></p>
</li>
</ol>
</div>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 30, 2024 09:02 AM UTC by
            <a href="http://www.grulic.org.ar/~mdione/glob/categories/python.xml" class="link link-hover text-primary"
              >Marcos Dione</a
            >
          </div>
          <a
            href="https://www.grulic.org.ar/~mdione/glob/posts/writing-a-tile-server-in-python/"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://pythonbytes.fm/episodes/show/394/python-is-easy-now" class="hover:underline"
              >#394 Python is easy now?</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            Topics include Python is easy now, Trying out free-threaded Python on macOS, Module itertools overview, and uptime-kuma.
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 30, 2024 08:00 AM UTC by
            <a href="https://pythonbytes.fm/episodes/rss" class="link link-hover text-primary"
              >Python Bytes</a
            >
          </div>
          <a
            href="https://pythonbytes.fm/episodes/show/394/python-is-easy-now"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://nuitka.net/posts/nuitka-release-24.html" class="hover:underline"
              >Nuitka Release 2.4</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            This is to inform you about the new stable release of Nuitka. It is the extremely compatible Python compiler,
âdownload nowâ.
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 30, 2024 07:09 AM UTC by
            <a href="http://nuitka.net/categories/Python.xml" class="link link-hover text-primary"
              >Kay Hayen</a
            >
          </div>
          <a
            href="https://nuitka.net/posts/nuitka-release-24.html"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://zato.io/en/blog/sftp.html" class="hover:underline"
              >Automating telecommunications networks with Python and SFTP</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <h1 class="insights-header">
  <a class="rounded nav-title" href="https://zato.io/en/blog/sftp.html">Automating telecommunications networks with Python and SFTP</a>
</h1>
<div class="article-meta">
  2024-07-29, by Dariusz Suchojad
<img alt="" class="insights-author" src="https://upcdn.io/kW15bqq/raw/root/static/blog/authors/dsuch.webp" width="35" />
</div>

<p>In telecommunications, the Secure File Transfer Protocol (SFTP) serves as a critical mechanism
for secure and reliable file exchange between different network components devices, and systems,
whether it is updating configurations, network monitoring, exchanging customer data, or facilitating software updates.
Conversely, Python is an ideal tool for the automation of telecommunications networks thanks to its readability and versatility.</p>
<p>Let's dive into how to employ the two effectively and efficiently using the <a href="https://zato.io">Zato</a> integration and automation platform.</p>
<h2 id="dashboard">Dashboard</h2>
<p>The first step is to define a new SFTP connection in your Dashboard, as in the screenshots below.</p>
<p>The form lets you provide all the default options that apply to each SFTP connection - remote host, what protocol to use,
whether file metadata should be preserved during transfer, logging level and other details that you would typically provide.</p>
<p>Simply fill it out with the same details that you would use if it were command line-based SFTP connections.</p>
<p><img src="https://upcdn.io/kW15bqq/raw/root/static/blog/images/sftp-3.1/sftp-dashboard.png" /></p>
<p><img src="https://upcdn.io/kW15bqq/raw/root/static/blog/images/sftp-3.1/create.png" /></p>
<h2 id="pinging">Pinging</h2>
<p>The next thing, right after the creation of a new connection, is to ping it to check if the server is responding.</p>
<p>Pinging opens a new SFTP connection and runs the ping command - in the screenshot above it was <strong>ls .</strong> -
a practically no-op command whose sole purpose is to let the connection confirm that commands in fact can be executed,
which proves the correctness of the configuration.</p>
<p><img src="https://upcdn.io/kW15bqq/raw/root/static/blog/images/sftp-3.1/ping1.png" /></p>
<p>This will either returns details of why a connection could not be established or the response time if it was successful.</p>
<p><img src="https://upcdn.io/kW15bqq/raw/root/static/blog/images/sftp-3.1/ping2.png" /></p>
<h2 id="cloud-sftp-console">Cloud SFTP console</h2>
<p>Having validated the configuration by pinging it, we can now execute SFTP commands straight in Dashboard from a command console:</p>
<p><img src="https://upcdn.io/kW15bqq/raw/root/static/blog/images/sftp-3.1/shell-link.png" /></p>
<p>Any SFTP command, or even a series of commands, can be sent and responses retrieved immediately. It is also possible to increase the logging level
for additional SFTP protocol-level details.</p>
<p>This makes it possible to rapidly prototype file transfer functionality as a series of scripts that can be next moved as they are to Python-based services.</p>
<p><img src="https://upcdn.io/kW15bqq/raw/root/static/blog/images/sftp-3.1/shell-command.png" /></p>
<h2 id="python-automation">Python automation</h2>
<p>Now, in Python, your API automation services have access to an extensive array of capabilities -
from executing transfer commands individually or in batches to the usage of SFTP scripts previously
created in your Dashboard.</p>
<p>Here is how Python can be used in practice:</p>
<div class="highlight"><pre><span></span><code><a id="line-0-1" name="line-0-1"></a><a href="#line-0-1"><span class="linenos"></span></a><span class="c1"># -*- coding: utf-8 -*-</span>
<a id="line-0-2" name="line-0-2"></a><a href="#line-0-2"><span class="linenos"></span></a>
<a id="line-0-3" name="line-0-3"></a><a href="#line-0-3"><span class="linenos"></span></a><span class="c1"># Zato</span>
<a id="line-0-4" name="line-0-4"></a><a href="#line-0-4"><span class="linenos"></span></a><span class="kn">from</span> <span class="nn">zato.server.service</span> <span class="kn">import</span> <span class="n">Service</span>
<a id="line-0-5" name="line-0-5"></a><a href="#line-0-5"><span class="linenos"></span></a>
<a id="line-0-6" name="line-0-6"></a><a href="#line-0-6"><span class="linenos"></span></a><span class="k">class</span> <span class="nc">MySFTPService</span><span class="p">(</span><span class="n">Service</span><span class="p">):</span>
<a id="line-0-7" name="line-0-7"></a><a href="#line-0-7"><span class="linenos"></span></a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="line-0-8" name="line-0-8"></a><a href="#line-0-8"><span class="linenos"></span></a>
<a id="line-0-9" name="line-0-9"></a><a href="#line-0-9"><span class="linenos"></span></a>        <span class="c1"># Connection to use</span>
<a id="line-0-10" name="line-0-10"></a><a href="#line-0-10"><span class="linenos"></span></a>        <span class="n">conn_name</span> <span class="o">=</span> <span class="s1">'My SFTP Connection'</span>
<a id="line-0-11" name="line-0-11"></a><a href="#line-0-11"><span class="linenos"></span></a>
<a id="line-0-12" name="line-0-12"></a><a href="#line-0-12"><span class="linenos"></span></a>        <span class="c1"># Get a handle to the connection object</span>
<a id="line-0-13" name="line-0-13"></a><a href="#line-0-13"><span class="linenos"></span></a>        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">sftp</span><span class="p">[</span><span class="n">conn_name</span><span class="p">]</span><span class="o">.</span><span class="n">conn</span>
<a id="line-0-14" name="line-0-14"></a><a href="#line-0-14"><span class="linenos"></span></a>
<a id="line-0-15" name="line-0-15"></a><a href="#line-0-15"><span class="linenos"></span></a>        <span class="c1"># Execute an arbitrary script with one or more SFTP commands, like in web-admin</span>
<a id="line-0-16" name="line-0-16"></a><a href="#line-0-16"><span class="linenos"></span></a>        <span class="n">my_script</span> <span class="o">=</span> <span class="s1">'ls -la /remote/path'</span>
<a id="line-0-17" name="line-0-17"></a><a href="#line-0-17"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">my_script</span><span class="p">)</span>
<a id="line-0-18" name="line-0-18"></a><a href="#line-0-18"><span class="linenos"></span></a>
<a id="line-0-19" name="line-0-19"></a><a href="#line-0-19"><span class="linenos"></span></a>        <span class="c1"># Ping a remote server to check if it responds</span>
<a id="line-0-20" name="line-0-20"></a><a href="#line-0-20"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
<a id="line-0-21" name="line-0-21"></a><a href="#line-0-21"><span class="linenos"></span></a>
<a id="line-0-22" name="line-0-22"></a><a href="#line-0-22"><span class="linenos"></span></a>        <span class="c1"># Download an entry, possibly recursively</span>
<a id="line-0-23" name="line-0-23"></a><a href="#line-0-23"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">'/remote/path'</span><span class="p">,</span> <span class="s1">'/local/path'</span><span class="p">)</span>
<a id="line-0-24" name="line-0-24"></a><a href="#line-0-24"><span class="linenos"></span></a>
<a id="line-0-25" name="line-0-25"></a><a href="#line-0-25"><span class="linenos"></span></a>        <span class="c1"># Like .download but remote path must point to a file (exception otherwise)</span>
<a id="line-0-26" name="line-0-26"></a><a href="#line-0-26"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="s1">'/remote/path'</span><span class="p">,</span> <span class="s1">'/local/path'</span><span class="p">)</span>
<a id="line-0-27" name="line-0-27"></a><a href="#line-0-27"><span class="linenos"></span></a>
<a id="line-0-28" name="line-0-28"></a><a href="#line-0-28"><span class="linenos"></span></a>        <span class="c1"># Makes the contents of a remote file available on output</span>
<a id="line-0-29" name="line-0-29"></a><a href="#line-0-29"><span class="linenos"></span></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'/remote/path'</span><span class="p">)</span>
<a id="line-0-30" name="line-0-30"></a><a href="#line-0-30"><span class="linenos"></span></a>
<a id="line-0-31" name="line-0-31"></a><a href="#line-0-31"><span class="linenos"></span></a>        <span class="c1"># Uploads a local file or directory to remote path</span>
<a id="line-0-32" name="line-0-32"></a><a href="#line-0-32"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="s1">'/local/path'</span><span class="p">,</span> <span class="s1">'/remote/path'</span><span class="p">)</span>
<a id="line-0-33" name="line-0-33"></a><a href="#line-0-33"><span class="linenos"></span></a>
<a id="line-0-34" name="line-0-34"></a><a href="#line-0-34"><span class="linenos"></span></a>        <span class="c1"># Writes input data out to a remote file</span>
<a id="line-0-35" name="line-0-35"></a><a href="#line-0-35"><span class="linenos"></span></a>        <span class="n">data</span> <span class="o">=</span> <span class="s1">'My data'</span>
<a id="line-0-36" name="line-0-36"></a><a href="#line-0-36"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">'/remote/path'</span><span class="p">)</span>
<a id="line-0-37" name="line-0-37"></a><a href="#line-0-37"><span class="linenos"></span></a>
<a id="line-0-38" name="line-0-38"></a><a href="#line-0-38"><span class="linenos"></span></a>        <span class="c1"># Create a new directory</span>
<a id="line-0-39" name="line-0-39"></a><a href="#line-0-39"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">create_directory</span><span class="p">(</span><span class="s1">'/path/to/new/directory'</span><span class="p">)</span>
<a id="line-0-40" name="line-0-40"></a><a href="#line-0-40"><span class="linenos"></span></a>
<a id="line-0-41" name="line-0-41"></a><a href="#line-0-41"><span class="linenos"></span></a>        <span class="c1"># Create a new symlink</span>
<a id="line-0-42" name="line-0-42"></a><a href="#line-0-42"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">create_symlink</span><span class="p">(</span><span class="s1">'/path/to/new/symlink'</span><span class="p">)</span>
<a id="line-0-43" name="line-0-43"></a><a href="#line-0-43"><span class="linenos"></span></a>
<a id="line-0-44" name="line-0-44"></a><a href="#line-0-44"><span class="linenos"></span></a>        <span class="c1"># Create a new hard-link</span>
<a id="line-0-45" name="line-0-45"></a><a href="#line-0-45"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">create_hardlink</span><span class="p">(</span><span class="s1">'/path/to/new/hardlink'</span><span class="p">)</span>
<a id="line-0-46" name="line-0-46"></a><a href="#line-0-46"><span class="linenos"></span></a>
<a id="line-0-47" name="line-0-47"></a><a href="#line-0-47"><span class="linenos"></span></a>        <span class="c1"># Delete an entry, possibly recursively, no matter what kind it is</span>
<a id="line-0-48" name="line-0-48"></a><a href="#line-0-48"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'/path/to/delete'</span><span class="p">)</span>
<a id="line-0-49" name="line-0-49"></a><a href="#line-0-49"><span class="linenos"></span></a>
<a id="line-0-50" name="line-0-50"></a><a href="#line-0-50"><span class="linenos"></span></a>        <span class="c1"># Like .delete but path must be a directory</span>
<a id="line-0-51" name="line-0-51"></a><a href="#line-0-51"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">delete_directory</span><span class="p">(</span><span class="s1">'/path/to/delete'</span><span class="p">)</span>
<a id="line-0-52" name="line-0-52"></a><a href="#line-0-52"><span class="linenos"></span></a>
<a id="line-0-53" name="line-0-53"></a><a href="#line-0-53"><span class="linenos"></span></a>        <span class="c1"># Like .delete but path must be a file</span>
<a id="line-0-54" name="line-0-54"></a><a href="#line-0-54"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="s1">'/path/to/delete'</span><span class="p">)</span>
<a id="line-0-55" name="line-0-55"></a><a href="#line-0-55"><span class="linenos"></span></a>
<a id="line-0-56" name="line-0-56"></a><a href="#line-0-56"><span class="linenos"></span></a>        <span class="c1"># Like .delete but path must be a symlink</span>
<a id="line-0-57" name="line-0-57"></a><a href="#line-0-57"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">delete_symlink</span><span class="p">(</span><span class="s1">'/path/to/delete'</span><span class="p">)</span>
<a id="line-0-58" name="line-0-58"></a><a href="#line-0-58"><span class="linenos"></span></a>
<a id="line-0-59" name="line-0-59"></a><a href="#line-0-59"><span class="linenos"></span></a>        <span class="c1"># Get information about an entry, e.g. modification time, owner, size and more</span>
<a id="line-0-60" name="line-0-60"></a><a href="#line-0-60"><span class="linenos"></span></a>        <span class="n">info</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_info</span><span class="p">(</span><span class="s1">'/remote/path'</span><span class="p">)</span>
<a id="line-0-61" name="line-0-61"></a><a href="#line-0-61"><span class="linenos"></span></a>
<a id="line-0-62" name="line-0-62"></a><a href="#line-0-62"><span class="linenos"></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">last_modified</span><span class="p">)</span>
<a id="line-0-63" name="line-0-63"></a><a href="#line-0-63"><span class="linenos"></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">owner</span><span class="p">)</span>
<a id="line-0-64" name="line-0-64"></a><a href="#line-0-64"><span class="linenos"></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<a id="line-0-65" name="line-0-65"></a><a href="#line-0-65"><span class="linenos"></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">size_human</span><span class="p">)</span>
<a id="line-0-66" name="line-0-66"></a><a href="#line-0-66"><span class="linenos"></span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">permissions_oct</span><span class="p">)</span>
<a id="line-0-67" name="line-0-67"></a><a href="#line-0-67"><span class="linenos"></span></a>
<a id="line-0-68" name="line-0-68"></a><a href="#line-0-68"><span class="linenos"></span></a>        <span class="c1"># A boolean flag indicating if path is a directory</span>
<a id="line-0-69" name="line-0-69"></a><a href="#line-0-69"><span class="linenos"></span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">is_directory</span><span class="p">(</span><span class="s1">'/remote/path'</span><span class="p">)</span>
<a id="line-0-70" name="line-0-70"></a><a href="#line-0-70"><span class="linenos"></span></a>
<a id="line-0-71" name="line-0-71"></a><a href="#line-0-71"><span class="linenos"></span></a>        <span class="c1"># A boolean flag indicating if path is a file</span>
<a id="line-0-72" name="line-0-72"></a><a href="#line-0-72"><span class="linenos"></span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">is_file</span><span class="p">(</span><span class="s1">'/remote/path'</span><span class="p">)</span>
<a id="line-0-73" name="line-0-73"></a><a href="#line-0-73"><span class="linenos"></span></a>
<a id="line-0-74" name="line-0-74"></a><a href="#line-0-74"><span class="linenos"></span></a>        <span class="c1"># A boolean flag indicating if path is a symlink</span>
<a id="line-0-75" name="line-0-75"></a><a href="#line-0-75"><span class="linenos"></span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">is_symlink</span><span class="p">(</span><span class="s1">'/remote/path'</span><span class="p">)</span>
<a id="line-0-76" name="line-0-76"></a><a href="#line-0-76"><span class="linenos"></span></a>
<a id="line-0-77" name="line-0-77"></a><a href="#line-0-77"><span class="linenos"></span></a>        <span class="c1"># List contents of a directory - items are in the same format that .get_info uses</span>
<a id="line-0-78" name="line-0-78"></a><a href="#line-0-78"><span class="linenos"></span></a>        <span class="n">items</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">list</span><span class="p">(</span><span class="s1">'/remote/path'</span><span class="p">)</span>
<a id="line-0-79" name="line-0-79"></a><a href="#line-0-79"><span class="linenos"></span></a>
<a id="line-0-80" name="line-0-80"></a><a href="#line-0-80"><span class="linenos"></span></a>        <span class="c1"># Move (rename) remote files or directories</span>
<a id="line-0-81" name="line-0-81"></a><a href="#line-0-81"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s1">'/from/path'</span><span class="p">,</span> <span class="s1">'/to/path'</span><span class="p">)</span>
<a id="line-0-82" name="line-0-82"></a><a href="#line-0-82"><span class="linenos"></span></a>
<a id="line-0-83" name="line-0-83"></a><a href="#line-0-83"><span class="linenos"></span></a>        <span class="c1"># An alias to .move</span>
<a id="line-0-84" name="line-0-84"></a><a href="#line-0-84"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">'/from/path'</span><span class="p">,</span> <span class="s1">'/to/path'</span><span class="p">)</span>
<a id="line-0-85" name="line-0-85"></a><a href="#line-0-85"><span class="linenos"></span></a>
<a id="line-0-86" name="line-0-86"></a><a href="#line-0-86"><span class="linenos"></span></a>        <span class="c1"># Change mode of entry at path</span>
<a id="line-0-87" name="line-0-87"></a><a href="#line-0-87"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="s1">'600'</span><span class="p">,</span> <span class="s1">'/path/to/entry'</span><span class="p">)</span>
<a id="line-0-88" name="line-0-88"></a><a href="#line-0-88"><span class="linenos"></span></a>
<a id="line-0-89" name="line-0-89"></a><a href="#line-0-89"><span class="linenos"></span></a>        <span class="c1"># Change owner of entry at path</span>
<a id="line-0-90" name="line-0-90"></a><a href="#line-0-90"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">chown</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">,</span> <span class="s1">'/path/to/entry'</span><span class="p">)</span>
<a id="line-0-91" name="line-0-91"></a><a href="#line-0-91"><span class="linenos"></span></a>
<a id="line-0-92" name="line-0-92"></a><a href="#line-0-92"><span class="linenos"></span></a>        <span class="c1"># Change group of entry at path</span>
<a id="line-0-93" name="line-0-93"></a><a href="#line-0-93"><span class="linenos"></span></a>        <span class="n">conn</span><span class="o">.</span><span class="n">chgrp</span><span class="p">(</span><span class="s1">'mygroup'</span><span class="p">,</span> <span class="s1">'/path/to/entry'</span><span class="p">)</span>
</code></pre></div>
<h2 id="summary">Summary</h2>
<p>Given how important SFTP is in telecommunications, having a convenient and easy way to automate it using Python is an essential
ability in a network engineer's skill-set.</p>
<p>Thanks to the SFTP connections in Zato, you can prototype SFTP scripts in Dashboard and employ them in API services right after that.
To complement it, a full Python API is available for programmatic access to remote file servers.</p>
<p>Combined, the features make
it possible to create scalable and reusable file transfer services in a quick and efficient manner using the most convenient
programming language, Python.</p>
<h2 id="more-resources">More resources</h2>
<p>â¤  <a href="https://zato.io/en/industry/telecom/index.html">Click here</a> to read more about using Python and Zato in telecommunications
<br />
â¤ <a href="https://zato.io/articles/network-packet-broker.html">What is a Network Packet Broker? How to automate networks in Python?</a>
<br />
â¤ <a href="https://zato.io/articles/integration-platform.html">What is an integration platform?</a>
<br />
â¤ <a href="https://zato.io/articles/python-ipaas.html">Python Integration platform as a Service (iPaaS)</a>
<br />
â¤ <a href="https://zato.io/en/docs/3.2/intro/esb-soa.html">What is an Enterprise Service Bus (ESB)? What is SOA?</a></p>
<div class="nav-title footer">
    <a class="rounded nav-title" href="https://zato.io/en/blog/">More blog posts</a><span class="arrow-footer">â¤</span>
</div>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 29, 2024 08:00 AM UTC by
            <a href="https://zato.io/blog/rss.xml" class="link link-hover text-primary"
              >Zato Blog</a
            >
          </div>
          <a
            href="https://zato.io/en/blog/sftp.html"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://www.turnkeylinux.org/blog/python-externally-managed-environment" class="hover:underline"
              >Python PEP 668 - working with "externally managed environment"</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even"><p>Python Linux users would have noticed that python is now an "externally managed environment" on newer releases of most OS. That is indeed the case for Debian 10/Bookworm and thus TurnKey v18.x. It certainly did for me - at least initially. <a href="https://github.com/marcos-mendez">Marcos</a>, a long term friend of TurnKey recently reached out to me to ask about the best way to work around this when developing on our <a href="https://www.turnkeylinux.org/odoo">Odoo appliance</a>.</p>

<h3>The issue</h3>
<p>Before I go on, for those of you who are not sure what I'm talking about, try installing or updating a python package via pip. It will fail with an error message:</p>

<pre>
error: externally-managed-environment

Ã This environment is externally managed
â°â&gt; To install Python packages system-wide, try apt install
    python3-xyz, where xyz is the package you are trying to
    install.
    
    If you wish to install a non-Debian-packaged Python package,
    create a virtual environment using python3 -m venv path/to/venv.
    Then use path/to/venv/bin/python and path/to/venv/bin/pip. Make
    sure you have python3-full installed.
    
    If you wish to install a non-Debian packaged Python application,
    it may be easiest to use pipx install xyz, which will manage a
    virtual environment for you. Make sure you have pipx installed.
    
    See /usr/share/doc/python3.11/README.venv for more information.

note: If you believe this is a mistake, please contact your Python installation or OS distribution provider. You can override this, at the risk of breaking your Python installation or OS, by passing --break-system-packages.
hint: See PEP 668 for the detailed specification.</pre>

<p>This does fix a legitimate issue. The previous behavior (the same you get now with '--break-system-packages') could lead to some painful situations where apt and pip can fight for which version of a python library will installed. Meaning that a python library version might change unexpectedly. Regardless, this change is also a big PITA for developers used to the previous behavior, especially when working on a specific OS version when mostly only system packages are required. To read more detail about the rationale of this change, please see <a href="https://peps.python.org/pep-0668/">PEP 668</a>.</p>

<h3>Resolution options<h3>
</h3></h3><p>As per the message, installing Python packages via apt is preferable. But what about if you need a python library not available in Debian? Or a newer version that what Debian provides? As noted by the error message, using a Python venv is the next best option. But that means duplication of any apt packages you may already have installed therefore bloat. It also means that you miss out on the automated security updates that TurnKey provides for Debian packages. The only remaining option is to "break system packages". That doesn't sound good! It will revert your system to the behavior before the application of PEP 668 - thus making life more complicated in the future...</p>

<h3>Pros and Cons of each approach.</h3>
<p>Assuming that you want/need versions and/or packages not available in Debian, what is the best path? Obviously each option has pros and cons, so which way should you go? In his message to me, Marcos nicely laid out the pros and cons of each of the 2 suggested approaches, so I'll share them here:
</p><h4>Virtual Environment</h4>
<u>Pros:</u>
<ul>
<li>Isolates application dependencies, avoiding conflicts with system packages.</li>
<li>Allows for more flexible and up-to-date package management.</li>
</ul>
<u>Cons:</u>
<ul>
<li>Adds complexity to the setup and maintenance process.</li>
<li>Increases the overall footprint and resource requirements of the deployment.</li>
</ul>
 
<h4>System-Wide Installation</h4>
<u>Pros:</u>
<ul>
<li>Simpler setup and integration with the system.</li>
<li>Utilizes the standard Turnkey Linux deployment model.</li>
</ul>
<u>Cons:</u>
<ul>
<li>Potential conflicts with system-managed packages.</li>
<li>Limited by the constraints imposed by Debian 12.</li>
</ul>

<h3>Another - perhaps better - option</h3>

<p>Another option not noted in the pip error message is to create a virtual environment, with the system python libraries passed into the venv. Whilst it's still not perfect, in my option it is by far the best option for many scenarios - unless of course you can get by just using system packages alone. TBH, I'm a bit surprised that it's not noted in the error message. It's pretty easy to set up, just include adding the '--system-site-packages' switch when creating your virtual environment. I.e.:</p>

<pre>python3 -m venv --system-site-packages /path/to/venv</pre>

<h3>What you get with this approach</h3>

<p>Let's have a look at what you get when using '--system-site-packages'. First let's create an example venv. Note that all of this is running as root from root's home (/root). Although for any AWS Marketplace users (or non TurnKey users) most of these commands should work fine as a "sudo" user (for apt installs).</p>

<pre>
root@core ~# mkdir ~/test_venv
root@core ~# python3 -m venv --system-site-packages ~/test_venv
root@core ~# source ~/test_venv/bin/activate
(test_venv) root@core ~#
</pre>

<p>Now for a demonstration of what happens when you use it.</p>

<p>I'll use a couple of apt packages with my examples:</p>
<ul>
<li>python3-pygments (initially installed)</li>
<li>python3-socks (initially not-installed)</li>
</ul>

<p>Continuing on from creating the venv above, let's confirm the package versions and status:</p>

<pre>
(test_venv) root@core ~# apt list python3-pygments python3-socks
Listing... Done
python3-pygments/stable,now 2.14.0+dfsg-1 all [installed,automatic]
python3-socks/stable 1.7.1+dfsg-1 all
</pre>

<p>So we have python3-pygments installed and it's version 2.14.0. python3-socks is not installed, but the available version is 1.7.1. Now let's check that the installed package (pygments) is available in the venv and that it's the system version. For those not familiar with grep, the grep command used here does a case-insensitive search for lines that include socks or pygments.</p>

<pre>
(test_venv) root@core ~# pip list | grep -i 'socks\|pygments'
Pygments           2.14.0
</pre>

<p>Let's install python3-socks and check the status again:</p>

<pre>
(test_venv) root@core ~# apt install -y python3-socks
[...]
(test_venv) root@core ~# apt list python3-pygments python3-socks
Listing... Done
python3-pygments/stable,now 2.14.0+dfsg-1 all [installed,automatic]
python3-socks/stable,now 1.7.1+dfsg-1 all [installed]
</pre>

<p>Ok so python3-socks is installed now. And it's instantly available in our venv:</p>
<pre>
(test_venv) root@core ~# pip list | grep -i 'socks\|pygments'
Pygments           2.14.0
PySocks            1.7.1
</pre>
<p>Woohoo! :) And can we still install and/or update packages in our venv with pip?:</p>

<pre>
(test_venv2) root@core ~# pip install --upgrade pygments
Requirement already satisfied: pygments in /usr/lib/python3/dist-packages (2.14.0)
Collecting pygments
  Downloading pygments-2.18.0-py3-none-any.whl (1.2 MB)
     ââââââââââââââââââââââââââââââââââââââââ 1.2/1.2 MB 6.5 MB/s eta 0:00:00
Installing collected packages: pygments
  Attempting uninstall: pygments
    Found existing installation: Pygments 2.14.0
    Not uninstalling pygments at /usr/lib/python3/dist-packages, outside environment /root/test_venv2
    Can't uninstall 'Pygments'. No files were found to uninstall.
Successfully installed pygments-2.18.0
</pre>

<p>Yes! When using pip install in our venv there are some extra lines related to the system package, but otherwise it's the same as using a standalone venv. Let's double check the new version:</p>

<pre>
(test_venv) root@core ~# pip list | grep -i 'socks\|pygments'
Pygments           2.18.0
PySocks            1.7.1
</pre>

<p>So we've updated from the system version of Pygments to 2.18.0, but the system version still exists - and is still 2.14.0:</p>

<pre>
(test_venv) root@core ~# apt list python3-pygments              
Listing... Done
python3-pygments/stable,now 2.14.0+dfsg-1 all [installed,automatic]
</pre>

<p>So what happens if we remove the pip installed version?:</p>
<pre>
(test_venv) root@core ~# pip uninstall pygments
Found existing installation: Pygments 2.18.0
Uninstalling Pygments-2.18.0:
  Would remove:
    /root/test_venv2/bin/pygmentize
    /root/test_venv2/lib/python3.11/site-packages/pygments-2.18.0.dist-info/*
    /root/test_venv2/lib/python3.11/site-packages/pygments/*
Proceed (Y/n)? y
  Successfully uninstalled Pygments-2.18.0
</pre>

<p>This time there is no mention of the system package. Let's double check the system and the venv:</p>

<pre>
(test_venv) root@core ~# apt list python3-pygments
Listing... Done
python3-pygments/stable,now 2.14.0+dfsg-1 all [installed,automatic]
(test_venv) root@core ~# pip list | grep -i 'pygments'
Pygments           2.14.0
</pre>

<p>Yep, the system package is still there and the venv has reverted to using the system version.</p>

<h3>The best of both worlds?</h3>

<p>In the context of TurnKey (and other Linux OS) usage, '--system-site-packages' essentially gives you the behavior of '--break-system-packages' - without having to actually break system packages. For those that used the previous behavior, I'd argue that it is the best of both worlds. It allows developers to develop in a manner similar to how it was done previously, but cleaner. Where possible you can use system packages via apt, but you still have many of the added advantages of a virtual environment.</p>

<p>However it should be noted that there are still some pitfalls. Such as accidental optional dependency fulfillment by system packages - e.g. a `try: import foo except ImportError:`. Or a system package update changing behavior of your dependencies - generally that shouldn't be an issue with a "stable" Linux distro like TurnKey/Debian; but occasionally can occur. It's also a pain if at some point you need to move your project somewhere else (different OS, different python version, etc) and/or you decide to move to a more isolated venv. Unless you've manually kept track of what dependencies you are using, there is no easy way to work out which libraries your project actually requires. A `pip list` will show all the system python libraries as well - which libraries are actually dependencies of your project? So for completeness, let's list the pros and cons for use of '--system-site-packages':</p>
<h4>Virtual Environment With System Packages</h4>
<u>Pros:</u>
<ul>
<li>Allows for more flexible and up-to-date package management.</li>
<li>Allows the benefits of turnkey (and therefor Debian) security updates.</li>
<li>Simple integration with the system.</li>
<li>Great if you only need a few pip packages or different package versions.</li>
</ul>
<u>Cons:</u>
<ul>
<li>Adds potential complexity to the setup and maintenance process.</li>
<li>Limited by the constraints imposed by Debian 12.</li>
<li>Simple integration with the system - even when you don't want it.</li>
<li>Painful if you want to migrate your project to another OS.</li>
</ul>


<p>So in summary, for python developers targeting a wider and more python version agnostic audience, this isn't for you. In a situation like that, use a default isolated venv. But for people like me that used to survive with the old pip behavior (aka '--break-system-packages' now) - IMO this is the best option by far!</p>

<p>What do you think? Feel free to share your thoughts and feedback below.</p></div></div></div><div class="field field-name-taxonomy-vocabulary-7 field-type-taxonomy-term-reference field-label-above"><div class="field-label">Blog Tags:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="https://www.turnkeylinux.org/blog/python">python</a></div><div class="field-item odd"><a href="https://www.turnkeylinux.org/blog/virtual-environment">virtual environment</a></div><div class="field-item even"><a href="https://www.turnkeylinux.org/blog/venv">venv</a></div><div class="field-item odd"><a href="https://www.turnkeylinux.org/blog/apt">apt</a></div><div class="field-item even"><a href="https://www.turnkeylinux.org/blog/pip">pip</a></div><div class="field-item odd"><a href="https://www.turnkeylinux.org/blog/debian">debian</a></div><div class="field-item even"><a href="https://www.turnkeylinux.org/blog/linux">linux</a></div></div></div>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 29, 2024 03:25 AM UTC by
            <a href="http://www.turnkeylinux.org/taxonomy/term/103/0/feed" class="link link-hover text-primary"
              >Turnkey Linux</a
            >
          </div>
          <a
            href="https://www.turnkeylinux.org/blog/python-externally-managed-environment"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://pyfound.blogspot.com/2024/07/notice-of-python-software-foundation.html" class="hover:underline"
              >Notice of Python Software Foundation Bylaws change, effective 10 August 2024</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            There has been a lot of attention directed at our Bylaws over the last few weeks, and as a result of that conversation, the Board was alerted to a defect in our Bylaws that exposes the Foundation to an unbounded financial liability.<br /><br />Specifically, Bylaws Article XIII as originally written compels the Python Software Foundation to extend indemnity coverage to individual Members (including our thousands of âBasic Membersâ) in certain cases, and to advance legal defense expenses to individual Members with surprisingly few restrictions.<br /><br />Further, the Bylaws compel the Foundation to take out insurance to cover these requirements, however, insurance of this nature is not actually available to 501(c)(3) nonprofit corporations such as the Python Software Foundation to purchase, and thus it is impossible in practice to comply with this requirement. <br /><br />In the unlikely but not impossible event of the Foundation being called upon to advance such expenses, the potential financial burden would be virtually unlimited, and there would be no recourse to insurance. <br /><br />As this is an existential threat to the Foundation, the Board has agreed that it must immediately reduce the Foundationâs exposure, and has opted to exercise its ability to amend the Bylaws by a majority vote of the Board directors, rather than by putting it to a vote of the membership, as allowed by Bylaws <a href="https://github.com/python/psf-bylaws/blob/main/bylaws.md#article-xi">Article XI</a>.<br /><br />Acting on legal advice, the full Board has voted unanimously to amend its Bylaws to no longer extend an offer to indemnify, advance legal expenses, or insure Members when they are not serving at the request of the Foundation. The amended Bylaws still allow for indemnification of a much smaller set of individuals acting on behalf of the PSF such as Board Members and officers, which is in line with standard nonprofit governance practices and for which we already hold appropriate insurance.<br /><br />The full text of the changes can be viewed at <a href="https://github.com/python/psf-bylaws/compare/a35a607...298843b">https://github.com/python/psf-bylaws/compare/a35a607...298843b</a> <br /><br />These changes shall become effective on Saturday 10 August 2024, 15 days from the date of this notice.<br /><br />Any questions about these changes may be sent to <a href="mailto:psf@python.org">psf@python.org</a>. We gladly welcome further suggestions or recommendations for future Bylaws amendments. <br /><br />Thank you,<br /><br />The PSF Board of Directors
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 26, 2024 03:33 PM UTC by
            <a href="http://pyfound.blogspot.com/atom.xml" class="link link-hover text-primary"
              >Python Software Foundation</a
            >
          </div>
          <a
            href="https://pyfound.blogspot.com/2024/07/notice-of-python-software-foundation.html"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://kushaldas.in/posts/multi-factor-authentication-in-django.html" class="hover:underline"
              >Multi-factor authentication in django</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <!--
.. title: Multi-factor authentication in django
.. slug: multi-factor-authentication-in-django
.. date: 2024-07-26T16:24:44+02:00
.. tags: MFA, 2FA, Authentication, Django, Security, Python
.. link:
.. description:
.. type: text
-->
<p><a href="https://en.wikipedia.org/wiki/Multi-factor_authentication">Multi-factor authentication</a> is a must have feature in any modern web application. Specially providing support
for both TOTP (think applications on phone) and FIDO2 (say Yubikeys) usage. I created a small Django demo
<a href="https://github.com/kushaldas/mfaforgood">mfaforgood</a> which shows how to enable both.</p>
<p><img alt="demo of login via MFA" src="https://kushaldas.in/images/django_mfa_demo.gif" /></p>
<p>I am using <a href="https://github.com/xi/django-mfa3">django-mfa3</a> for all the hard work, but specially from a <a href="https://github.com/xi/django-mfa3/pull/20">PR
branch</a> from my friend <a href="https://github.com/peppelinux">Giuseppe De Marco</a>.</p>
<p>I also fetched the <a href="https://www.npmjs.com/package/cbor-js">cbor-js</a> package in the repository so that hardware
tokens for FIDO2 to work. I hope this example will help you add the MFA support to your
Django application.</p>
<h2>Major points of the code</h2>
<ul>
<li>Adding example templates from MFA project, with <code>admin</code> theme and adding <code>cbor-js</code> to the required templates.</li>
<li>Adding <code>mfa</code> to <code>INSTALLED_APPS</code>.</li>
<li>Adding <code>mfa.middleware.MfaSessionMiddleware</code> to <code>MIDDLEWARE</code>.</li>
<li>Adding <code>MFA_DOMAIN</code> and <code>MFA_SITE_TITLE</code> to <code>settings.py</code>.</li>
<li>Also adding <code>STATICFILES_DIRS</code>.</li>
<li>Adding <code>mfa.views.MFAListView</code> as the Index view of the application.</li>
<li>Also adding <code>mfa</code> URLs.</li>
</ul>
<p>After login for the first time one can enable MFA in the following screen.</p>
<p><img alt="view of the MFA listing" src="https://kushaldas.in/images/mfa_list_empty.png" /></p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 26, 2024 02:24 PM UTC by
            <a href="http://kushaldas.in/categories/python.xml" class="link link-hover text-primary"
              >Kushal Das</a
            >
          </div>
          <a
            href="https://kushaldas.in/posts/multi-factor-authentication-in-django.html"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://pyfound.blogspot.com/2024/07/pythons-supportive-and-welcoming.html" class="hover:underline"
              >Pythonâs Supportive and Welcoming Environment is Tightly Coupled to Its Progress</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            Python is as popular as it is today because we have gone above and beyond to make this a welcoming community. Being a friendly and supportive community is part of how we are perceived by the wider world and is integral to the wide popularity of Python. We won a â<a href="https://pyfound.blogspot.com/2023/11/psf-wonderfully-welcoming-award-github.html">Wonderfully Welcoming Award</a>â last year at GitHub Universe. <a href="https://github.blog/2023-03-02-why-python-keeps-growing-explained/">Over</a> and <a href="https://www.pulumi.com/why-is-python-so-popular/">over</a> <a href="https://aloa.co/blog/why-python">again</a>, the tech press refers to Python as a supportive community. We arenât the fastest, the newest or the best-funded programming language, but we are the most welcoming and supportive. Our philosophy is a big part of why Python is a fantastic choice for not only new programmers, glue programmers, and folks who split their time between research and programming but for everyone who wants to be part of a welcoming community. <br /><br />We believe to be âwelcomingâ means to do our best to provide all participants with a safe, civil, and respectful environment when they are engaging with our community - on our forums, at PyCon events, and other spaces that have committed to following our <a href="https://policies.python.org/python.org/code-of-conduct">Code of Conduct</a>. That kind of environment doesnât happen by accident - a lot of people have worked hard over a long time to figure out the best ways to nurture this welcoming quality for the Python community. That work has included drafting and improving the Code of Conduct, crafting and implementing processes for enforcing it, and moderating the various online spaces where it applies. And most importantly the huge, collective effort of individuals across the community, each putting in consistent effort to show up in all the positive ways that make the Python community the warm and welcoming place that we know.<br /><br />The recent slew of conversations, initially kicked off in response to a bylaws change proposal, has been pretty alienating for many members of our community. They havenât all posted publicly to explain their feelings, but they have found other ways to let the PSF know how they are feeling.   <br /><ul style="text-align: left;"><li>After the conversation on PSF-Vote had gotten pretty ugly, forty-five people out of ~1000 unsubscribed. (That list has since been put on announce-only)  </li></ul><ul style="text-align: left;"><li>We received a lot of Code of Conduct reports or moderation requests about the PSF-vote mailing list and the discuss.python.org message board conversations. (Several reports have already been acted on or closed and the rest will be soon).</li></ul><ul style="text-align: left;"><li>PSF staff received private feedback that the blanket statements about âneurodiverse peopleâ, the bizarre motives ascribed to the people in charge of the PSF and various volunteers and the sideways comments about the kinds of people making reports were also very off-putting.</li></ul>As an open source code community, we do most things out in the open which is a fantastic strategy for code. (Many eyes, shallow bugs, etc.) We also try to be transparent about what is going on here at the Foundation and are always working to improve visibility into our policies, current resource levels, spending priorities and aspirations. Sometimes staff and volunteers are a little too busy âdoing the work" to âtalk about the workâ but we do our best to be responsive, especially in the areas that people want to know more about. That said, sometimes things do need to be kept confidential, for privacy, legal, or other good reasons. <br /><br />Some examples:<br /><ul style="text-align: left;"><li>Most Code of Conduct reports â Oftentimes, these reports have the potential to affect both the reporter and the reported personâs reputations and livelihoods so our practice is to keep them confidential when possible to protect everyone involved. Some of you have been here long enough to remember the incident at PyCon US in 2013, an example of the entire internet discussing a Code of Conduct violation that led to negative repercussions for everyone involved, but especially for the person who reported the behavior.</li></ul><div><ul style="text-align: left;"><li>Legal advice and proceedings â It is an unfortunate fact of the world that the legal system(s) we operate under sometimes require us to keep secret information we might otherwise prefer to disclose, often because doing so could open us up to liability in a way that would create significant risk to the PSF or it could potentially put us in violation of laws or regulation. Itâs our responsibility to follow legal guidance about how to protect the Foundation, our resources, and our mission in these situations. </li></ul><div><ul style="text-align: left;"><li>Mental health, personal history, or disability status â Community members should not, for example, have to disclose their status as neurodivergent or share their history with abuse so that others can decide if they are allowed to be offended. Community members should also not be speculating about other individualsâ characteristics or experience in this regard.</li></ul>We have a moral imperative â as one of the very best places to bring new people into tech and into open source â to keep being good at welcoming new people. If we do not rise and continue to rise every day to this task, then we are not fulfilling our own mission, âto support and facilitate the growth of a<a href="https://www.python.org/psf/diversity/"> diverse</a> and international community of Python programmers.â Technical skills are a game-changer for the people who acquire them and joining a vast global network of people with similar interests opens many doors. Behavior that contributes to a hostile environment around Python or throws up barriers and obstacles to those who would join the Python community must be addressed because it endangers what we have built here. <br /><br />Part of the care-taking of a diverse community âwhere everyone feels welcomeâ sadly often means asking some people to leave â or at least take a break. This is known as the <a href="https://en.wikipedia.org/wiki/Paradox_of_tolerance">paradox of tolerance</a>. We can not tolerate intolerance and we will not allow combative and aggressive behavior to ruin the experience in our spaces for everyone else. People do make honest mistakes and donât always understand the impact that their words have had. All we ask is that as community members we all do our best to adhere to the Code of Conduct weâve committed to as a community, and that we gracefully accept feedback when our efforts fall short. Sometimes that means learning that the words, assumptions or tone youâre using arenât coming across the way youâve intended. When a personâs words and actions repeatedly come in conflict with our community norms and cause harm, and that pattern hasnât changed in response to feedback â then we have to ask people to take a break or as a last resort to leave the conversation. <br /><br />Our forum, mailing lists and events will continue to be moderated. We want to thank everyone who contributed positively to the recent conversations and everyone who made the hard choice to write to us to point out off-putting, harmful, unwelcoming or offensive comments. We especially want to thank all the volunteers who serve on the <a href="https://discuss.python.org/">Python Discourse</a> moderation team and our Code of Conduct Working Group. We know itâs been a long couple of weeks, and although your work may occasionally be draining and unpleasant, it is also absolutely essential and endlessly appreciated by the vast majority of the community. Thank you for everything you do!<br /><br /><br />Sincerely, <br />Deb Nicholson<br />Dawn Wages<br />Tania Allard<br />KwonHan Bae<br />Kushal Das<br />Georgi Ker<br />Jannis Leidel<br />CristiÃ¡n Maureira-Fredes<br />Christopher Neugebauer<br />Denny Perez<br />Cheuk Ting Ho<br />Simon Willison<p></p></div></div>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 26, 2024 01:49 PM UTC by
            <a href="http://pyfound.blogspot.com/atom.xml" class="link link-hover text-primary"
              >Python Software Foundation</a
            >
          </div>
          <a
            href="https://pyfound.blogspot.com/2024/07/pythons-supportive-and-welcoming.html"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://realpython.com/podcasts/rpp/214/" class="hover:underline"
              >The Real Python Podcast â Episode #214: Build Captivating Display Tables in Python With Great Tables</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            Do you need help making data tables in Python look interesting and attractive? How can you create beautiful display-ready tables as easily as charts and graphs in Python? This week on the show, we speak with Richard Iannone and Michael Chow from Posit about the Great Tables Python library.
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 26, 2024 12:00 PM UTC by
            <a href="https://realpython.com/atom.xml" class="link link-hover text-primary"
              >Real Python</a
            >
          </div>
          <a
            href="https://realpython.com/podcasts/rpp/214/"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://talkpython.fm/episodes/show/472/state-of-flask-and-pallets-in-2024" class="hover:underline"
              >#472: State of Flask and Pallets in 2024</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            Flask is one of the most important Python web frameworks and powers a bunch of the internet. David Lord, Flask's lead maintainer is here to give us an update on the state of Flask and Pallets in 2024. If you care about where Flask is and where it's going, you'll definitely want to listen in.
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 26, 2024 08:00 AM UTC by
            <a href="http://www.talkpythontome.com/episodes/rss" class="link link-hover text-primary"
              >Talk Python to Me</a
            >
          </div>
          <a
            href="https://talkpython.fm/episodes/show/472/state-of-flask-and-pallets-in-2024"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://rickardlindberg.me/2024/07/26/output-tracking-vs.html" class="hover:underline"
              >Output Tracking vs Mocks</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p>This post has not yet been imported to my new blog.</p>
<p>In the meantime, you can read it here: <a href="http://archive.rickardlindberg.me/writing/output-tracking-vs-mocks/">http://archive.rickardlindberg.me/writing/output-tracking-vs-mocks/</a>.</p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 26, 2024 12:00 AM UTC by
            <a href="http://rickardlindberg.me/tags/python/rss.xml" class="link link-hover text-primary"
              >Rickard Lindberg</a
            >
          </div>
          <a
            href="https://rickardlindberg.me/2024/07/26/output-tracking-vs.html"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
    <div
      class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow duration-300 flex flex-col h-[450px] overflow-hidden"
    >
      <div class="card-body p-0 flex flex-col h-full">
        <!-- Title Section -->
        <div class="bg-primary text-primary-content p-4 rounded-t-2xl">
          
          <h2 class="card-title text-xl font-bold text-white">
            <a href="https://www.europython-society.org/europython-2024-code-of-conduct-transparency-report/" class="hover:underline"
              >EuroPython 2024 Code of Conduct Transparency Report</a
            >
          </h2>
          
        </div>

        <!-- Content Section -->
        <div class="p-4 flex-grow overflow-hidden">
          <p class="text-base-content">
            <p>The 2024 version of the <a href="https://ep2024.europython.eu/">EuroPython conference</a> took place both online and in person in July 2024. This was the second conference under our <a href="https://www.europython-society.org/coc/">new Code of Conduct</a> (CoC), and we had <a href="https://www.europython-society.org/coc/#contact-information">Code of Conduct working group members</a> continuously available both online and in person.</p><!--kg-card-begin: markdown--><h2 id="reports">Reports</h2>
<p>We had 4 Code</p>
          </p>
        </div>

        <!-- Footer Section -->
        <div class="mt-auto bg-base-200 p-4 rounded-b-2xl">
          <div class="text-sm text-base-content/70 mb-2">
            Posted on July 25, 2024 06:00 AM UTC by
            <a href="http://www.europython-society.org/rss" class="link link-hover text-primary"
              >EuroPython Society</a
            >
          </div>
          <a
            href="https://www.europython-society.org/europython-2024-code-of-conduct-transparency-report/"
            class="btn btn-secondary btn-sm w-full hover:btn-accent transition-colors duration-300"
          >
            Read More
          </a>
        </div>
      </div>
    </div>
    
  </div>
  <div class="mt-8"><div class="btn-group my-4"><a href="index9.html" class="btn">Â«</a><a href="index8.html" class="btn hover:bg-primary hover:shadow-lg hover:shadow-primary/50">8</a><a href="index9.html" class="btn hover:bg-primary hover:shadow-lg hover:shadow-primary/50">9</a><button class="btn btn-active hover:bg-primary hover:shadow-lg hover:shadow-primary/50">10</button></div></div>
</div>

      </div>
      <div class="drawer-side">
        <label for="my-drawer-2" class="drawer-overlay"></label>
        
<ul class="menu p-4 w-80 min-h-full bg-base-200 text-base-content">
  <li class="menu-title">Stats</li>
  
    <li><a>Total Entries: 9024</a></li>
    <li><a>Unique Feeds: 430</a></li>
    

  <li class="menu-title mt-4">Top Authors</li>
  <div class="pl-4 max-h-48 overflow-y-auto"><li><a href="https://pythonbytes.fm/episodes/rss">Talk Python to Me (477)</a></li><li><a href="https://www.mattlayman.com/categories/python/index.xml">Awesome Python Applications (424)</a></li><li><a href="http://www.talkpythontome.com/episodes/rss">Python Bytes (403)</a></li><li><a href="https://pythonbytes.fm/episodes/rss">Matt Layman (313)</a></li><li><a href="http://www.talkpythontome.com/episodes/rss">Test and Code (221)</a></li></div>

  <li class="menu-title mt-4">Feeds</li>
  <div class="pl-4 max-h-96 overflow-y-auto">
    <ul>
      
      <li><a href="http://dev.2degreesnetwork.com/feeds/posts/default/-/python">2degrees</a></li>
      
      <li><a href="https://emptysqua.re/blog/category/python/index.xml">A. Jesse Jiryu Davis</a></li>
      
      <li><a href="http://www.artima.com/weblogs/feeds/bloggers/aahz.rss">Aahz</a></li>
      
      <li><a href="https://djangocentral.com/feed/">Abhijeet Pal</a></li>
      
      <li><a href="http://masnun.rocks/tags/python/index.xml">Abu Ashraf Masnun</a></li>
      
      <li><a href="http://techarttiki.blogspot.com/feeds/posts/default/-/python">Adam Pletcher</a></li>
      
      <li><a href="http://agendaless.com/blog/index.atom?category=python">Agendaless Consulting</a></li>
      
      <li><a href="https://www.ahmedbouchefra.com/python/feed.xml">Ahmed Bouchefra</a></li>
      
      <li><a href="http://alstatr.blogspot.com/feeds/posts/default/-/Python">Al-Ahmadgaid Asaad</a></li>
      
      <li><a href="http://alecmunro.blogspot.com/feeds/posts/default/-/python">Alec Munro</a></li>
      
      <li><a href="http://alextechrants.blogspot.com/feeds/posts/default/-/python">Alex GrÃ¶nholm</a></li>
      
      <li><a href="https://alexmorozov.github.io/feeds/tag-python.atom.xml">Alex Morozov</a></li>
      
      <li><a href="http://www.alexconrad.org/feeds/posts/default/-/python">Alexandre Conrad</a></li>
      
      <li><a href="http://peadrop.com/blog/category/python/feed/">Alexandre Vassalotti</a></li>
      
      <li><a href="http://feeds.feedburner.com/en_lexevorg">Alexey Evseev</a></li>
      
      <li><a href="http://akaptur.github.io/blog/categories/python/atom.xml">Allison Kaptur</a></li>
      
      <li><a href="http://blog.amjith.com/posts.atom?tag=python">Amjith Ramanujam</a></li>
      
      <li><a href="http://blog.amvtek.com/feeds/tags/python.atom.xml">AmvTek</a></li>
      
      <li><a href="https://anarc.at/tag/python-planet/index.rss">Anarcat</a></li>
      
      <li><a href="http://techtonik.rainforce.org/feeds/posts/default/-/python">Anatoly Techtonik</a></li>
      
      <li><a href="http://aroberge.blogspot.com/atom.xml">Andre Roberge</a></li>
      
      <li><a href="http://dalkescientific.com/writings/diary/diary-rss.xml">Andrew Dalke</a></li>
      
      <li><a href="http://mindref.blogspot.com/feeds/posts/default/-/python">Andriy Kornatskyy</a></li>
      
      <li><a href="http://mysql-python.blogspot.com/feeds/posts/default">Andy Dustman</a></li>
      
      <li><a href="http://andy.terrel.us/feeds/python-tag.rss.xml">Andy R. Terrel</a></li>
      
      <li><a href="http://annaraven.blogspot.com/feeds/posts/default/-/python">Anna Martelli Ravenscroft</a></li>
      
      <li><a href="http://codingweasel.blogspot.com/feeds/posts/default/-/python">Anthony Baxter</a></li>
      
      <li><a href="http://kpoxit.blogspot.com/feeds/posts/default/-/python">Anton Belyaev</a></li>
      
      <li><a href="http://bobrochel.blogspot.com/feeds/posts/default/-/python">Anton Bobrov</a></li>
      
      <li><a href="https://anweshadas.in/tag/python/rss/">Anwesha Das</a></li>
      
      <li><a href="http://lucumr.pocoo.org/feed.atom">Armin Ronacher</a></li>
      
      <li><a href="https://rushter.com/blog/feed/pyplanet.xml">Artem Golubin</a></li>
      
      <li><a href="https://medium.com/feed/python4you">Artem Rys</a></li>
      
      <li><a href="http://pyfunc.blogspot.com/feeds/posts/default/-/python">Ashish Vidyarthi</a></li>
      
      <li><a href="http://astrocodeschool.com/feeds/all.rss.xml">Astro Code School</a></li>
      
      <li><a href="https://raw.githubusercontent.com/mahmoud/awesome-python-applications/master/atom.xml">Awesome Python Applications</a></li>
      
      <li><a href="http://baijum.blogspot.com/feeds/posts/default/-/python">Baiju Muthukadan</a></li>
      
      <li><a href="http://gbtami.github.io/feed.python.xml">Bajusz TamÃ¡s</a></li>
      
      <li><a href="http://www.bedjango.com/planet/feed/">BeDjango</a></li>
      
      <li><a href="http://codedstructure.blogspot.com/feeds/posts/default/-/python">Ben Bass</a></li>
      
      <li><a href="https://jbencook.com/feed.xml">Ben Cook</a></li>
      
      <li><a href="http://clusterbleep.net/blog/category/python/feed/">Ben Rousch</a></li>
      
      <li><a href="http://pybites.blogspot.com/feeds/posts/default">Benjamin Peterson</a></li>
      
      <li><a href="http://www.benjiyork.com/blog/atom.xml">Benji York</a></li>
      
      <li><a href="http://zebert.blogspot.com/feeds/posts/default/-/python">Bertrand Mathieu</a></li>
      
      <li><a href="https://geeksocket.in/tags/python/index.xml">Bhavin Gandhi</a></li>
      
      <li><a href="http://feeds.feedburner.com/thetaranights">Bhishan Bhandari</a></li>
      
      <li><a href="http://news.open-bio.org/news/category/obf-projects/biopython/feed/atom/">BioPython News</a></li>
      
      <li><a href="http://bitofcheese.blogspot.com/feeds/posts/default">Bit of Cheese</a></li>
      
      <li><a href="http://source.mihelac.org/feeds/categories/django/">Bojan Mihelac</a></li>
      
      <li><a href="http://rhodesmill.org/brandon/category/python/feed">Brandon Rhodes</a></li>
      
      <li><a href="http://python4dads.wordpress.com/feed/">Brendan Scott</a></li>
      
      <li><a href="https://snarky.ca/rss/">Brett Cannon</a></li>
      
      <li><a href="http://pythontest.com/posts/index.xml">Brian Okken</a></li>
      
      <li><a href="http://nicoddemus.github.io/tag/python/atom.xml">Bruno Oliveira</a></li>
      
      <li><a href="https://www.codingthepast.com/feed_python_planet.xml">Bruno Ponne / Coding The Past</a></li>
      
      <li><a href="http://brunorocha.org/tag/pythonplanet.atom">Bruno Rocha</a></li>
      
      <li><a href="http://www.caktusgroup.com/feeds/tags/python/">Caktus Consulting Group</a></li>
      
      <li><a href="http://techblog.ironfroggy.com/feeds/posts/default/-/programming">Calvin Spealman</a></li>
      
      <li><a href="http://carlchenet.com/category/planetpython/feed/">Carl Chenet</a></li>
      
      <li><a href="https://carl.duevel.online/tags/python/index.xml">Carl DÃ¼vel</a></li>
      
      <li><a href="http://pyright.blogspot.com/feeds/posts/default?alt=rss">Carl Trachte</a></li>
      
      <li><a href="http://themindcaster.blogspot.com/feeds/posts/default/-/python">Carlos Eduardo de Paula</a></li>
      
      <li><a href="http://eatthedots.blogspot.com/feeds/posts/default">Casey Duncan</a></li>
      
      <li><a href="http://catherinedevlin.blogspot.com/feeds/posts/default/-/python">Catherine Devlin</a></li>
      
      <li><a href="https://chinghwayu.com/category/python/feed/">Ching-Hwa Yu</a></li>
      
      <li><a href="https://www.metachris.com/tags/python/index.xml">Chris Hager</a></li>
      
      <li><a href="http://chris-miles-writes-python.blogspot.com/feeds/posts/default?alt=rss">Chris Miles</a></li>
      
      <li><a href="http://pyinformatics.blogspot.com/feeds/posts/default">Chris Mitchell</a></li>
      
      <li><a href="http://pbpython.com/feeds/all.atom.xml">Chris Moffitt</a></li>
      
      <li><a href="http://ideas.offby1.net/feeds/tag-python.atom.xml">Chris Rose</a></li>
      
      <li><a href="http://feeds.feedburner.com/ChrisWarrickPython">Chris Warrick</a></li>
      
      <li><a href="http://lipyrary.blogspot.com/feeds/posts/default">Christian Heimes</a></li>
      
      <li><a href="https://dev.to/feed/ldrscke.rss">Christian Ledermann</a></li>
      
      <li><a href="http://feeds.feedburner.com/mrtopf-python">Christian Scholz</a></li>
      
      <li><a href="https://cito.github.io/tags/python/index.xml">Christoph Zwerschke</a></li>
      
      <li><a href="https://blog.codegrades.com/feed.xml">CodeGrades</a></li>
      
      <li><a href="http://codesnipers.com/?q=taxonomy/term/16/0/feed">CodeSnipers</a></li>
      
      <li><a href="https://coderslegacy.com/category/python/feed/">CodersLegacy</a></li>
      
      <li><a href="http://allanderek.github.io/categories/python.xml">Coding Diet</a></li>
      
      <li><a href="https://www.gallon.me/tag/python/feed">Corey Gallon</a></li>
      
      <li><a href="http://feeds.feedburner.com/goldblog/python">Corey Goldberg</a></li>
      
      <li><a href="http://feeds.feedburner.com/cormoran-project">Cormoran Project</a></li>
      
      <li><a href="http://feeds2.feedburner.com/portablecommandline">Cross-Platform Command Line Tools</a></li>
      
      <li><a href="http://feeds.feedburner.com/cubicweborg">CubicWeb</a></li>
      
      <li><a href="https://ntguardian.wordpress.com/category/python/feed/">Curtis Miller</a></li>
      
      <li><a href="http://dspillustrations.com/static/dspillustrations.rss.xml">DSPIllustrations.com</a></li>
      
      <li><a href="http://dailytechvideo.com/category/python/feed/">Daily Tech Video (Python)</a></li>
      
      <li><a href="http://dfwpython.blogspot.com/feeds/posts/default">Dallas Fort Worth Pythoneers</a></li>
      
      <li><a href="http://late.am/python.feed.xml">Dan Crosta</a></li>
      
      <li><a href="http://strombrg.blogspot.com/feeds/posts/default/-/Python">Dan Stromberg</a></li>
      
      <li><a href="http://dan.yeaw.me/categories/python.xml">Dan Yeaw</a></li>
      
      <li><a href="http://dbader.org/blog/tags/python/rss">Daniel Bader</a></li>
      
      <li><a href="https://daniel.roygreenfeld.com/feeds/python.atom.xml">Daniel Roy Greenfeld</a></li>
      
      <li><a href="https://www.dataschool.io/tag/python/rss/">Data School</a></li>
      
      <li><a href="https://www.datawars.io/articles/rss.xml">DataWars.io</a></li>
      
      <li><a href="http://dabeaz.blogspot.com/feeds/posts/default">Dave Beazley</a></li>
      
      <li><a href="https://davidamos.dev/tag/python/rss/">David Amos</a></li>
      
      <li><a href="https://davidcaron.dev/feeds/tags/python.atom.xml">David Caron</a></li>
      
      <li><a href="http://www.artima.com/weblogs/feeds/bloggers/goodger.rss">David Goodger</a></li>
      
      <li><a href="http://davidlindelof.com/category/python/feed/">David Lindelof</a></li>
      
      <li><a href="http://www.drmaciver.com/category/python/feed/">David MacIver</a></li>
      
      <li><a href="http://dmalcolm.livejournal.com/data/atom?tag=python">David Malcolm</a></li>
      
      <li><a href="http://www.szotten.com/david/feeds/python.atom.xml">David Szotten</a></li>
      
      <li><a href="http://davidemoro.blogspot.com/feeds/posts/default/-/planetpython">Davide Moro</a></li>
      
      <li><a href="http://feeds2.feedburner.com/Daftpython">Davy Mitchell</a></li>
      
      <li><a href="http://davywybiral.blogspot.com/feeds/posts/default">Davy Wybiral</a></li>
      
      <li><a href="https://declassed.art/en/feed/python.xml">Declassed Art</a></li>
      
      <li><a href="http://makkalot-opensource.blogspot.com/feeds/posts/default/-/python">Denis Kurov</a></li>
      
      <li><a href="http://www.djangoproject.com/rss/weblog/">Django Weblog</a></li>
      
      <li><a href="http://doingmathwithpython.github.io/feeds/all.atom.xml">Doing Math with Python</a></li>
      
      <li><a href="https://feeds.feedburner.com/doughellmann/python">Doug Hellmann</a></li>
      
      <li><a href="http://www.dougalmatthews.com/feeds/python.atom.xml">Dougal Matthews</a></li>
      
      <li><a href="http://oubiwann.blogspot.com/feeds/posts/default/-/python">Duncan McGreggor</a></li>
      
      <li><a href="http://edcrewe.blogspot.com/feeds/posts/default/-/python">Ed Crewe</a></li>
      
      <li><a href="http://edreamleo.blogspot.com/feeds/posts/default/-/python">Edward K. Ream</a></li>
      
      <li><a href="http://eli.thegreenplace.net/feeds/python.atom.xml">Eli Bendersky</a></li>
      
      <li><a href="http://eniramltd.github.io/devblog/rss/categories/python.xml">Eniram Ltd.</a></li>
      
      <li><a href="https://examachine.net/blog/category/python/feed/">Eray Ãzkural (examachine)</a></li>
      
      <li><a href="http://www.marsja.se/category/python/feed/">Erik Marsja</a></li>
      
      <li><a href="http://etienned.github.io/categories/python.xml">Etienne Desautels</a></li>
      
      <li><a href="http://blog.europython.eu/rss">EuroPython</a></li>
      
      <li><a href="http://www.europython-society.org/rss">EuroPython Society</a></li>
      
      <li><a href="http://evennia.blogspot.com/feeds/posts/default">Evennia</a></li>
      
      <li><a href="https://everydaysuperpowers.dev/feed/python/">Everyday Superpowers</a></li>
      
      <li><a href="http://pydev.blogspot.com/atom.xml">Fabio Zadrozny</a></li>
      
      <li><a href="http://en.ig.ma/notebook/feeds/atom/tag/python.xml">Filip Wasilewski</a></li>
      
      <li><a href="http://blog.filipesaraiva.info/?feed=rss2&tag=planet-python">Filipe Saraiva</a></li>
      
      <li><a href="http://pyinsci.blogspot.com/feeds/posts/default">Flavio Coelho</a></li>
      
      <li><a href="http://blog.flaper87.com/feeds/python.atom.xml">Flavio Percoco</a></li>
      
      <li><a href="http://fwierzbicki.blogspot.com/atom.xml">Frank Wierzbicki</a></li>
      
      <li><a href="http://raspberry-python.blogspot.com/feeds/posts/default/-/english/python">FranÃ§ois Dion</a></li>
      
      <li><a href="http://feeding.cloud.geek.nz/tags/python/index.rss">FranÃ§ois Marier</a></li>
      
      <li><a href="http://www.fridh.nl/tag/python.atom.xml">Frederik Rietdijk</a></li>
      
      <li><a href="https://www.frompythonimportpodcast.com/feed">From Python Import Podcast</a></li>
      
      <li><a href="https://www.fullstackpython.com/feeds/all.atom.xml">Full Stack Python</a></li>
      
      <li><a href="http://gael-varoquaux.info/feeds/programming.atom.xml">Ga&#235;l Varoquaux</a></li>
      
      <li><a href="http://compiletoi.net/feeds/python.atom.xml">Georges Dubus</a></li>
      
      <li><a href="http://ghaandeeonit.tumblr.com/rss">Ghaandee on IT</a></li>
      
      <li><a href="https://gmpy.dev/feeds/atom.tag.python.xml">Giampaolo Rodola</a></li>
      
      <li><a href="http://giuliofidente.com/feeds/tag/python.atom.xml">Giulio Fidente</a></li>
      
      <li><a href="http://hackermojo.com/mt-static/tagged/python.rdf">Glenn Franxman</a></li>
      
      <li><a href="http://glyph.twistedmatrix.com/feeds/posts/default">Glyph Lefkowitz</a></li>
      
      <li><a href="http://feeds.feedburner.com/GoDeh">Go Deh</a></li>
      
      <li><a href="http://blog.godson.in/feeds/posts/default/-/Python">Godson Gera</a></li>
      
      <li><a href="http://www.curiousvenn.com/?feed=rss2&cat=4">Graeme Cross</a></li>
      
      <li><a href="http://blog.dscpl.com.au/feeds/posts/default">Graham Dumpleton</a></li>
      
      <li><a href="http://defrobnication.blogspot.com/feeds/posts/default/-/python">Grant Baillie</a></li>
      
      <li><a href="http://www.wisdomandwonder.com/tag/python/feed">Grant Rettke</a></li>
      
      <li><a href="http://gc-taylor.com/?format=rss&category=Python">Greg Taylor</a></li>
      
      <li><a href="http://agiletesting.blogspot.com/feeds/posts/default/-/python">Grig Gheorghiu</a></li>
      
      <li><a href="http://blog.fizyk.net.pl/tags/python.xml">Grzegorz ÅliwiÅski</a></li>
      
      <li><a href="http://neopythonic.blogspot.com/feeds/posts/default">Guido van Rossum</a></li>
      
      <li><a href="http://gustavonarea.net/blog/tags/python/feed/">Gustavo Narea</a></li>
      
      <li><a href="http://blog.labix.org/tag/python/feed">Gustavo Niemeyer</a></li>
      
      <li><a href="http://pycloud.blogspot.com/feeds/posts/default/-/python">GÃ¶khan Sever</a></li>
      
      <li><a href="http://python-in-the-lab.blogspot.de//feeds/posts/default/-/Python">Hernan Grecco</a></li>
      
      <li><a href="http://www.hilarymason.com/tag/python/feed/">Hilary Mason</a></li>
      
      <li><a href="http://tetamap.wordpress.com/feed/atom/">Holger Krekel</a></li>
      
      <li><a href="http://www.holger-peters.de/feeds/python.atom.xml">Holger Peters</a></li>
      
      <li><a href="https://blog.holoviz.org/index.xml">HoloViz</a></li>
      
      <li><a href="https://humberto.io/tags/python/index.xml">Humberto Rocha</a></li>
      
      <li><a href="https://hynek.me/feed-python.xml">Hynek Schlawack</a></li>
      
      <li><a href="http://ianozsvald.com/category/python/feed/atom/">Ian Ozsvald</a></li>
      
      <li><a href="http://ilian.i-n-i.org/feed/?tag=python">Ilian Iliev</a></li>
      
      <li><a href="http://importpython.com/blog/feed/">Import Python</a></li>
      
      <li><a href="https://www.inspiredpython.com/feed">Inspired Python</a></li>
      
      <li><a href="https://blog.ionelmc.ro/feeds/python.rss.xml">Ionel Cristian Maries</a></li>
      
      <li><a href="http://ironpython-urls.blogspot.com/feeds/posts/default">IronPython-URLs</a></li>
      
      <li><a href="https://islandtropicaman.com/wp/category/python/feed/">IslandT</a></li>
      
      <li><a href="http://fruch.github.io/feed.python.xml">Israel Fruchter</a></li>
      
      <li><a href="http://codewithoutrules.com/python-atom.xml">Itamar Turner Trauring</a></li>
      
      <li><a href="https://iximiuz.com/feed-python.atom">Ivan Velichko</a></li>
      
      <li><a href="https://pupeno.com/tag/python/feed/">J. Pablo FernÃ¡ndez</a></li>
      
      <li><a href="http://jackdied.blogspot.com/feeds/posts/default">Jack Diederich</a></li>
      
      <li><a href="http://feeds.feedburner.com/StreamHackerPython">Jacob Perkins</a></li>
      
      <li><a href="http://rahmonov.me/feeds/python.atom.xml">Jahongir Rahmonov</a></li>
      
      <li><a href="http://wrongsideofmemphis.wordpress.com/feed/atom/?tag=english+python">Jaime Buelta</a></li>
      
      <li><a href="http://www.datadependence.com/tag/python/feed/">Jamal Moir</a></li>
      
      <li><a href="https://www.b-list.org/feeds/entries/">James Bennett</a></li>
      
      <li><a href="https://janusworx.com/tags/planetpython/index.xml">Janusworx</a></li>
      
      <li><a href="http://blog.jarrodmillman.com/feeds/posts/default/-/python">Jarrod Millman</a></li>
      
      <li><a href="http://jbisbee.blogspot.com/feeds/posts/default/-/python">Jeff Bisbee</a></li>
      
      <li><a href="http://jeffbradberry.com/feeds/python.atom.xml">Jeff Bradberry</a></li>
      
      <li><a href="http://inre.dundeemt.com/category/python/feed/">Jeff Hinrichs</a></li>
      
      <li><a href="http://griddlenoise.blogspot.com/feeds/posts/default/-/python">Jeff Shell</a></li>
      
      <li><a href="http://greenash.net.au/thoughts/topics/python/rss/">Jeremy Epstein</a></li>
      
      <li><a href="http://jeremyhylton.blogspot.com/atom.xml">Jeremy Hylton</a></li>
      
      <li><a href="http://www.blogger.com/feeds/6330681631629046724/posts/default">Jim Fulton</a></li>
      
      <li><a href="http://pyrseas.wordpress.com/tag/python/feed/atom/">Joe Abbate</a></li>
      
      <li><a href="http://feeds.feedburner.com/JoePitz-TechnologyBlogPython">Joe Pitz</a></li>
      
      <li><a href="http://blogs.gnome.org/johan/category/python/feed/atom">Johan Dahlin</a></li>
      
      <li><a href="http://clouddbs.blogspot.com/feeds/posts/default/-/python">John Burns</a></li>
      
      <li><a href="http://www.johndcook.com/blog/category/python/feed/">John Cook</a></li>
      
      <li><a href="http://eigenhombre.com/feed.python.xml">John Jacobsen</a></li>
      
      <li><a href="https://www.nbshare.io/feeds/all.atom.xml">John Ludhi/nbshare.io</a></li>
      
      <li><a href="http://www.indelible.org/feeds/ink/python.xml">Jon Parise</a></li>
      
      <li><a href="http://spyced.blogspot.com/feeds/posts/default/-/python">Jonathan Ellis</a></li>
      
      <li><a href="http://feeds.feedburner.com/JonathansPythonBlog">Jonathan Harrington</a></li>
      
      <li><a href="https://www.tartley.com/categories/python.xml">Jonathan Hartley</a></li>
      
      <li><a href="http://jonathanstreet.com/blog/tag/python/atom/">Jonathan Street</a></li>
      
      <li><a href="http://blog.jorgenschaefer.de/feeds/posts/default/-/Python">Jorgen SchÃ¤fer</a></li>
      
      <li><a href="http://pythonmonopoly.wordpress.com/feed/">Juan Manuel Contreras</a></li>
      
      <li><a href="http://beauty-of-imagination.blogspot.fr/feeds/posts/default/-/python">Julien Tayon</a></li>
      
      <li><a href="http://www.iki.fi/juri/blog/index.rss">Juri Pakaste</a></li>
      
      <li><a href="http://feeds.hackercodex.com/feeds/python">Justin Mayer</a></li>
      
      <li><a href="http://lautaportti.wordpress.com/feed/atom/">Kai Lautaportti</a></li>
      
      <li><a href="https://www.afternerd.com/blog/tag/python/feed/">Karim Elghamrawy</a></li>
      
      <li><a href="http://nuitka.net/categories/Python.xml">Kay Hayen</a></li>
      
      <li><a href="http://fiber-space.de/wordpress/category/python/feed">Kay Schluehr</a></li>
      
      <li><a href="http://kbyanc.blogspot.com/feeds/posts/default/-/python">Kelly Yancey</a></li>
      
      <li><a href="https://kodnito.com/python/rss/">Kodnito</a></li>
      
      <li><a href="https://devblog.kogan.com/?category=Django&format=rss">Kogan Dev</a></li>
      
      <li><a href="http://konryd.blogspot.com/feeds/posts/default">Konrad Delong</a></li>
      
      <li><a href="https://koodaamo.wordpress.com/category/python/feed">Koodaamo</a></li>
      
      <li><a href="http://cosmicpercolator.com/category/python/feed/atom/">KristjÃ¡n Valur JÃ³nsson</a></li>
      
      <li><a href="http://blog.kritigodey.com/tag/python/rss">Kriti Godey</a></li>
      
      <li><a href="http://gofedora.com/archives/category/python/feed/">Kulbir Saini</a></li>
      
      <li><a href="http://farmdev.com/feeds/thoughts/on/3/python/">Kumar McMillan</a></li>
      
      <li><a href="https://vipin711.wordpress.com/category/python/feed/">Kumar Vipin Yadav</a></li>
      
      <li><a href="http://kushaldas.in/categories/python.xml">Kushal Das</a></li>
      
      <li><a href="http://charlesnagy.info/category/it/python/feed/">KÃ¡roly Nagy</a></li>
      
      <li><a href="https://www.laac.dev/tags/python/index.xml">LAAC Technology</a></li>
      
      <li><a href="http://laurentszyster.be/blog/feed/">Laurent Szyster</a></li>
      
      <li><a href="http://hypatia.ca/tag/python/feed/">Leigh Honeywell</a></li>
      
      <li><a href="http://regebro.wordpress.com/category/python/feed/atom/">Lennart Regebro</a></li>
      
      <li><a href="http://leovt.wordpress.com/category/python/feed/atom/">Leonhard Vogt</a></li>
      
      <li><a href="http://blog.lintel.in/tag/python/feed/">Lintel Technologies</a></li>
      
      <li><a href="https://linuxstans.com/tag/python/feed/">Linux Stans</a></li>
      
      <li><a href="https://www.listendata.com/feeds/posts/default/-/Python">ListenData</a></li>
      
      <li><a href="http://feeds.feedburner.com/logilaborg_en">Logilab</a></li>
      
      <li><a href="http://codingandlinux.blogspot.com/feeds/posts/default/-/python">Luca Botti</a></li>
      
      <li><a href="https://chezsoi.org/shaarli/?do=atom&searchtags=python+FromPelican">Lucas Cimon</a></li>
      
      <li><a href="http://blog.gmludo.eu/feeds/posts/default/-/python">Ludovic Gasc</a></li>
      
      <li><a href="http://lukeplant.me.uk/blog/categories/python/atom/index.xml">Luke Plant</a></li>
      
      <li><a href="http://lostinjit.blogspot.com/feeds/posts/default">Maciej Fijalkowsk</a></li>
      
      <li><a href="https://madewith.mu/feed.xml">Made With Mu</a></li>
      
      <li><a href="http://sedimental.org/tagged/python/atom.xml">Mahmoud Hashemi</a></li>
      
      <li><a href="https://maltheborch.com/rss?tags=python">Malthe Borch</a></li>
      
      <li><a href="https://www.marc-richter.info/category/python/planet-python-articles/feed/">Marc Richter</a></li>
      
      <li><a href="http://www.malemburg.com/rss">Marc-AndrÃ© Lemburg</a></li>
      
      <li><a href="http://www.grulic.org.ar/~mdione/glob/categories/python.xml">Marcos Dione</a></li>
      
      <li><a href="http://mg.pov.lt/blog/index.xml">Marius Gedminas</a></li>
      
      <li><a href="http://shed-skin.blogspot.com/feeds/posts/default">Mark Dufour</a></li>
      
      <li><a href="http://blogs.gnome.org/markmc/category/python/feed/">Mark McLoughlin</a></li>
      
      <li><a href="http://pywinauto.blogspot.com/atom.xml">Mark McMahon</a></li>
      
      <li><a href="http://feeds.feedburner.com/zopatista/python">Martijn Pieters</a></li>
      
      <li><a href="https://www.mfitzp.com/feeds/python.tag.atom.xml">Martin Fitzpatrick</a></li>
      
      <li><a href="https://mathspp.com/blog/pydonts.rss">"Mathspp Pydon'ts"</a></li>
      
      <li><a href="http://mysqlmusings.blogspot.se/feeds/posts/default/-/python">Mats Kindahl</a></li>
      
      <li><a href="https://www.mattlayman.com/categories/python/index.xml">Matt Layman</a></li>
      
      <li><a href="http://matthewrocklin.com/blog/feed.python.xml">Matthew Rocklin</a></li>
      
      <li><a href="http://www.stealthcopter.com/blog/tag/python/feed/">Matthew Rollings</a></li>
      
      <li><a href="http://blog.tplus1.com/index.php/category/python/feed">Matthew Wilson</a></li>
      
      <li><a href="https://www.wrighters.io/category/python/feed/">Matthew Wright</a></li>
      
      <li><a href="http://copypasteprogrammer.blogspot.com/feeds/posts/default/-/python">Mattias BrÃ¤ndstrÃ¶m</a></li>
      
      <li><a href="http://mauveweb.co.uk/rss.xml">Mauveweb</a></li>
      
      <li><a href="http://freshfoo.com/blog/index.atom">"Menno's Musings"</a></li>
      
      <li><a href="http://beckerfuffle.com/blog/categories/python/atom.xml">Michael Becker</a></li>
      
      <li><a href="http://mdboom.github.io/feeds/all.atom.xml">Michael Droettboom</a></li>
      
      <li><a href="https://agileabstractions.com/feed.xml">Michael Foord</a></li>
      
      <li><a href="http://mjtokelly.blogspot.com/feeds/posts/default/-/Python">"Michael J.T. O'Kelly"</a></li>
      
      <li><a href="http://micknelson.wordpress.com/category/python/feed/atom/">Michael Nelson</a></li>
      
      <li><a href="http://mousebender.wordpress.com/feed/atom/">Michal Kwiatkowski</a></li>
      
      <li><a href="https://bultrowicz.com/blog/tag/python/atom.xml">MichaÅ Bultrowicz</a></li>
      
      <li><a href="http://www.artima.com/weblogs/feeds/bloggers/micheles.rss">Michele Simionato</a></li>
      
      <li><a href="http://www.firsttimeprogrammer.blogspot.com/feeds/posts/default/-/python?alt=rss">Michy Alice</a></li>
      
      <li><a href="http://blog.vrplumber.com/index.php?/feeds/categories/1-Snaking.rss">Mike C. Fletcher</a></li>
      
      <li><a href="http://www.blog.pythonlibrary.org/feed/">Mike Driscoll</a></li>
      
      <li><a href="http://python-academy.blogspot.com/feeds/posts/default">Mike MÃ¼ller</a></li>
      
      <li><a href="http://kmike.ru/feeds/tags/planet-python.atom.xml">Mikhail Korobov</a></li>
      
      <li><a href="http://opensourcehacker.com/category/python/feed/">Mikko Ohtamaa</a></li>
      
      <li><a href="https://mirekdlugosz.com/blog/feeds/planet-python.atom.xml">Mirek DÅugosz</a></li>
      
      <li><a href="http://www.elastician.com/feeds/posts/default">Mitchell Garnaat</a></li>
      
      <li><a href="http://pythonbyexample.blogspot.com/feeds/posts/default/">Mitya Sirenef</a></li>
      
      <li><a href="http://montrealpython.com/feed/">Montreal Python User Group</a></li>
      
      <li><a href="http://blogologue.com/atom.xml?category=1470141490X3">"Morphex's Blogologue"</a></li>
      
      <li><a href="https://orbifold.xyz/feeds/all.atom.xml">Moshe Zadka</a></li>
      
      <li><a href="https://www.moyaproject.com/blog/feed/">Moya Project</a></li>
      
      <li><a href="http://blog.mozilla.com/webdev/category/python-2/feed/">Mozilla Web Development</a></li>
      
      <li><a href="http://muharem.wordpress.com/feed/atom/">Muharem Hrnjadovic</a></li>
      
      <li><a href="http://www.mycli.net/feeds/tag.python.rss.xml">Mycli</a></li>
      
      <li><a href="http://learnpython.wordpress.com/feed/atom/">Naomi Ceder</a></li>
      
      <li><a href="http://www.natan.termitnjak.net/blog/category/python/feed/atom/index.xml">Natan Zabkar</a></li>
      
      <li><a href="http://nedbatchelder.com/blog/planetpython.xml">Ned Batchelder</a></li>
      
      <li><a href="http://python.ca/nas/log/rss-python.xml">Neil Schemenauer</a></li>
      
      <li><a href="http://www.curiousefficiency.org/categories/python.xml">Nick Coghlan</a></li>
      
      <li><a href="http://blog.efford.org/tag/feeds/python.atom.xml">Nick Efford</a></li>
      
      <li><a href="http://nickjanetakis.blogspot.com/feeds/posts/default/-/python">Nick Janetakis</a></li>
      
      <li><a href="http://nicolaiarocci.com/tags/python/index.xml">Nicola Iarocci</a></li>
      
      <li><a href="http://www.nicosphere.net/tag/python-en/feed/">Nicolas Paris</a></li>
      
      <li><a href="http://nigelb.me/python.xml">Nigel Babu</a></li>
      
      <li><a href="http://feeds.feedburner.com/getnikola/QBjz">Nikola</a></li>
      
      <li><a href="https://nikos7am.com/index.xml">Nikolaos Diamantis</a></li>
      
      <li><a href="http://dev.nextthought.com/blog/categories/python.atom">Not Invented Here</a></li>
      
      <li><a href="https://nskm.xyz/tags/python/index.xml">Nsukami Patrick</a></li>
      
      <li><a href="http://www.obeythetestinggoat.com/feeds/all.atom.xml">Obey the Testing Goat</a></li>
      
      <li><a href="https://ofosos.org/tag/python/rss/">Ofosos</a></li>
      
      <li><a href="http://www.omahapython.org/blog/feed">Omaha Python Users Group</a></li>
      
      <li><a href="http://ondrejcertik.blogspot.com/feeds/posts/default/-/python">Ond&#345;ej &#268;ert&iacute;k</a></li>
      
      <li><a href="https://www.paulox.net/feed/python.xml">Paolo Melchiorre</a></li>
      
      <li><a href="http://s3.amazonaws.com/blog.pathwright.com/feeds/tag.Python.atom.xml">Pathwright</a></li>
      
      <li><a href="http://weblog.patrice.ch/tags/Python.atom">Patrice Neff</a></li>
      
      <li><a href="http://pauleveritt.wordpress.com/feed/atom/">Paul Everitt</a></li>
      
      <li><a href="http://www.logarithmic.net/pfh?action=atom;hasname=1;name=gcgmgpghfpgdgpgegf">Paul Harrison</a></li>
      
      <li><a href="http://codebright.wordpress.com/category/python/feed/atom/">Paul Redman</a></li>
      
      <li><a href="http://pedro.valelima.com/blog/feed/tag/python/">Pedro Lima</a></li>
      
      <li><a href="http://www.peterbe.com/oc-Python/rss.xml">Peter Bengtsson</a></li>
      
      <li><a href="http://petereisentraut.blogspot.com/feeds/posts/default/-/Python/">Peter Eisentraut</a></li>
      
      <li><a href="http://neovox.advancedmagic.de/?feed=rss2&cat=6">Peter FankhÃ¤nel</a></li>
      
      <li><a href="http://push.cx/tag/python/feed">Peter Harkins</a></li>
      
      <li><a href="http://peter-hoffmann.com/feed/atom-python.xml">Peter Hoffmann</a></li>
      
      <li><a href="http://www.philhassey.com/blog/category/python/feed">Phil Hassey</a></li>
      
      <li><a href="http://dunderboss.blogspot.com/feeds/posts/default/-/python">Philip Jenvey</a></li>
      
      <li><a href="http://philikon.wordpress.com/category/python/feed/atom/">Philipp von Weitershausen</a></li>
      
      <li><a href="http://base-art.net/Articles/rss.xml">Philippe Normand</a></li>
      
      <li><a href="http://feeds.feedburner.com/pje-on-programming">Phillip J. Eby</a></li>
      
      <li><a href="http://polyglot.ninja/category/python/feed/">Polyglot.Ninja()</a></li>
      
      <li><a href="https://blog.ironboundsoftware.com/category/python/feed.xml">Possbility and Probability</a></li>
      
      <li><a href="http://feeds.feedburner.com/btbytes_python">Pradeep Gowda</a></li>
      
      <li><a href="http://www.flicker-technical.blogspot.fr/feeds/posts/default/-/Python">Pranav Pandey</a></li>
      
      <li><a href="http://feeds.feedburner.com/shutupandship_python">Praveen Gollakota</a></li>
      
      <li><a href="https://www.programiz.com/python-programming/rss.xml">Programiz</a></li>
      
      <li><a href="https://programmingideaswithjake.wordpress.com/category/python/feed/rdf/">Programming Ideas With Jake</a></li>
      
      <li><a href="http://feeds.feedburner.com/Pycharm">PyCharm</a></li>
      
      <li><a href="https://pycoders.com/feed/planetpython">PyCoderâs Weekly</a></li>
      
      <li><a href="http://feeds.feedburner.com/PyCon">PyCon</a></li>
      
      <li><a href="https://www.pygame.org/news/feed/atom">pygame</a></li>
      
      <li><a href="https://www.pypy.org/rss.xml">PyPy</a></li>
      
      <li><a href="http://pytennessee.tumblr.com/rss">PyTennessee</a></li>
      
      <li><a href="http://python4kids.wordpress.com/feed/atom/">Python 4 Kids</a></li>
      
      <li><a href="http://www.awaretek.com/python/index.xml">Python 411 Podcast</a></li>
      
      <li><a href="http://python-advocacy.blogspot.com/atom.xml">Python Advocacy</a></li>
      
      <li><a href="http://blog.pythonanywhere.com/feed/">Python Anywhere</a></li>
      
      <li><a href="https://pythonbytes.fm/episodes/rss">Python Bytes</a></li>
      
      <li><a href="https://www.python-celery.com/feed.xml">Python Celery - Weekly Celery Tutorials and How-tos</a></li>
      
      <li><a href="https://www.pythoncircle.com/feed/">Python Circle</a></li>
      
      <li><a href="http://pythondata.com/feed/">Python Data</a></li>
      
      <li><a href="http://pythondoeswhat.blogspot.com/feeds/posts/default">Python Does What?!</a></li>
      
      <li><a href="https://blogs.msdn.microsoft.com/pythonengineering/feed/">Python Engineering at Microsoft</a></li>
      
      <li><a href="https://www.pythonguis.com/feeds/all.atom.xml">Python GUIs</a></li>
      
      <li><a href="http://feeds.feedburner.com/PythonInsider">Python Insider</a></li>
      
      <li><a href="https://www.pythonmorsels.com/topics/feed/">Python Morsels</a></li>
      
      <li><a href="https://pythonpeople.fm/rss">Python People</a></li>
      
      <li><a href="http://www.pyptug.org/feeds/posts/default/">Python Piedmont Triad User Group</a></li>
      
      <li><a href="https://www.pythonpool.com/feed/">Python Pool</a></li>
      
      <li><a href="http://pyfound.blogspot.com/atom.xml">Python Software Foundation</a></li>
      
      <li><a href="https://sweetness.hmmz.org/feeds/python.rss.xml">Python Sweetness</a></li>
      
      <li><a href="http://python-groups.blogspot.com/feeds/posts/default">Python User Groups</a></li>
      
      <li><a href="https://www.pythonforbeginners.com/feed/">Python for Beginners</a></li>
      
      <li><a href="http://python-karan.blogspot.in//feeds/posts/default">Python on Karan</a></li>
      
      <li><a href="http://developerblog.myo.com/tag/python/rss/">Python with Myo</a></li>
      
      <li><a href="http://pythonxynews.blogspot.com/feeds/posts/default">Python(x,y) News</a></li>
      
      <li><a href="http://pythonclub.com.br/feeds/all.atom.xml">PythonClub - A Brazilian collaborative blog about Python</a></li>
      
      <li><a href="http://pythondebugging.com/category/python/feed.xml">PythonDebugging.com</a></li>
      
      <li><a href="https://coady.github.io/index.xml">Pythonicity</a></li>
      
      <li><a href="http://pythonology.blogspot.com/atom.xml">Pythonology</a></li>
      
      <li><a href="https://pythonspeed.com/atom.xml">PythonâSpeed</a></li>
      
      <li><a href="http://ptspts.blogspot.com/feeds/posts/default/-/planet-python">PÃ©ter SzabÃ³</a></li>
      
      <li><a href="http://blog.zsoldosp.eu/category/python/feed/">PÃ©ter Zsoldos</a></li>
      
      <li><a href="https://labs.quansight.org/rss.xml">Quansight Labs Blog</a></li>
      
      <li><a href="http://www.bitdance.com/blog/rss.xml">R David Murray</a></li>
      
      <li><a href="https://blog.rmotr.com/feed/tagged/python">RMOTR</a></li>
      
      <li><a href="http://threebean.org/blog/category/python/feed/atom/index.xml">Ralph Bean</a></li>
      
      <li><a href="https://blog.ram.rachum.com/tagged/planetpython/rss">Ram Rachum</a></li>
      
      <li><a href="http://blog.randell.ph/tag/python/feed/atom/">Randell Benavidez</a></li>
      
      <li><a href="http://randlet.com/blog/python/rss.xml">Randle Taylor</a></li>
      
      <li><a href="http://randyzwitch.com/tag/python/feed/">Randy Zwitch</a></li>
      
      <li><a href="http://rhettinger.wordpress.com/feed/atom/">Raymond Hettinger</a></li>
      
      <li><a href="http://blog.readthedocs.com/archive/tag/python/atom.xml">Read the Docs</a></li>
      
      <li><a href="https://realpython.com/atom.xml">Real Python</a></li>
      
      <li><a href="http://renesd.blogspot.com/feeds/posts/default/-/python">Rene Dudfield</a></li>
      
      <li><a href="http://posted-stuff.blogspot.com/feeds/posts/default/-/python">Richard Tew</a></li>
      
      <li><a href="http://blog.the-moon.net/feeds/posts/default/-/python">Richard Wall</a></li>
      
      <li><a href="http://rickardlindberg.me/tags/python/rss.xml">Rickard Lindberg</a></li>
      
      <li><a href="https://cmlzagk.github.io/feeds/python.atom.xml">Rishi Maker</a></li>
      
      <li><a href="http://www.robg3d.com/?tag=python&feed=atom">Rob Galanakis</a></li>
      
      <li><a href="http://rbtcollins.wordpress.com/tag/python/feed/atom/">Robert Collins</a></li>
      
      <li><a href="http://rz.scale-it.pl/rss-python.html">Robert Zaremba</a></li>
      
      <li><a href="http://www.theatreofnoise.com/feeds/posts/default/-/dev">Robin Parmar</a></li>
      
      <li><a href="http://blog.rtwilson.com/category/programming-2/python/feed/">Robin Wilson</a></li>
      
      <li><a href="http://linil.wordpress.com/feed/atom/">Rodrigo AraÃºj</a></li>
      
      <li><a href="https://www.rosehosting.com/blog/tag/python/feed/">RoseHosting Blog</a></li>
      
      <li><a href="http://ruslanspivak.com/category/python/feed/atom/">Ruslan Spivak</a></li>
      
      <li><a href="http://www.asciiarmor.com/tagged/python/rss">Ryan Cox</a></li>
      
      <li><a href="http://slott-softwarearchitect.blogspot.com/feeds/posts/default/-/python">S. Lott</a></li>
      
      <li><a href="https://pyhelper.wordpress.com/feed/">S. R. Krishnan</a></li>
      
      <li><a href="http://www.sdjournal.com/archives/categories/languages/python/rss.xml">SDJournal</a></li>
      
      <li><a href="http://pythonide.blogspot.com/feeds/posts/default">SPE Weblog</a></li>
      
      <li><a href="http://feeds.feedburner.com/sfpy">Salim Fadhley</a></li>
      
      <li><a href="https://sandipanweb.wordpress.com/category/python/feed/">Sandipan Dey</a></li>
      
      <li><a href="http://sandrotosi.blogspot.com/feeds/posts/default/-/Python">Sandro Tosi</a></li>
      
      <li><a href="http://seanmcgrath.blogspot.com/feeds/posts/default/-/python">Sean McGrath</a></li>
      
      <li><a href="https://k-d-w.org/tags/python/index.xml">Sebastian PÃ¶lsterl</a></li>
      
      <li><a href="https://switowski.com/python.feed.xml">Sebastian Witowski</a></li>
      
      <li><a href="http://www.chesnok.com/daily/category/python/feed/">Selena Deckelmann</a></li>
      
      <li><a href="http://feeds.feedburner.com/phoe6pythonfeeds">Senthil Kumaran</a></li>
      
      <li><a href="https://sethmlarson.dev/feed">Seth Michael Larson</a></li>
      
      <li><a href="http://jjinux.blogspot.com/feeds/posts/default/-/python">Shannon -jj Behrens</a></li>
      
      <li><a href="http://simeonfranklin.com/feeds/python/">Simeon Franklin</a></li>
      
      <li><a href="http://feeds.feedburner.com/simeon_visser_python">Simeon Visser</a></li>
      
      <li><a href="http://aboutsimon.com/category/python/feed/atom/">Simon</a></li>
      
      <li><a href="http://www.brunningonline.net/simon/blog/index-P.xml">Simon Brunning</a></li>
      
      <li><a href="http://entitycrisis.blogspot.com/feeds/posts/default/-/Python">Simon Wittber</a></li>
      
      <li><a href="https://simpleisbetterthancomplex.com/feed.xml">Simple is Better Than Complex</a></li>
      
      <li><a href="http://www.softformance.com/feed/?tag=python">SoftFormance</a></li>
      
      <li><a href="https://brmmm3.github.io/feed.xml">Speed Matters</a></li>
      
      <li><a href="http://speno.blogspot.com/atom.xml">"Speno's Pythonic Avocado"</a></li>
      
      <li><a href="http://spikeekips.tumblr.com/tagged/python/rss">Spike ekipS</a></li>
      
      <li><a href="https://www.spyder-ide.org/blog/feed.xml">Spyder IDE</a></li>
      
      <li><a href="http://stackabuse.com/tag/python/rss">Stack Abuse</a></li>
      
      <li><a href="https://smorbieu.gitlab.io/feeds/tag_python.atom.xml">Stanislas Morbieu</a></li>
      
      <li><a href="http://blog.behnel.de/index.php?feed=rss2&cat=22">Stefan Behnel</a></li>
      
      <li><a href="http://stefan.sofa-rockers.org/feeds/python">Stefan Scherfke</a></li>
      
      <li><a href="http://www.jodal.no/atom-python.xml">Stein Magnus Jodal</a></li>
      
      <li><a href="http://pythonconquerstheuniverse.wordpress.com/feed/atom/">Stephen Ferg</a></li>
      
      <li><a href="http://holdenweb.blogspot.com/feeds/posts/default/-/python">Steve Holden</a></li>
      
      <li><a href="http://rh0dium.blogspot.com/feeds/posts/default/-/python">Steven Klass</a></li>
      
      <li><a href="http://TuringFinance.com/category/python/feed/">Stuart Gordon Reid</a></li>
      
      <li><a href="https://wirtel.be/tags/python/index.xml">StÃ©phane Wirtel</a></li>
      
      <li><a href="https://www.harihareswara.net/rss/python/">Sumana Harihareswara - Cogito, Ergo Sumana</a></li>
      
      <li><a href="https://www.tutlane.com/pythonfeed.xml">Suresh Dasari/Tutlane.com</a></li>
      
      <li><a href="https://ict.swisscom.ch/feed/?post_type=cubetech_post&cubetech_keyword=Python">Swisscom ICT</a></li>
      
      <li><a href="http://www.talkpythontome.com/episodes/rss">Talk Python to Me</a></li>
      
      <li><a href="http://blog.tedmiston.com/tag/python/rss">Taylor Edmiston</a></li>
      
      <li><a href="https://www.techbeamers.com/python-programming-tutorials/feed/">TechBeamers Python</a></li>
      
      <li><a href="https://www.techiediaries.com/tag/django/index.xml">Techiediaries - Django</a></li>
      
      <li><a href="http://terriko.dreamwidth.org/data/rss?tag=python">Terri Oda</a></li>
      
      <li><a href="http://blogs.fluidinfo.com/terry/category/python/feed/atom/">Terry Jones</a></li>
      
      <li><a href="http://testandcode.com/rss">Test and Code</a></li>
      
      <li><a href="https://testdriven.io/blog/topics/django/feed.xml">TestDriven.io</a></li>
      
      <li><a href="http://www.thedatascientist.de/category/python/feed/">The Data Scientist</a></li>
      
      <li><a href="https://www.thedigitalcatonline.com/categories/python/atom.xml">The Digital Cat</a></li>
      
      <li><a href="https://lunarcowboy.com/feeds/python.atom.xml">The Lunar Cowboy</a></li>
      
      <li><a href="https://no-title.victordomingos.com/feeds/python_rss.xml">The No TitleÂ® Tech Blog</a></li>
      
      <li><a href="http://blog.dowski.com/category/python/feed">The Occasional Occurrence</a></li>
      
      <li><a href="https://fortintam.com/blog/category/planet-python/feed/">The Open Sourcerer</a></li>
      
      <li><a href="http://blog.parcon.opengroove.org/feeds/posts/default">The Parcon Blog</a></li>
      
      <li><a href="https://thepythoncodingbook.com/feed/">The Python Coding Blog</a></li>
      
      <li><a href="https://threeofwands.com/tag/python/rss/">The Three of Wands</a></li>
      
      <li><a href="http://www.tibonihoo.net/blog/en/tag/python/feed/">Thibauld Nion</a></li>
      
      <li><a href="https://thishosting.rocks/tag/python/feed/">ThisHosting.Rocks</a></li>
      
      <li><a href="http://feeds.wordaligned.org/wordaligned/python">Thomas Guest</a></li>
      
      <li><a href="http://thomas.apestaart.org/log/?feed=rss2&cat=22">Thomas Vander Stichele</a></li>
      
      <li><a href="https://www.tibobeijen.nl/tags/python/index.xml">Tibo Beijen</a></li>
      
      <li><a href="https://reachtim.com/feeds/python.atom.xml">Tim Arnold / reachtim</a></li>
      
      <li><a href="http://timgilbert.wordpress.com/category/python/feed/atom/">Tim Gilbert</a></li>
      
      <li><a href="http://feeds.feedburner.com/duffyd">Tim Knapp</a></li>
      
      <li><a href="http://apipes.blogspot.com/feeds/posts/default/-/python">Tim Lesher</a></li>
      
      <li><a href="http://feeds.feedburner.com/thobe/wardrobe">Tobias Ivarsson</a></li>
      
      <li><a href="http://thewebhaswon.wordpress.com/category/python/atom">Tom Christie</a></li>
      
      <li><a href="http://www.sys-exit.blogspot.com/feeds/posts/default/-/python">Tomasz Ducin</a></li>
      
      <li><a href="http://www.tomaz.me/tags/python.xml">TomaÅ¾ Muraus</a></li>
      
      <li><a href="http://tomerfiliba.com/blog/python-atom.xml">Tomer Filiba</a></li>
      
      <li><a href="http://tonybreyal.wordpress.com/category/python/feed/atom/">Tony Breyal</a></li>
      
      <li><a href="http://anonbadger.wordpress.com/tag/python/feed/atom/">Toshio Kuratomi</a></li>
      
      <li><a href="http://technicaldiscovery.blogspot.com/feeds/posts/default/-/python">Travis Oliphant</a></li>
      
      <li><a href="https://treyhunner.com/python.xml">Trey Hunner</a></li>
      
      <li><a href="http://www.tryton.org/rss.xml">Tryton News</a></li>
      
      <li><a href="http://www.turnkeylinux.org/taxonomy/term/103/0/feed">Turnkey Linux</a></li>
      
      <li><a href="https://typethepipe.com/categories/python/index.xml">TypeThePipe</a></li>
      
      <li><a href="http://vsbabu.org/mt/index.rdf">V.S. Babu</a></li>
      
      <li><a href="http://prayogshala.wordpress.com/category/scripting/python/feed/atom/">Varun Nischal</a></li>
      
      <li><a href="http://jugad2.blogspot.co.uk/feeds/posts/default/-/python">Vasudev Ram</a></li>
      
      <li><a href="http://pymolurus.blogspot.com/feeds/posts/default">Vinay Sajip</a></li>
      
      <li><a href="http://plumberjack.blogspot.com/feeds/posts/default">Vinay Sajip (Logging)</a></li>
      
      <li><a href="https://vinayak.io/feed/tag/python/rss.xml">Vinayak Mehta</a></li>
      
      <li><a href="http://www.vperic.blogspot.com/feeds/posts/default/-/Twisted">Vladimir PeriÄ</a></li>
      
      <li><a href="http://pieceofpy.com/category/python/feed/atom/index.xml">Wayne Witzel</a></li>
      
      <li><a href="http://www.weeklypython.chat/feed/">Weekly Python Chat</a></li>
      
      <li><a href="http://python-weekly.blogspot.com/feeds/posts/default?alt=rss">Weekly Python StackOverflow Report</a></li>
      
      <li><a href="http://1stvamp.org/tag/python/atom/">Wes Mason</a></li>
      
      <li><a href="http://wescpy.blogspot.com/feeds/posts/default/-/python">Wesley Chun</a></li>
      
      <li><a href="http://bluesock.org/~willkg/blog/tag/python.xml">Will Kahn-Greene</a></li>
      
      <li><a href="http://www.willmcgugan.com/blog/tech/feeds/posts/">Will McGugan</a></li>
      
      <li><a href="http://willpython.blogspot.com/feeds/posts/default">Will Pierce</a></li>
      
      <li><a href="http://blog.minchin.ca/feeds/label.python.atom.xml">William Minchin</a></li>
      
      <li><a href="http://foolish-assertions.blogspot.com/feeds/posts/default/-/python">William Reade</a></li>
      
      <li><a href="http://william-os4y.livejournal.com/data/atom">"William's Journal"</a></li>
      
      <li><a href="http://wingware.com/blog/rss&noheader=1">Wing Tips</a></li>
      
      <li><a href="http://wingware.com/news/rss&noheader=1">Wingware</a></li>
      
      <li><a href="https://wyattbaldwin.com/categories/planet-python/rss.xml">Wyatt Baldwin</a></li>
      
      <li><a href="http://tech.blog.aknin.name/tag/python/feed/atom/">Yaniv Aknin</a></li>
      
      <li><a href="http://www.ylarrivee.com/tag/python/feed/">Yann LarrivÃ©e</a></li>
      
      <li><a href="http://uberpython.wordpress.com/tag/python/feed/atom/">Yuval Greenfield</a></li>
      
      <li><a href="http://za.github.io/feed.python.xml">Zaki Akhmad</a></li>
      
      <li><a href="https://zato.io/blog/rss.xml">Zato Blog</a></li>
      
      <li><a href="https://zerotomastery.io/rss/python-rss.xml">Zero to Mastery</a></li>
      
      <li><a href="https://zerowithdot.com/feed.xml">Zero-with-Dot (Oleg Å»ero)</a></li>
      
      <li><a href="https://medium.com/feed/@ZeroDB_">ZeroDB</a></li>
      
      <li><a href="http://blog.bottlepy.org/feeds/all.atom.xml">bottlepy-dev</a></li>
      
      <li><a href="http://feeds.feedburner.com/codeboje_python">codeboje</a></li>
      
      <li><a href="https://death.andgravity.com/_feed/index/_tags/python.xml">death and gravity</a></li>
      
      <li><a href="http://www.egenix.com/company/news/rss2">eGenix.com</a></li>
      
      <li><a href="http://hypothesis.works/articles/python/feed/">hypothesis.works articles</a></li>
      
      <li><a href="http://scummos.blogspot.com/feeds/posts/default/-/kdev-python">kdev-python</a></li>
      
      <li><a href="https://meejah.ca/planetpython.xml">meejah.ca</a></li>
      
      <li><a href="http://nl-project.blogspot.com/feeds/posts/default/-/python">nl-project</a></li>
      
      <li><a href="http://pgcli.com/feeds/tag.python.atom.xml">pgcli</a></li>
      
      <li><a href="https://py.checkio.org/blog/special-rss/">py.CheckIO</a></li>
      
      <li><a href="http://www.pythonwise.blogspot.com/feeds/posts/default/-/python">pythonwise</a></li>
      
      <li><a href="http://blog.qutebrowser.org/feeds/tag-pyplanet.rss.xml">qutebrowser development blog</a></li>
      
      <li><a href="http://recollection.saaj.me/tag/python.xml">saaj/recollection</a></li>
      
      <li><a href="https://blog.scikit-learn.org/feed.xml">scikit-learn</a></li>
      
      <li><a href="https://testmon.org/index.xml">testmon</a></li>
      
      <li><a href="http://tryexceptpass.org/index.xml">tryexceptpass</a></li>
      
      <li><a href="http://wokslog.wordpress.com/tag/python/feed/atom/">Ãric Araujo</a></li>
      
      <li><a href="https://lukasz.langa.pl/python/atom.xml">Åukasz Langa</a></li>
      
      <li><a href="https://www.pythonshow.com/feed">The Python Show</a></li>
      
      <li><a href="https://stefaniemolin.com/feeds/Python-atom.xml">Stefanie Molin</a></li>
      
      <li><a href="https://bugfactory.io/articles-on-python/feed.xml">Christoph Schiessl</a></li>
      
    </ul>
  </div>
</ul>

      </div>
    </div>
  </body>
</html>